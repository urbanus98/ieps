!function(){"use strict";const e="v3.1.0",t="true"===String(!0),i="__exponea_etc__",n="__exponea_time2__",r="__exponea_tracking_definition__",s="__exponea_banner_event__",o="__exponea_last_session_ping_timestamp__",a="__exponea_last_session_start_timestamp__",c="exponea",u="Exponea",h="__exponea_ab_",l="__exponea_safari_push_subscribed__",d="__exponea__sync_modifications__",p="browser_push_notification",g="browser_push_notification_vapid_key",m="snippetVersion",f="exponea-editor-params",b="exponea-experiments-editor",y="/editor/",v=["runtime","polyfills","vendor","main"],w="webxpClient";function _(e,t,i){e._&&e._.forEach((e=>{const n=e[0],r=e[1];if(n.includes(".")){const e=n.split("."),s=e[0],o=e[1];if(!(s in t))return i.error(`Failed to replay function call ${n}`),void i.error(`${s} does not exist on the object`);try{t[s][o].apply(t[s],r)}catch(e){i.error(`Failed to replay function call ${n}`,e)}}else try{t[n].apply(t,r)}catch(e){i.error(`Failed to replay function call ${n}`,e)}}))}function k(e,t,i){e.forEach((e=>{t[e]=i[e].bind(i)}))}function S(e,t){for(var i=-1,n=null==e?0:e.length;++i<n&&!1!==t(e[i],i,e););return e}function T(e){return function(t,i,n){for(var r=-1,s=Object(t),o=n(t),a=o.length;a--;){var c=o[e?a:++r];if(!1===i(s[c],c,s))break}return t}}var x=T();var E="object"==typeof global&&global&&global.Object===Object&&global,C="object"==typeof self&&self&&self.Object===Object&&self,A=E||C||Function("return this")(),O=A.Symbol,P=Object.prototype,j=P.hasOwnProperty,L=P.toString,I=O?O.toStringTag:void 0;var B=Object.prototype.toString;var z=O?O.toStringTag:void 0;function D(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":z&&z in Object(e)?function(e){var t=j.call(e,I),i=e[I];try{e[I]=void 0;var n=!0}catch(e){}var r=L.call(e);return n&&(t?e[I]=i:delete e[I]),r}(e):function(e){return B.call(e)}(e)}function F(e){return null!=e&&"object"==typeof e}function R(e){return F(e)&&"[object Arguments]"==D(e)}var M=Object.prototype,N=M.hasOwnProperty,q=M.propertyIsEnumerable,U=R(function(){return arguments}())?R:function(e){return F(e)&&N.call(e,"callee")&&!q.call(e,"callee")},W=U,$=Array.isArray;var H="object"==typeof exports&&exports&&!exports.nodeType&&exports,V=H&&"object"==typeof module&&module&&!module.nodeType&&module,G=V&&V.exports===H?A.Buffer:void 0,K=(G?G.isBuffer:void 0)||function(){return!1},Q=/^(?:0|[1-9]\d*)$/;function J(e,t){var i=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==i||"symbol"!=i&&Q.test(e))&&e>-1&&e%1==0&&e<t}function Y(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}var Z={};function X(e){return function(t){return e(t)}}Z["[object Float32Array]"]=Z["[object Float64Array]"]=Z["[object Int8Array]"]=Z["[object Int16Array]"]=Z["[object Int32Array]"]=Z["[object Uint8Array]"]=Z["[object Uint8ClampedArray]"]=Z["[object Uint16Array]"]=Z["[object Uint32Array]"]=!0,Z["[object Arguments]"]=Z["[object Array]"]=Z["[object ArrayBuffer]"]=Z["[object Boolean]"]=Z["[object DataView]"]=Z["[object Date]"]=Z["[object Error]"]=Z["[object Function]"]=Z["[object Map]"]=Z["[object Number]"]=Z["[object Object]"]=Z["[object RegExp]"]=Z["[object Set]"]=Z["[object String]"]=Z["[object WeakMap]"]=!1;var ee="object"==typeof exports&&exports&&!exports.nodeType&&exports,te=ee&&"object"==typeof module&&module&&!module.nodeType&&module,ie=te&&te.exports===ee&&E.process,ne=function(){try{var e=te&&te.require&&te.require("util").types;return e||ie&&ie.binding&&ie.binding("util")}catch(e){}}(),re=ne&&ne.isTypedArray,se=re?X(re):function(e){return F(e)&&Y(e.length)&&!!Z[D(e)]},oe=Object.prototype.hasOwnProperty;function ae(e,t){var i=$(e),n=!i&&W(e),r=!i&&!n&&K(e),s=!i&&!n&&!r&&se(e),o=i||n||r||s,a=o?function(e,t){for(var i=-1,n=Array(e);++i<e;)n[i]=t(i);return n}(e.length,String):[],c=a.length;for(var u in e)!t&&!oe.call(e,u)||o&&("length"==u||r&&("offset"==u||"parent"==u)||s&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||J(u,c))||a.push(u);return a}var ce=Object.prototype;function ue(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||ce)}function he(e,t){return function(i){return e(t(i))}}var le=he(Object.keys,Object),de=Object.prototype.hasOwnProperty;function pe(e){if(!ue(e))return le(e);var t=[];for(var i in Object(e))de.call(e,i)&&"constructor"!=i&&t.push(i);return t}function ge(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function me(e){if(!ge(e))return!1;var t=D(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}function fe(e){return null!=e&&Y(e.length)&&!me(e)}function be(e){return fe(e)?ae(e):pe(e)}function ye(e,t){return e&&x(e,t,be)}function ve(e,t){return function(i,n){if(null==i)return i;if(!fe(i))return e(i,n);for(var r=i.length,s=t?r:-1,o=Object(i);(t?s--:++s<r)&&!1!==n(o[s],s,o););return i}}var we=ve(ye);function _e(e){return e}function ke(e){return"function"==typeof e?e:_e}function Se(e,t){return($(e)?S:we)(e,ke(t))}function Te(e,t){return e===t||e!=e&&t!=t}function xe(e,t){for(var i=e.length;i--;)if(Te(e[i][0],t))return i;return-1}var Ee=Array.prototype.splice;function Ce(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}Ce.prototype.clear=function(){this.__data__=[],this.size=0},Ce.prototype.delete=function(e){var t=this.__data__,i=xe(t,e);return!(i<0)&&(i==t.length-1?t.pop():Ee.call(t,i,1),--this.size,!0)},Ce.prototype.get=function(e){var t=this.__data__,i=xe(t,e);return i<0?void 0:t[i][1]},Ce.prototype.has=function(e){return xe(this.__data__,e)>-1},Ce.prototype.set=function(e,t){var i=this.__data__,n=xe(i,e);return n<0?(++this.size,i.push([e,t])):i[n][1]=t,this};var Ae,Oe=A["__core-js_shared__"],Pe=(Ae=/[^.]+$/.exec(Oe&&Oe.keys&&Oe.keys.IE_PROTO||""))?"Symbol(src)_1."+Ae:"";var je=Function.prototype.toString;function Le(e){if(null!=e){try{return je.call(e)}catch(e){}try{return e+""}catch(e){}}return""}var Ie=/^\[object .+?Constructor\]$/,Be=Function.prototype,ze=Object.prototype,De=Be.toString,Fe=ze.hasOwnProperty,Re=RegExp("^"+De.call(Fe).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Me(e){return!(!ge(e)||(t=e,Pe&&Pe in t))&&(me(e)?Re:Ie).test(Le(e));var t}function Ne(e,t){var i=function(e,t){return null==e?void 0:e[t]}(e,t);return Me(i)?i:void 0}var qe=Ne(A,"Map"),Ue=Ne(Object,"create");var We=Object.prototype.hasOwnProperty;var $e=Object.prototype.hasOwnProperty;function He(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}function Ve(e,t){var i,n,r=e.__data__;return("string"==(n=typeof(i=t))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==i:null===i)?r["string"==typeof t?"string":"hash"]:r.map}function Ge(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}He.prototype.clear=function(){this.__data__=Ue?Ue(null):{},this.size=0},He.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},He.prototype.get=function(e){var t=this.__data__;if(Ue){var i=t[e];return"__lodash_hash_undefined__"===i?void 0:i}return We.call(t,e)?t[e]:void 0},He.prototype.has=function(e){var t=this.__data__;return Ue?void 0!==t[e]:$e.call(t,e)},He.prototype.set=function(e,t){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=Ue&&void 0===t?"__lodash_hash_undefined__":t,this},Ge.prototype.clear=function(){this.size=0,this.__data__={hash:new He,map:new(qe||Ce),string:new He}},Ge.prototype.delete=function(e){var t=Ve(this,e).delete(e);return this.size-=t?1:0,t},Ge.prototype.get=function(e){return Ve(this,e).get(e)},Ge.prototype.has=function(e){return Ve(this,e).has(e)},Ge.prototype.set=function(e,t){var i=Ve(this,e),n=i.size;return i.set(e,t),this.size+=i.size==n?0:1,this};function Ke(e){var t=this.__data__=new Ce(e);this.size=t.size}Ke.prototype.clear=function(){this.__data__=new Ce,this.size=0},Ke.prototype.delete=function(e){var t=this.__data__,i=t.delete(e);return this.size=t.size,i},Ke.prototype.get=function(e){return this.__data__.get(e)},Ke.prototype.has=function(e){return this.__data__.has(e)},Ke.prototype.set=function(e,t){var i=this.__data__;if(i instanceof Ce){var n=i.__data__;if(!qe||n.length<199)return n.push([e,t]),this.size=++i.size,this;i=this.__data__=new Ge(n)}return i.set(e,t),this.size=i.size,this};function Qe(e){var t=-1,i=null==e?0:e.length;for(this.__data__=new Ge;++t<i;)this.add(e[t])}function Je(e,t){for(var i=-1,n=null==e?0:e.length;++i<n;)if(t(e[i],i,e))return!0;return!1}Qe.prototype.add=Qe.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},Qe.prototype.has=function(e){return this.__data__.has(e)};function Ye(e,t,i,n,r,s){var o=1&i,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var u=s.get(e),h=s.get(t);if(u&&h)return u==t&&h==e;var l=-1,d=!0,p=2&i?new Qe:void 0;for(s.set(e,t),s.set(t,e);++l<a;){var g=e[l],m=t[l];if(n)var f=o?n(m,g,l,t,e,s):n(g,m,l,e,t,s);if(void 0!==f){if(f)continue;d=!1;break}if(p){if(!Je(t,(function(e,t){if(o=t,!p.has(o)&&(g===e||r(g,e,i,n,s)))return p.push(t);var o}))){d=!1;break}}else if(g!==m&&!r(g,m,i,n,s)){d=!1;break}}return s.delete(e),s.delete(t),d}var Ze=A.Uint8Array;function Xe(e){var t=-1,i=Array(e.size);return e.forEach((function(e,n){i[++t]=[n,e]})),i}function et(e){var t=-1,i=Array(e.size);return e.forEach((function(e){i[++t]=e})),i}var tt=O?O.prototype:void 0,it=tt?tt.valueOf:void 0;function nt(e,t){for(var i=-1,n=t.length,r=e.length;++i<n;)e[r+i]=t[i];return e}function rt(e,t,i){var n=t(e);return $(e)?n:nt(n,i(e))}function st(){return[]}var ot=Object.prototype.propertyIsEnumerable,at=Object.getOwnPropertySymbols,ct=at?function(e){return null==e?[]:(e=Object(e),function(e,t){for(var i=-1,n=null==e?0:e.length,r=0,s=[];++i<n;){var o=e[i];t(o,i,e)&&(s[r++]=o)}return s}(at(e),(function(t){return ot.call(e,t)})))}:st,ut=ct;function ht(e){return rt(e,be,ut)}var lt=Object.prototype.hasOwnProperty;var dt=Ne(A,"DataView"),pt=Ne(A,"Promise"),gt=Ne(A,"Set"),mt=Ne(A,"WeakMap"),ft="[object Map]",bt="[object Promise]",yt="[object Set]",vt="[object WeakMap]",wt="[object DataView]",_t=Le(dt),kt=Le(qe),St=Le(pt),Tt=Le(gt),xt=Le(mt),Et=D;(dt&&Et(new dt(new ArrayBuffer(1)))!=wt||qe&&Et(new qe)!=ft||pt&&Et(pt.resolve())!=bt||gt&&Et(new gt)!=yt||mt&&Et(new mt)!=vt)&&(Et=function(e){var t=D(e),i="[object Object]"==t?e.constructor:void 0,n=i?Le(i):"";if(n)switch(n){case _t:return wt;case kt:return ft;case St:return bt;case Tt:return yt;case xt:return vt}return t});var Ct=Et,At="[object Arguments]",Ot="[object Array]",Pt="[object Object]",jt=Object.prototype.hasOwnProperty;function Lt(e,t,i,n,r,s){var o=$(e),a=$(t),c=o?Ot:Ct(e),u=a?Ot:Ct(t),h=(c=c==At?Pt:c)==Pt,l=(u=u==At?Pt:u)==Pt,d=c==u;if(d&&K(e)){if(!K(t))return!1;o=!0,h=!1}if(d&&!h)return s||(s=new Ke),o||se(e)?Ye(e,t,i,n,r,s):function(e,t,i,n,r,s,o){switch(i){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!s(new Ze(e),new Ze(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return Te(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var a=Xe;case"[object Set]":var c=1&n;if(a||(a=et),e.size!=t.size&&!c)return!1;var u=o.get(e);if(u)return u==t;n|=2,o.set(e,t);var h=Ye(a(e),a(t),n,r,s,o);return o.delete(e),h;case"[object Symbol]":if(it)return it.call(e)==it.call(t)}return!1}(e,t,c,i,n,r,s);if(!(1&i)){var p=h&&jt.call(e,"__wrapped__"),g=l&&jt.call(t,"__wrapped__");if(p||g){var m=p?e.value():e,f=g?t.value():t;return s||(s=new Ke),r(m,f,i,n,s)}}return!!d&&(s||(s=new Ke),function(e,t,i,n,r,s){var o=1&i,a=ht(e),c=a.length;if(c!=ht(t).length&&!o)return!1;for(var u=c;u--;){var h=a[u];if(!(o?h in t:lt.call(t,h)))return!1}var l=s.get(e),d=s.get(t);if(l&&d)return l==t&&d==e;var p=!0;s.set(e,t),s.set(t,e);for(var g=o;++u<c;){var m=e[h=a[u]],f=t[h];if(n)var b=o?n(f,m,h,t,e,s):n(m,f,h,e,t,s);if(!(void 0===b?m===f||r(m,f,i,n,s):b)){p=!1;break}g||(g="constructor"==h)}if(p&&!g){var y=e.constructor,v=t.constructor;y==v||!("constructor"in e)||!("constructor"in t)||"function"==typeof y&&y instanceof y&&"function"==typeof v&&v instanceof v||(p=!1)}return s.delete(e),s.delete(t),p}(e,t,i,n,r,s))}function It(e,t,i,n,r){return e===t||(null==e||null==t||!F(e)&&!F(t)?e!=e&&t!=t:Lt(e,t,i,n,It,r))}function Bt(e){return e==e&&!ge(e)}function zt(e,t){return function(i){return null!=i&&(i[e]===t&&(void 0!==t||e in Object(i)))}}function Dt(e){var t=function(e){for(var t=be(e),i=t.length;i--;){var n=t[i],r=e[n];t[i]=[n,r,Bt(r)]}return t}(e);return 1==t.length&&t[0][2]?zt(t[0][0],t[0][1]):function(i){return i===e||function(e,t,i,n){var r=i.length,s=r,o=!n;if(null==e)return!s;for(e=Object(e);r--;){var a=i[r];if(o&&a[2]?a[1]!==e[a[0]]:!(a[0]in e))return!1}for(;++r<s;){var c=(a=i[r])[0],u=e[c],h=a[1];if(o&&a[2]){if(void 0===u&&!(c in e))return!1}else{var l=new Ke;if(n)var d=n(u,h,c,e,t,l);if(!(void 0===d?It(h,u,3,n,l):d))return!1}}return!0}(i,e,t)}}function Ft(e){return"symbol"==typeof e||F(e)&&"[object Symbol]"==D(e)}var Rt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Mt=/^\w*$/;function Nt(e,t){if($(e))return!1;var i=typeof e;return!("number"!=i&&"symbol"!=i&&"boolean"!=i&&null!=e&&!Ft(e))||(Mt.test(e)||!Rt.test(e)||null!=t&&e in Object(t))}function qt(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var i=function(){var n=arguments,r=t?t.apply(this,n):n[0],s=i.cache;if(s.has(r))return s.get(r);var o=e.apply(this,n);return i.cache=s.set(r,o)||s,o};return i.cache=new(qt.Cache||Ge),i}qt.Cache=Ge;var Ut,Wt,$t,Ht=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Vt=/\\(\\)?/g,Gt=(Ut=function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(Ht,(function(e,i,n,r){t.push(n?r.replace(Vt,"$1"):i||e)})),t},Wt=qt(Ut,(function(e){return 500===$t.size&&$t.clear(),e})),$t=Wt.cache,Wt),Kt=Gt;function Qt(e,t){for(var i=-1,n=null==e?0:e.length,r=Array(n);++i<n;)r[i]=t(e[i],i,e);return r}var Jt=O?O.prototype:void 0,Yt=Jt?Jt.toString:void 0;function Zt(e){if("string"==typeof e)return e;if($(e))return Qt(e,Zt)+"";if(Ft(e))return Yt?Yt.call(e):"";var t=e+"";return"0"==t&&1/e==-Infinity?"-0":t}function Xt(e){return null==e?"":Zt(e)}function ei(e,t){return $(e)?e:Nt(e,t)?[e]:Kt(Xt(e))}function ti(e){if("string"==typeof e||Ft(e))return e;var t=e+"";return"0"==t&&1/e==-Infinity?"-0":t}function ii(e,t){for(var i=0,n=(t=ei(t,e)).length;null!=e&&i<n;)e=e[ti(t[i++])];return i&&i==n?e:void 0}function ni(e,t){return null!=e&&t in Object(e)}function ri(e,t){return null!=e&&function(e,t,i){for(var n=-1,r=(t=ei(t,e)).length,s=!1;++n<r;){var o=ti(t[n]);if(!(s=null!=e&&i(e,o)))break;e=e[o]}return s||++n!=r?s:!!(r=null==e?0:e.length)&&Y(r)&&J(o,r)&&($(e)||W(e))}(e,t,ni)}function si(e,t){return Nt(e)&&Bt(t)?zt(ti(e),t):function(i){var n=function(e,t,i){var n=null==e?void 0:ii(e,t);return void 0===n?i:n}(i,e);return void 0===n&&n===t?ri(i,e):It(t,n,3)}}function oi(e){return Nt(e)?(t=ti(e),function(e){return null==e?void 0:e[t]}):function(e){return function(t){return ii(t,e)}}(e);var t}function ai(e){return"function"==typeof e?e:null==e?_e:"object"==typeof e?$(e)?si(e[0],e[1]):Dt(e):oi(e)}var ci=function(){try{var e=Ne(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),ui=ci;function hi(e,t,i){"__proto__"==t&&ui?ui(e,t,{configurable:!0,enumerable:!0,value:i,writable:!0}):e[t]=i}class li{constructor(e){this.cookies=e}getAbTest(e,t){const i=`${h}${e}__`;let n=this.cookies.getCookie(i);return n||(n=this._selectAbTestVariant(t)),this.cookies.setCookie(i,n,"ab_test"),n}_selectAbTestVariant(e,t=Math.random()){let i=0;const n=function(e,t){var i={};return t=ai(t),ye(e,(function(e,n,r){hi(i,n,t(e,n,r))})),i}(e,(e=>(i+=e,i))),r=t*i;return function(e,t,i){var n;return i(e,(function(e,i,r){if(t(e,i,r))return n=i,!1})),n}(n,ai((e=>r<e)),ye)}}
/*!
     * Sizzle CSS Selector Engine v@VERSION
     * http://sizzlejs.com/
     *
     * Copyright 2013 jQuery Foundation, Inc. and other contributors
     * Released under the MIT license
     * http://jquery.org/license
     *
     * Date: @DATE
     */var di=function(e){var t,i,n,r,s,o,a,c,u,h,l,d,p,g,m,f,b,y,v,w="sizzle"+-new Date,_=e.document,k=0,S=0,T=re(),x=re(),E=re(),C=function(e,t){return e===t&&(l=!0),0},A="undefined",O=1<<31,P={}.hasOwnProperty,j=[],L=j.pop,I=j.push,B=j.push,z=j.slice,D=j.indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(this[t]===e)return t;return-1},F="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",R="[\\x20\\t\\r\\n\\f]",M="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",N="\\["+R+"*("+M+")(?:"+R+"*([*^$|!~]?=)"+R+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+M+"))|)"+R+"*\\]",q=":("+M+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+N+")*)|.*)\\)|)",U=new RegExp("^"+R+"+|((?:^|[^\\\\])(?:\\\\.)*)"+R+"+$","g"),W=new RegExp("^"+R+"*,"+R+"*"),$=new RegExp("^"+R+"*([>+~]|"+R+")"+R+"*"),H=new RegExp("="+R+"*([^\\]'\"]*?)"+R+"*\\]","g"),V=new RegExp(q),G=new RegExp("^"+M+"$"),K={ID:new RegExp("^#("+M+")"),CLASS:new RegExp("^\\.("+M+")"),TAG:new RegExp("^("+M+"|[*])"),ATTR:new RegExp("^"+N),PSEUDO:new RegExp("^"+q),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+R+"*(even|odd|(([+-]|)(\\d*)n|)"+R+"*(?:([+-]|)"+R+"*(\\d+)|))"+R+"*\\)|)","i"),bool:new RegExp("^(?:"+F+")$","i"),needsContext:new RegExp("^"+R+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+R+"*((?:-\\d)?\\d*)"+R+"*\\)|)(?=[^-]|$)","i")},Q=/^(?:input|select|textarea|button)$/i,J=/^h\d$/i,Y=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,X=/[+~]/,ee=/'|\\/g,te=new RegExp("\\\\([\\da-f]{1,6}"+R+"?|("+R+")|.)","ig"),ie=function(e,t,i){var n="0x"+t-65536;return n!=n||i?t:n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320)};try{B.apply(j=z.call(_.childNodes),_.childNodes),j[_.childNodes.length].nodeType}catch(e){B={apply:j.length?function(e,t){I.apply(e,z.call(t))}:function(e,t){for(var i=e.length,n=0;e[i++]=t[n++];);e.length=i-1}}}function ne(e,t,n,r){var s,a,u,h,l,g,b,y,k,S;if((t?t.ownerDocument||t:_)!==p&&d(t),n=n||[],!e||"string"!=typeof e)return n;if(1!==(h=(t=t||p).nodeType)&&9!==h)return[];if(m&&!r){if(s=Z.exec(e))if(u=s[1]){if(9===h){if(!(a=t.getElementById(u))||!a.parentNode)return n;if(a.id===u)return n.push(a),n}else if(t.ownerDocument&&(a=t.ownerDocument.getElementById(u))&&v(t,a)&&a.id===u)return n.push(a),n}else{if(s[2])return B.apply(n,t.getElementsByTagName(e)),n;if((u=s[3])&&i.getElementsByClassName)return B.apply(n,t.getElementsByClassName(u)),n}if(i.qsa&&(!f||!f.test(e))){if(y=b=w,k=t,S=9===h&&e,1===h&&"object"!==t.nodeName.toLowerCase()){for(g=o(e),(b=t.getAttribute("id"))?y=b.replace(ee,"\\$&"):t.setAttribute("id",y),y="[id='"+y+"'] ",l=g.length;l--;)g[l]=y+ge(g[l]);k=X.test(e)&&de(t.parentNode)||t,S=g.join(",")}if(S)try{return B.apply(n,k.querySelectorAll(S)),n}catch(e){}finally{b||t.removeAttribute("id")}}}return c(e.replace(U,"$1"),t,n,r)}function re(){var e=[];return function t(i,r){return e.push(i+" ")>n.cacheLength&&delete t[e.shift()],t[i+" "]=r}}function se(e){return e[w]=!0,e}function oe(e){var t=p.createElement("div");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function ae(e,t){for(var i=e.split("|"),r=e.length;r--;)n.attrHandle[i[r]]=t}function ce(e,t){var i=t&&e,n=i&&1===e.nodeType&&1===t.nodeType&&(~t.sourceIndex||O)-(~e.sourceIndex||O);if(n)return n;if(i)for(;i=i.nextSibling;)if(i===t)return-1;return e?1:-1}function ue(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}function he(e){return function(t){var i=t.nodeName.toLowerCase();return("input"===i||"button"===i)&&t.type===e}}function le(e){return se((function(t){return t=+t,se((function(i,n){for(var r,s=e([],i.length,t),o=s.length;o--;)i[r=s[o]]&&(i[r]=!(n[r]=i[r]))}))}))}function de(e){return e&&typeof e.getElementsByTagName!==A&&e}for(t in i=ne.support={},s=ne.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return!!t&&"HTML"!==t.nodeName},d=ne.setDocument=function(e){var t,r=e?e.ownerDocument||e:_,o=r.defaultView;return r!==p&&9===r.nodeType&&r.documentElement?(p=r,g=r.documentElement,m=!s(r),o&&o!==o.top&&(o.addEventListener?o.addEventListener("unload",(function(){d()}),!1):o.attachEvent&&o.attachEvent("onunload",(function(){d()}))),i.attributes=oe((function(e){return e.className="i",!e.getAttribute("className")})),i.getElementsByTagName=oe((function(e){return e.appendChild(r.createComment("")),!e.getElementsByTagName("*").length})),i.getElementsByClassName=Y.test(r.getElementsByClassName),i.getById=oe((function(e){return g.appendChild(e).id=w,!r.getElementsByName||!r.getElementsByName(w).length})),i.getById?(n.find.ID=function(e,t){if(typeof t.getElementById!==A&&m){var i=t.getElementById(e);return i&&i.parentNode?[i]:[]}},n.filter.ID=function(e){var t=e.replace(te,ie);return function(e){return e.getAttribute("id")===t}}):(delete n.find.ID,n.filter.ID=function(e){var t=e.replace(te,ie);return function(e){var i=typeof e.getAttributeNode!==A&&e.getAttributeNode("id");return i&&i.value===t}}),n.find.TAG=i.getElementsByTagName?function(e,t){if(typeof t.getElementsByTagName!==A)return t.getElementsByTagName(e)}:function(e,t){var i,n=[],r=0,s=t.getElementsByTagName(e);if("*"===e){for(;i=s[r++];)1===i.nodeType&&n.push(i);return n}return s},n.find.CLASS=i.getElementsByClassName&&function(e,t){if(m)return t.getElementsByClassName(e)},b=[],f=[],(i.qsa=Y.test(r.querySelectorAll))&&(oe((function(e){e.innerHTML="<select msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&f.push("[*^$]="+R+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||f.push("\\["+R+"*(?:value|"+F+")"),e.querySelectorAll(":checked").length||f.push(":checked")})),oe((function(e){var t=r.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&f.push("name"+R+"*[*^$|!~]?="),e.querySelectorAll(":enabled").length||f.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),f.push(",.*:")}))),(i.matchesSelector=Y.test(y=g.matches||g.webkitMatchesSelector||g.mozMatchesSelector||g.oMatchesSelector||g.msMatchesSelector))&&oe((function(e){i.disconnectedMatch=y.call(e,"div"),y.call(e,"[s!='']:x"),b.push("!=",q)})),f=f.length&&new RegExp(f.join("|")),b=b.length&&new RegExp(b.join("|")),t=Y.test(g.compareDocumentPosition),v=t||Y.test(g.contains)?function(e,t){var i=9===e.nodeType?e.documentElement:e,n=t&&t.parentNode;return e===n||!(!n||1!==n.nodeType||!(i.contains?i.contains(n):e.compareDocumentPosition&&16&e.compareDocumentPosition(n)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},C=t?function(e,t){if(e===t)return l=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n||(1&(n=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!i.sortDetached&&t.compareDocumentPosition(e)===n?e===r||e.ownerDocument===_&&v(_,e)?-1:t===r||t.ownerDocument===_&&v(_,t)?1:h?D.call(h,e)-D.call(h,t):0:4&n?-1:1)}:function(e,t){if(e===t)return l=!0,0;var i,n=0,s=e.parentNode,o=t.parentNode,a=[e],c=[t];if(!s||!o)return e===r?-1:t===r?1:s?-1:o?1:h?D.call(h,e)-D.call(h,t):0;if(s===o)return ce(e,t);for(i=e;i=i.parentNode;)a.unshift(i);for(i=t;i=i.parentNode;)c.unshift(i);for(;a[n]===c[n];)n++;return n?ce(a[n],c[n]):a[n]===_?-1:c[n]===_?1:0},r):p},ne.matches=function(e,t){return ne(e,null,null,t)},ne.matchesSelector=function(e,t){if((e.ownerDocument||e)!==p&&d(e),t=t.replace(H,"='$1']"),i.matchesSelector&&m&&(!b||!b.test(t))&&(!f||!f.test(t)))try{var n=y.call(e,t);if(n||i.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){}return ne(t,p,null,[e]).length>0},ne.contains=function(e,t){return(e.ownerDocument||e)!==p&&d(e),v(e,t)},ne.attr=function(e,t){(e.ownerDocument||e)!==p&&d(e);var r=n.attrHandle[t.toLowerCase()],s=r&&P.call(n.attrHandle,t.toLowerCase())?r(e,t,!m):void 0;return void 0!==s?s:i.attributes||!m?e.getAttribute(t):(s=e.getAttributeNode(t))&&s.specified?s.value:null},ne.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},ne.uniqueSort=function(e){var t,n=[],r=0,s=0;if(l=!i.detectDuplicates,h=!i.sortStable&&e.slice(0),e.sort(C),l){for(;t=e[s++];)t===e[s]&&(r=n.push(s));for(;r--;)e.splice(n[r],1)}return h=null,e},r=ne.getText=function(e){var t,i="",n=0,s=e.nodeType;if(s){if(1===s||9===s||11===s){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)i+=r(e)}else if(3===s||4===s)return e.nodeValue}else for(;t=e[n++];)i+=r(t);return i},n=ne.selectors={cacheLength:50,createPseudo:se,match:K,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(te,ie),e[3]=(e[3]||e[4]||e[5]||"").replace(te,ie),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||ne.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&ne.error(e[0]),e},PSEUDO:function(e){var t,i=!e[6]&&e[2];return K.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":i&&V.test(i)&&(t=o(i,!0))&&(t=i.indexOf(")",i.length-t)-i.length)&&(e[0]=e[0].slice(0,t),e[2]=i.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(te,ie).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=T[e+" "];return t||(t=new RegExp("(^|"+R+")"+e+"("+R+"|$)"))&&T(e,(function(e){return t.test("string"==typeof e.className&&e.className||typeof e.getAttribute!==A&&e.getAttribute("class")||"")}))},ATTR:function(e,t,i){return function(n){var r=ne.attr(n,e);return null==r?"!="===t:!t||(r+="","="===t?r===i:"!="===t?r!==i:"^="===t?i&&0===r.indexOf(i):"*="===t?i&&r.indexOf(i)>-1:"$="===t?i&&r.slice(-i.length)===i:"~="===t?(" "+r+" ").indexOf(i)>-1:"|="===t&&(r===i||r.slice(0,i.length+1)===i+"-"))}},CHILD:function(e,t,i,n,r){var s="nth"!==e.slice(0,3),o="last"!==e.slice(-4),a="of-type"===t;return 1===n&&0===r?function(e){return!!e.parentNode}:function(t,i,c){var u,h,l,d,p,g,m=s!==o?"nextSibling":"previousSibling",f=t.parentNode,b=a&&t.nodeName.toLowerCase(),y=!c&&!a;if(f){if(s){for(;m;){for(l=t;l=l[m];)if(a?l.nodeName.toLowerCase()===b:1===l.nodeType)return!1;g=m="only"===e&&!g&&"nextSibling"}return!0}if(g=[o?f.firstChild:f.lastChild],o&&y){for(p=(u=(h=f[w]||(f[w]={}))[e]||[])[0]===k&&u[1],d=u[0]===k&&u[2],l=p&&f.childNodes[p];l=++p&&l&&l[m]||(d=p=0)||g.pop();)if(1===l.nodeType&&++d&&l===t){h[e]=[k,p,d];break}}else if(y&&(u=(t[w]||(t[w]={}))[e])&&u[0]===k)d=u[1];else for(;(l=++p&&l&&l[m]||(d=p=0)||g.pop())&&((a?l.nodeName.toLowerCase()!==b:1!==l.nodeType)||!++d||(y&&((l[w]||(l[w]={}))[e]=[k,d]),l!==t)););return(d-=r)===n||d%n==0&&d/n>=0}}},PSEUDO:function(e,t){var i,r=n.pseudos[e]||n.setFilters[e.toLowerCase()]||ne.error("unsupported pseudo: "+e);return r[w]?r(t):r.length>1?(i=[e,e,"",t],n.setFilters.hasOwnProperty(e.toLowerCase())?se((function(e,i){for(var n,s=r(e,t),o=s.length;o--;)e[n=D.call(e,s[o])]=!(i[n]=s[o])})):function(e){return r(e,0,i)}):r}},pseudos:{not:se((function(e){var t=[],i=[],n=a(e.replace(U,"$1"));return n[w]?se((function(e,t,i,r){for(var s,o=n(e,null,r,[]),a=e.length;a--;)(s=o[a])&&(e[a]=!(t[a]=s))})):function(e,r,s){return t[0]=e,n(t,null,s,i),!i.pop()}})),has:se((function(e){return function(t){return ne(e,t).length>0}})),contains:se((function(e){return e=e.replace(te,ie),function(t){return(t.textContent||t.innerText||r(t)).indexOf(e)>-1}})),lang:se((function(e){return G.test(e||"")||ne.error("unsupported lang: "+e),e=e.replace(te,ie).toLowerCase(),function(t){var i;do{if(i=m?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(i=i.toLowerCase())===e||0===i.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}})),target:function(t){var i=e.location&&e.location.hash;return i&&i.slice(1)===t.id},root:function(e){return e===g},focus:function(e){return e===p.activeElement&&(!p.hasFocus||p.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return!1===e.disabled},disabled:function(e){return!0===e.disabled},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!n.pseudos.empty(e)},header:function(e){return J.test(e.nodeName)},input:function(e){return Q.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:le((function(){return[0]})),last:le((function(e,t){return[t-1]})),eq:le((function(e,t,i){return[i<0?i+t:i]})),even:le((function(e,t){for(var i=0;i<t;i+=2)e.push(i);return e})),odd:le((function(e,t){for(var i=1;i<t;i+=2)e.push(i);return e})),lt:le((function(e,t,i){for(var n=i<0?i+t:i;--n>=0;)e.push(n);return e})),gt:le((function(e,t,i){for(var n=i<0?i+t:i;++n<t;)e.push(n);return e}))}},n.pseudos.nth=n.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})n.pseudos[t]=ue(t);for(t in{submit:!0,reset:!0})n.pseudos[t]=he(t);function pe(){}function ge(e){for(var t=0,i=e.length,n="";t<i;t++)n+=e[t].value;return n}function me(e,t,i){var n=t.dir,r=i&&"parentNode"===n,s=S++;return t.first?function(t,i,s){for(;t=t[n];)if(1===t.nodeType||r)return e(t,i,s)}:function(t,i,o){var a,c,u=[k,s];if(o){for(;t=t[n];)if((1===t.nodeType||r)&&e(t,i,o))return!0}else for(;t=t[n];)if(1===t.nodeType||r){if((a=(c=t[w]||(t[w]={}))[n])&&a[0]===k&&a[1]===s)return u[2]=a[2];if(c[n]=u,u[2]=e(t,i,o))return!0}}}function fe(e){return e.length>1?function(t,i,n){for(var r=e.length;r--;)if(!e[r](t,i,n))return!1;return!0}:e[0]}function be(e,t,i,n,r){for(var s,o=[],a=0,c=e.length,u=null!=t;a<c;a++)(s=e[a])&&(i&&!i(s,n,r)||(o.push(s),u&&t.push(a)));return o}function ye(e,t,i,n,r,s){return n&&!n[w]&&(n=ye(n)),r&&!r[w]&&(r=ye(r,s)),se((function(s,o,a,c){var u,h,l,d=[],p=[],g=o.length,m=s||function(e,t,i){for(var n=0,r=t.length;n<r;n++)ne(e,t[n],i);return i}(t||"*",a.nodeType?[a]:a,[]),f=!e||!s&&t?m:be(m,d,e,a,c),b=i?r||(s?e:g||n)?[]:o:f;if(i&&i(f,b,a,c),n)for(u=be(b,p),n(u,[],a,c),h=u.length;h--;)(l=u[h])&&(b[p[h]]=!(f[p[h]]=l));if(s){if(r||e){if(r){for(u=[],h=b.length;h--;)(l=b[h])&&u.push(f[h]=l);r(null,b=[],u,c)}for(h=b.length;h--;)(l=b[h])&&(u=r?D.call(s,l):d[h])>-1&&(s[u]=!(o[u]=l))}}else b=be(b===o?b.splice(g,b.length):b),r?r(null,o,b,c):B.apply(o,b)}))}function ve(e){for(var t,i,r,s=e.length,o=n.relative[e[0].type],a=o||n.relative[" "],c=o?1:0,h=me((function(e){return e===t}),a,!0),l=me((function(e){return D.call(t,e)>-1}),a,!0),d=[function(e,i,n){return!o&&(n||i!==u)||((t=i).nodeType?h(e,i,n):l(e,i,n))}];c<s;c++)if(i=n.relative[e[c].type])d=[me(fe(d),i)];else{if((i=n.filter[e[c].type].apply(null,e[c].matches))[w]){for(r=++c;r<s&&!n.relative[e[r].type];r++);return ye(c>1&&fe(d),c>1&&ge(e.slice(0,c-1).concat({value:" "===e[c-2].type?"*":""})).replace(U,"$1"),i,c<r&&ve(e.slice(c,r)),r<s&&ve(e=e.slice(r)),r<s&&ge(e))}d.push(i)}return fe(d)}return pe.prototype=n.filters=n.pseudos,n.setFilters=new pe,o=ne.tokenize=function(e,t){var i,r,s,o,a,c,u,h=x[e+" "];if(h)return t?0:h.slice(0);for(a=e,c=[],u=n.preFilter;a;){for(o in i&&!(r=W.exec(a))||(r&&(a=a.slice(r[0].length)||a),c.push(s=[])),i=!1,(r=$.exec(a))&&(i=r.shift(),s.push({value:i,type:r[0].replace(U," ")}),a=a.slice(i.length)),n.filter)!(r=K[o].exec(a))||u[o]&&!(r=u[o](r))||(i=r.shift(),s.push({value:i,type:o,matches:r}),a=a.slice(i.length));if(!i)break}return t?a.length:a?ne.error(e):x(e,c).slice(0)},a=ne.compile=function(e,t){var i,r=[],s=[],a=E[e+" "];if(!a){for(t||(t=o(e)),i=t.length;i--;)(a=ve(t[i]))[w]?r.push(a):s.push(a);a=E(e,function(e,t){var i=t.length>0,r=e.length>0,s=function(s,o,a,c,h){var l,d,g,m=0,f="0",b=s&&[],y=[],v=u,w=s||r&&n.find.TAG("*",h),_=k+=null==v?1:Math.random()||.1,S=w.length;for(h&&(u=o!==p&&o);f!==S&&null!=(l=w[f]);f++){if(r&&l){for(d=0;g=e[d++];)if(g(l,o,a)){c.push(l);break}h&&(k=_)}i&&((l=!g&&l)&&m--,s&&b.push(l))}if(m+=f,i&&f!==m){for(d=0;g=t[d++];)g(b,y,o,a);if(s){if(m>0)for(;f--;)b[f]||y[f]||(y[f]=L.call(c));y=be(y)}B.apply(c,y),h&&!s&&y.length>0&&m+t.length>1&&ne.uniqueSort(c)}return h&&(k=_,u=v),b};return i?se(s):s}(s,r)),a.selector=e}return a},c=ne.select=function(e,t,r,s){var c,u,h,l,d,p="function"==typeof e&&e,g=!s&&o(e=p.selector||e);if(r=r||[],1===g.length){if((u=g[0]=g[0].slice(0)).length>2&&"ID"===(h=u[0]).type&&i.getById&&9===t.nodeType&&m&&n.relative[u[1].type]){if(!(t=(n.find.ID(h.matches[0].replace(te,ie),t)||[])[0]))return r;p&&(t=t.parentNode),e=e.slice(u.shift().value.length)}for(c=K.needsContext.test(e)?0:u.length;c--&&(h=u[c],!n.relative[l=h.type]);)if((d=n.find[l])&&(s=d(h.matches[0].replace(te,ie),X.test(u[0].type)&&de(t.parentNode)||t))){if(u.splice(c,1),!(e=s.length&&ge(u)))return B.apply(r,s),r;break}}return(p||a(e,g))(s,t,!m,r,X.test(e)&&de(t.parentNode)||t),r},i.sortStable=w.split("").sort(C).join("")===w,i.detectDuplicates=!!l,d(),i.sortDetached=oe((function(e){return 1&e.compareDocumentPosition(p.createElement("div"))})),oe((function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")}))||ae("type|href|height|width",(function(e,t,i){if(!i)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)})),i.attributes&&oe((function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")}))||ae("value",(function(e,t,i){if(!i&&"input"===e.nodeName.toLowerCase())return e.defaultValue})),oe((function(e){return null==e.getAttribute("disabled")}))||ae(F,(function(e,t,i){var n;if(!i)return!0===e[t]?t.toLowerCase():(n=e.getAttributeNode(t))&&n.specified?n.value:null})),ne}(window);class pi{constructor(e,t){this.tracing=e,this.documentContentLoaded=t}materializeValue(e,t){if("constant"===e.type)return e.value;try{let i,n;if(n="string"==typeof e.selector?{selector:e.selector,type:"css"}:e.selector,"target"===n.type){if(null==t)return null;i=[t]}else if("target_css"===n.type){if(null==t)return null;i=di(n.selector,t)}else i=di(n.selector);if(0===i.length)return null;const r=this._fetchRawValueFromElementList(e,i);return this._applyValueConverter(r,e.converter)}catch(e){if(!(e instanceof Error))throw e}return null}materializeProperties(e,t,i){this.tracing.tracePromise(this.documentContentLoaded.whenLoaded()).then((()=>{const n={};e.forEach((({key:e,value:i})=>{n[e]=this.materializeValue(i,t)})),i(n)}))}materializeIds(e,t,i){this.tracing.tracePromise(this.documentContentLoaded.whenLoaded()).then((()=>{if("anonymous"===e.type)i({});else if("registered"===e.type){const n=this.materializeValue(e.id,t);i(null===n?{}:{registered:n})}}))}_fetchRawValueFromElementList(e,t){const i=t[0];return i instanceof Element?"from_html"===e.type?i.innerHTML:"value"===e.attribute&&i instanceof HTMLInputElement?""!==i.value?i.value:null:i.getAttribute(e.attribute):null}_applyValueConverter(e,t){return e&&t&&"replace"===t.type?e.replace(new RegExp(t.regex,"gm"),t.replace):e}}
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */function gi(e,t,i,n){var r,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,i,o):r(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o}function mi(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function fi(e,t,i,n){return new(i||(i=Promise))((function(r,s){function o(e){try{c(n.next(e))}catch(e){s(e)}}function a(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){e.done?r(e.value):new i((function(t){t(e.value)})).then(o,a)}c((n=n.apply(e,t||[])).next())}))}var bi=Object.prototype.hasOwnProperty;function yi(e,t,i){var n=e[t];bi.call(e,t)&&Te(n,i)&&(void 0!==i||t in e)||hi(e,t,i)}function vi(e,t,i,n){var r=!i;i||(i={});for(var s=-1,o=t.length;++s<o;){var a=t[s],c=n?n(i[a],e[a],a,i,e):void 0;void 0===c&&(c=e[a]),r?hi(i,a,c):yi(i,a,c)}return i}var wi=Object.prototype.hasOwnProperty;function _i(e){if(!ge(e))return function(e){var t=[];if(null!=e)for(var i in Object(e))t.push(i);return t}(e);var t=ue(e),i=[];for(var n in e)("constructor"!=n||!t&&wi.call(e,n))&&i.push(n);return i}function ki(e){return fe(e)?ae(e,!0):_i(e)}var Si="object"==typeof exports&&exports&&!exports.nodeType&&exports,Ti=Si&&"object"==typeof module&&module&&!module.nodeType&&module,xi=Ti&&Ti.exports===Si?A.Buffer:void 0,Ei=xi?xi.allocUnsafe:void 0;function Ci(e,t){if(t)return e.slice();var i=e.length,n=Ei?Ei(i):new e.constructor(i);return e.copy(n),n}function Ai(e,t){var i=-1,n=e.length;for(t||(t=Array(n));++i<n;)t[i]=e[i];return t}var Oi=he(Object.getPrototypeOf,Object),Pi=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)nt(t,ut(e)),e=Oi(e);return t}:st,ji=Pi;function Li(e){return rt(e,ki,ji)}var Ii=Object.prototype.hasOwnProperty;function Bi(e){var t=new e.constructor(e.byteLength);return new Ze(t).set(new Ze(e)),t}var zi=/\w*$/;var Di=O?O.prototype:void 0,Fi=Di?Di.valueOf:void 0;function Ri(e,t){var i=t?Bi(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.length)}function Mi(e,t,i){var n,r=e.constructor;switch(t){case"[object ArrayBuffer]":return Bi(e);case"[object Boolean]":case"[object Date]":return new r(+e);case"[object DataView]":return function(e,t){var i=t?Bi(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.byteLength)}(e,i);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return Ri(e,i);case"[object Map]":case"[object Set]":return new r;case"[object Number]":case"[object String]":return new r(e);case"[object RegExp]":return function(e){var t=new e.constructor(e.source,zi.exec(e));return t.lastIndex=e.lastIndex,t}(e);case"[object Symbol]":return n=e,Fi?Object(Fi.call(n)):{}}}var Ni=Object.create,qi=function(){function e(){}return function(t){if(!ge(t))return{};if(Ni)return Ni(t);e.prototype=t;var i=new e;return e.prototype=void 0,i}}(),Ui=qi;function Wi(e){return"function"!=typeof e.constructor||ue(e)?{}:Ui(Oi(e))}var $i=ne&&ne.isMap,Hi=$i?X($i):function(e){return F(e)&&"[object Map]"==Ct(e)};var Vi=ne&&ne.isSet,Gi=Vi?X(Vi):function(e){return F(e)&&"[object Set]"==Ct(e)},Ki="[object Arguments]",Qi="[object Function]",Ji="[object Object]",Yi={};function Zi(e,t,i,n,r,s){var o,a=1&t,c=2&t,u=4&t;if(i&&(o=r?i(e,n,r,s):i(e)),void 0!==o)return o;if(!ge(e))return e;var h=$(e);if(h){if(o=function(e){var t=e.length,i=new e.constructor(t);return t&&"string"==typeof e[0]&&Ii.call(e,"index")&&(i.index=e.index,i.input=e.input),i}(e),!a)return Ai(e,o)}else{var l=Ct(e),d=l==Qi||"[object GeneratorFunction]"==l;if(K(e))return Ci(e,a);if(l==Ji||l==Ki||d&&!r){if(o=c||d?{}:Wi(e),!a)return c?function(e,t){return vi(e,ji(e),t)}(e,function(e,t){return e&&vi(t,ki(t),e)}(o,e)):function(e,t){return vi(e,ut(e),t)}(e,function(e,t){return e&&vi(t,be(t),e)}(o,e))}else{if(!Yi[l])return r?e:{};o=Mi(e,l,a)}}s||(s=new Ke);var p=s.get(e);if(p)return p;s.set(e,o),Gi(e)?e.forEach((function(n){o.add(Zi(n,t,i,n,e,s))})):Hi(e)&&e.forEach((function(n,r){o.set(r,Zi(n,t,i,r,e,s))}));var g=h?void 0:(u?c?Li:ht:c?ki:be)(e);return S(g||e,(function(n,r){g&&(n=e[r=n]),yi(o,r,Zi(n,t,i,r,e,s))})),o}Yi[Ki]=Yi["[object Array]"]=Yi["[object ArrayBuffer]"]=Yi["[object DataView]"]=Yi["[object Boolean]"]=Yi["[object Date]"]=Yi["[object Float32Array]"]=Yi["[object Float64Array]"]=Yi["[object Int8Array]"]=Yi["[object Int16Array]"]=Yi["[object Int32Array]"]=Yi["[object Map]"]=Yi["[object Number]"]=Yi[Ji]=Yi["[object RegExp]"]=Yi["[object Set]"]=Yi["[object String]"]=Yi["[object Symbol]"]=Yi["[object Uint8Array]"]=Yi["[object Uint8ClampedArray]"]=Yi["[object Uint16Array]"]=Yi["[object Uint32Array]"]=!0,Yi["[object Error]"]=Yi[Qi]=Yi["[object WeakMap]"]=!1;var Xi,en,tn;function nn(e){return Zi(e,5)}function rn(e){Object.keys(e).forEach((t=>{switch(typeof e[t]){case"object":e[t]&&rn(e[t]);break;case"function":e[t]=String(e[t])}}))}function sn(e){return("0"+e.toString(16)).slice(-2)}function on(e,t=window){if(e%2)throw new Error("The length of the random string should be an even number!");const i=t.crypto||t.msCrypto;if(i&&i.getRandomValues&&Array.from){const t=new Uint8Array(e/2);return i.getRandomValues(t),Array.from(t,sn).join("")}let n="";for(let t=0;t<e/2;t++)n+=sn(Math.round(256*Math.random()));return n}function an(e,t,i,n=""){if(!i)return"Other";const r=!!e.opr&&!!e.opr.addons||!!e.opera||/ OPR\//.test(i),s=!!!t.documentMode&&!!e.StyleMedia;
// @cc_on!@
if(r)return/Mini/.test(i)?"Opera Mini":"Opera";if(s)return"Microsoft Edge";return/SAMSUNG|SGH-[I|N|T]|GT-[I|P|N]|SM-[N|P|T|Z|G]|SHV-E|SCH-[I|J|R|S]|SPH-L/i.test(i)?"Samsung Browser":/Chrome/.test(i)?"Chrome":/Apple/.test(n)?/Mobile/.test(i)?"Mobile Safari":"Safari":/Android/.test(i)?"Android Mobile":/Konqueror/.test(i)?"Konqueror":/Firefox/.test(i)?"Firefox":/MSIE/.test(i)||/Trident/.test(i)?"Internet Explorer":/Gecko/.test(i)?"Mozilla":"Other"}function cn(e){if(!e)return"Other";const t={iPhone:"iPhone",iPad:"iPad",iPod:"iPod","Windows Phone":"Windows Phone",Android:"Android",BlackBerry:"(BlackBerry|BB10|PlayBook)"};for(const i in t){if(!t.hasOwnProperty(i))continue;if(new RegExp(t[i],"i").test(e))return i}return"Other"}function un(e,t){return{os:(i=e.navigator.userAgent,i?/Windows/i.test(i)?/Phone/.test(i)?"Windows Mobile":"Windows":/(iPhone|iPad|iPod)/.test(i)?"iOS":/Android/.test(i)?"Android":/Mac/i.test(i)?"Mac OS X":/Linux/.test(i)?"Linux":"Other":"Other"),browser:an(e,t,e.navigator.userAgent,e.navigator.vendor),device:cn(e.navigator.userAgent)};var i}function hn(e){return ge(e)&&me(e.remove)}!function(e){e.str2ab8=function(e){const t=new ArrayBuffer(e.length),i=new Uint8Array(t);for(let t=0,n=e.length;t<n;t++)i[t]=e.charCodeAt(t);return t},e.str2ab16=function(e){const t=new ArrayBuffer(2*e.length),i=new Uint16Array(t);for(let t=0,n=e.length;t<n;t++)i[t]=e.charCodeAt(t);return t}}(Xi||(Xi={})),function(e){e.Handler=class{constructor(e,t){this.window=e,this.debug=t,this.isInitialized=new Promise((e=>{this.resolveInitialization=e}))}initialize(){return fi(this,void 0,void 0,(function*(){if(!this.window.crypto||!this.window.crypto.subtle)return this.debug.log("Crypto API is not available in this browser, browser extension communication is disabled"),void this.resolveInitialization(!1);const e=Xi.str2ab8(this.window.atob("MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEApOsQPnGejMMA3SWpmByzZaXlSla2IK2NLV11r4/Qd8MgjvT63cNkM/j3w2E/fCJ1C+cdDPTCZcXgUVFdSXvVAEmNscx/3SZBCvAfXVYUj3fkk00XPO425cSQ6368/fEoa8ocqFtHwSlHyaWZBerp6tfawkhvzJSk8sSfQB0slMyy/IsPQU/jwE9sCKjvPO3QcSTvslTyKSIVeVrxOMULA7HT2u9XaVzGd45l8KxdLfTd7o1XHBw2meA566tQ65Po/wy/3ycM7b8LXG6e+I7xCrHudTlLRVISkSx4Uh4XLJF47EwRIVCvtosY7AENjzLV56D9INCeVBv8GraYPtXJQ3iF65v4bPq8kjm+RNUWxzzLYpJ/tt5Utx5ZVogtN18iObVmw+sR+yY3rJOohUyPwSEhNRfQ9qGEJAImUuqOU6HSUHDD2QDfonsHKPwfEN1l5q3oyMIe73yjtulTUkk0MVPvV0F/v7kwLGZDyoskZ6aDuhSDJf/UTxCjzpbtuYX6VUQyid0X3Dr7fswvFn9ucZydNTW1ZOC/nszmu7Rl+Fk+OsEcTLM0CfZP+1n+bd17+UtIAl4rChmJGhEyz4c4/TFuACcaz8vlIeNZ+9MbXZ1VbI9kOB6roQzGQ2qpirKk1dtrV1Lb/6ODixSGtJ0ShcH7y0icxR8HK71j+oT4mN0CAwEAAQ==".trim())),t=this.window.crypto.subtle.importKey("spki",e,{name:"RSA-OAEP",hash:"SHA-256"},!0,["wrapKey"]),i=this.window.crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt"]),n=Promise.all([t,i]).then((([e,t])=>this.window.crypto.subtle.wrapKey("raw",t,e,{name:"RSA-OAEP"})));this.keys=Promise.all([i,n]).then((([e,t])=>({aes:e,aesEncrypted:t}))),t.catch((e=>{this.debug.error("Failed to import the encryption key used in BrowserExtension.Handler:",e)})),i.catch((e=>{this.debug.error("Failed to generate the encryption key used in BrowserExtension.Handler:",e)})),n.catch((e=>{this.debug.error("Failed to wrap the encryption key used in BrowserExtension.Handler:",e)})),yield this.keys.then((()=>this.resolveInitialization(!0)),(e=>{throw this.resolveInitialization(!1),e}))}))}sendPayload(e,t={type:"success"},i=Date.now()){const n=on(32,this.window),r=this.sendMessage({type:"payload",id:n,timestamp:i,state:t,payload:e});return e=>{(()=>{fi(this,void 0,void 0,(function*(){yield r,yield this.updateState(n,e)}))})()}}updateState(e,t){return fi(this,void 0,void 0,(function*(){yield this.sendMessage({type:"stateupdate",target:e,state:t})}))}sendMessage(e){return fi(this,void 0,void 0,(function*(){if(!(yield this.isInitialized))return;if(!this.keys)throw new Error("BrowserExtension.Handler's keys must be assigned when initialization is resolved!");const t=nn(e);rn(t);const i=Xi.str2ab16(JSON.stringify(t)),n=this.window.crypto.getRandomValues(new Uint8Array(16)).buffer;let r,s,o;try{({aes:r,aesEncrypted:s}=yield this.keys)}catch(e){return}try{o=yield this.window.crypto.subtle.encrypt({name:"AES-GCM",iv:n},r,i)}catch(e){return void this.debug.error("Failed to encrypt the data before sending it to the extension:",e)}try{this.window.postMessage({data:o,key:s,iv:n,version:"webxp-js-client-message:v2"},"*")}catch(e){this.debug.error("Failed to send the encrypted data:",e)}}))}}}(en||(en={})),function(e){e.Ids="system/ids",e.Time="system/time",e.Tracking="system/tracking",e.Clicks="campaigns/clicks",e.Customers="crm/customers",e.Events="crm/events",e.PushNotificationsVapidKey="system/push-notifications-vapid-key"}(tn||(tn={}));const ln=new RegExp("[?&]+xnpe_cmp=([^&]*)","gi");class dn{constructor(e,t,i,n,r,s,o,a){this.location=e,this.queue=t,this.config=i,this.timestamp=n,this.time=r,this.debug=s,this.window=o,this.document=a}parseUrlAndTrackCampaignClick(){const e=this.getCampaignClickTokenFromUrl();e&&this.trackClickEventWithToken(e)}getCampaignClickTokenFromUrl(){if(this.debug.log("Getting campaign click token from the URL"),this.location.search){const e=this.location.search.match(ln);if(e)return e[0].split("=")[1]}return null}trackClickEventWithToken(e){const t=this.timestamp.getTimestamp();this.debug.log("Tracking campaign click with token",e),this.queue.enqueue({name:tn.Clicks,prepareData:e=>({data:{company_id:this.config.getToken(),age:e-t,url:this.location.href,timestamp:this.time.isTimeInitialized()?this.timestamp.getTimestampWithOffset():void 0,properties:un(this.window,this.document)}})})}}function pn(e,t,i){switch(i.length){case 0:return e.call(t);case 1:return e.call(t,i[0]);case 2:return e.call(t,i[0],i[1]);case 3:return e.call(t,i[0],i[1],i[2])}return e.apply(t,i)}var gn=Math.max;var mn=ui?function(e,t){return ui(e,"toString",{configurable:!0,enumerable:!1,value:(i=t,function(){return i}),writable:!0});var i}:_e,fn=mn,bn=Date.now;var yn=function(e){var t=0,i=0;return function(){var n=bn(),r=16-(n-i);if(i=n,r>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}(fn),vn=yn;function wn(e,t){return vn(function(e,t,i){return t=gn(void 0===t?e.length-1:t,0),function(){for(var n=arguments,r=-1,s=gn(n.length-t,0),o=Array(s);++r<s;)o[r]=n[t+r];r=-1;for(var a=Array(t+1);++r<t;)a[r]=n[r];return a[t]=i(o),pn(e,this,a)}}(e,t,_e),e+"")}function _n(e,t,i){if(!ge(i))return!1;var n=typeof t;return!!("number"==n?fe(i)&&J(t,i.length):"string"==n&&t in i)&&Te(i[t],e)}var kn=Object.prototype,Sn=kn.hasOwnProperty,Tn=wn((function(e,t){e=Object(e);var i=-1,n=t.length,r=n>2?t[2]:void 0;for(r&&_n(t[0],t[1],r)&&(n=1);++i<n;)for(var s=t[i],o=ki(s),a=-1,c=o.length;++a<c;){var u=o[a],h=e[u];(void 0===h||Te(h,kn[u])&&!Sn.call(e,u))&&(e[u]=s[u])}return e}));function xn(e,t,i){(void 0!==i&&!Te(e[t],i)||void 0===i&&!(t in e))&&hi(e,t,i)}var En=Function.prototype,Cn=Object.prototype,An=En.toString,On=Cn.hasOwnProperty,Pn=An.call(Object);function jn(e){if(!F(e)||"[object Object]"!=D(e))return!1;var t=Oi(e);if(null===t)return!0;var i=On.call(t,"constructor")&&t.constructor;return"function"==typeof i&&i instanceof i&&An.call(i)==Pn}function Ln(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}function In(e,t,i,n,r,s,o){var a=Ln(e,i),c=Ln(t,i),u=o.get(c);if(u)xn(e,i,u);else{var h,l=s?s(a,c,i+"",e,t,o):void 0,d=void 0===l;if(d){var p=$(c),g=!p&&K(c),m=!p&&!g&&se(c);l=c,p||g||m?$(a)?l=a:F(h=a)&&fe(h)?l=Ai(a):g?(d=!1,l=Ci(c,!0)):m?(d=!1,l=Ri(c,!0)):l=[]:jn(c)||W(c)?(l=a,W(a)?l=function(e){return vi(e,ki(e))}(a):ge(a)&&!me(a)||(l=Wi(c))):d=!1}d&&(o.set(c,l),r(l,c,n,s,o),o.delete(c)),xn(e,i,l)}}function Bn(e,t,i,n,r){e!==t&&x(t,(function(s,o){if(r||(r=new Ke),ge(s))In(e,t,o,i,Bn,n,r);else{var a=n?n(Ln(e,o),s,o+"",e,t,r):void 0;void 0===a&&(a=s),xn(e,o,a)}}),ki)}function zn(e,t,i,n,r,s){return ge(e)&&ge(t)&&(s.set(t,e),Bn(e,t,void 0,zn,s),s.delete(t)),e}var Dn,Fn=(Dn=function(e,t,i,n){Bn(e,t,i,n)},wn((function(e,t){var i=-1,n=t.length,r=n>1?t[n-1]:void 0,s=n>2?t[2]:void 0;for(r=Dn.length>3&&"function"==typeof r?(n--,r):void 0,s&&_n(t[0],t[1],s)&&(r=n<3?void 0:r,n=1),e=Object(e);++i<n;){var o=t[i];o&&Dn(e,o,i,r)}return e}))),Rn=wn((function(e){return e.push(void 0,zn),pn(Fn,void 0,e)})),Mn=/\s/;var Nn=/^\s+/;function qn(e){return e?e.slice(0,function(e){for(var t=e.length;t--&&Mn.test(e.charAt(t)););return t}(e)+1).replace(Nn,""):e}var Un=/^[-+]0x[0-9a-f]+$/i,Wn=/^0b[01]+$/i,$n=/^0o[0-7]+$/i,Hn=parseInt;function Vn(e){if("number"==typeof e)return e;if(Ft(e))return NaN;if(ge(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=ge(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=qn(e);var i=Wn.test(e);return i||$n.test(e)?Hn(e.slice(2),i?2:8):Un.test(e)?NaN:+e}var Gn=1/0;function Kn(e){var t=function(e){return e?(e=Vn(e))===Gn||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}(e),i=t%1;return t==t?i?t-i:t:0}function Qn(e){return e!=e}function Jn(e,t,i){var n=-1,r=e.length;t<0&&(t=-t>r?0:r+t),(i=i>r?r:i)<0&&(i+=r),r=t>i?0:i-t>>>0,t>>>=0;for(var s=Array(r);++n<r;)s[n]=e[n+t];return s}function Yn(e){return Zi(e,4)}var Zn=function(){return A.Date.now()},Xn=Math.max,er=Math.min;function tr(e,t,i){var n,r,s,o,a,c,u=0,h=!1,l=!1,d=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function p(t){var i=n,s=r;return n=r=void 0,u=t,o=e.apply(s,i)}function g(e){return u=e,a=setTimeout(f,t),h?p(e):o}function m(e){var i=e-c;return void 0===c||i>=t||i<0||l&&e-u>=s}function f(){var e=Zn();if(m(e))return b(e);a=setTimeout(f,function(e){var i=t-(e-c);return l?er(i,s-(e-u)):i}(e))}function b(e){return a=void 0,d&&n?p(e):(n=r=void 0,o)}function y(){var e=Zn(),i=m(e);if(n=arguments,r=this,c=e,i){if(void 0===a)return g(c);if(l)return clearTimeout(a),a=setTimeout(f,t),p(c)}return void 0===a&&(a=setTimeout(f,t)),o}return t=Vn(t)||0,ge(i)&&(h=!!i.leading,s=(l="maxWait"in i)?Xn(Vn(i.maxWait)||0,t):s,d="trailing"in i?!!i.trailing:d),y.cancel=function(){void 0!==a&&clearTimeout(a),u=0,n=c=r=a=void 0},y.flush=function(){return void 0===a?o:b(Zn())},y}function ir(e,t){for(var i=null==e?0:e.length;i--&&!1!==t(e[i],i,e););return e}var nr=T(!0);var rr=ve((function(e,t){return e&&nr(e,t,be)}),!0);function sr(e,t){return e&&ye(e,ke(t))}function or(e){return"string"==typeof e||!$(e)&&F(e)&&"[object String]"==D(e)}function ar(e){return null==e?[]:function(e,t){return Qt(t,(function(t){return e[t]}))}(e,be(e))}var cr=Math.max;function ur(e,t,i,n){e=fe(e)?e:ar(e),i=i&&!n?Kn(i):0;var r=e.length;return i<0&&(i=cr(r+i,0)),or(e)?i<=r&&e.indexOf(t,i)>-1:!!r&&function(e,t,i){return t==t?function(e,t,i){for(var n=i-1,r=e.length;++n<r;)if(e[n]===t)return n;return-1}(e,t,i):function(e,t,i,n){for(var r=e.length,s=i+(n?1:-1);n?s--:++s<r;)if(t(e[s],s,e))return s;return-1}(e,Qn,i)}(e,t,i)>-1}var hr=ne&&ne.isDate,lr=hr?X(hr):function(e){return F(e)&&"[object Date]"==D(e)},dr=Object.prototype.hasOwnProperty;function pr(e,t){var i;return we(e,(function(e,n,r){return!(i=t(e,n,r))})),!!i}function gr(e,t){return e&&e.length?function(e,t,i,n){for(var r=e.length,s=n?r:-1;(n?s--:++s<r)&&t(e[s],s,e););return i?Jn(e,n?0:s,n?s+1:r):Jn(e,n?s+1:0,n?r:s)}(e,ai(t)):[]}const mr=94608e3,fr=94608e3,br=Object.freeze({hide_class:"xnpe_async_hide",timeout:4e3,mode:"async"});class yr{constructor(e,t,i={}){this.database=e,this.logger=t,this.options=yr.DEFAULT_OPTIONS,this.extendOptions(i)}getOptions(){return this.options}getToken(){if("string"!=typeof this.options.token)throw new Error("The token in config object is not set!");return this.options.token}getNewExperimentsOptions(){const e=this.getOptions().new_experiments;return!!e&&(!0===e?br:Tn(e,br))}getActivityHandlerOptions(){const e=this.getOptions().ping.activity;return"object"==typeof e?e:{click:!0,key:!0,scroll:!0,move:!0}}extendOptions(e){void 0!==e.track_hash_changes&&this.logger.warn("Configuration option track_hash_changes is deprecated, use the spa_reloading.on_hash_change option instead"),this.options=Rn({},e,this.options)}setNewCustomerIds(e){this.options.customer=e}isSpaReloadingEnabled(e){return!0===this.getOptions().spa_reloading||!1!==this.getOptions().spa_reloading[e]}storeInIndexedDB(){if(!this.database.isSupported())return Promise.reject(new Error("Database is not supported!"));const e=nn(this.getOptions());return rn(e),this.database.setItem("config",e)}}yr.DEFAULT_OPTIONS=Object.freeze({target:"//api.exponea.com",token:null,utm_always:!1,customer:{},ping:{enabled:!0,interval:120,activity:!1,properties:{}},lazy_merge:!1,track:{auto:!0,visits:!1,visits_query_params:["pers_position","pers_content"],activity:!1,unloads:!1,exits:!0,default_properties:{},google_analytics:!0},modify:{enabled:!0,overlay:!1,delay:500},cookies:{cross_subdomain:!0,retrieve_callback:null,expires:{tracking:mr,ab_test:fr,time:3600}},track_hash_changes:!0,transfer_identity:!0,error_reporting:"errors_only",debug:!1,utm_params:["utm_source","utm_medium","utm_campaign","utm_term","utm_content","gclid","campaign_id"],dependencies:{},webOptimization:!0,push:{safari:{websitePushID:null}},spa_reloading:!0,feature_flags:null,service_worker_path:"/service-worker.js",exposed_segments:{ttl:3e5,prefetch:!1,notify:!1,segmentation_processing_delay:5e3},compliance:{opt_in:!1},link_cookie:!1});class vr{constructor(e,t){this.config=e,this.http=t}rewardBandit(e,t,i,n){const r=this.config.getOptions().target;this.http.post(`${r}/webxp/bandits/reward`,{reward_token:e,value:t},{credentials:"omit",responseType:"text"}).then((e=>e.body)).then(i,n)}}var wr,_r,kr,Sr,Tr;function xr(e){return function(i,n){try{const r=n.attribute.property,s=n.constraint.type,o=n.constraint.operator,a=n.constraint.operands;if(wr.whitelist.indexOf(o)>-1)return function(e,t,i,n){const r=e[i];switch(n){case wr.isSet:return null!=r;case wr.isNotSet:return null==r;case wr.hasValue:return Er(t)?(null==r?void 0:r.length)>0:r+""!="";case wr.hasNoValue:return Er(t)?0===(null==r?void 0:r.length):r+""==""}return!1}(i,s,r,o);if(function(e){return"string"===e}(s))return function(e,i,n,r){if(-1===_r.whitelist.indexOf(n))return t(n,"string"),!1;const s=e[i]+"";let o;switch(n){case _r.equals:return s===r[0].value;case _r.doesNotEqual:return s!==r[0].value;case _r.isIn:return o=r.map((e=>e.value)),o.indexOf(s)>-1;case _r.isNotIn:return o=r.map((e=>e.value)),-1===o.indexOf(s);case _r.contains:return s.indexOf(r[0].value)>-1;case _r.doesNotContain:return-1===s.indexOf(r[0].value);case _r.startsWith:return s.startsWith(r[0].value);case _r.endsWith:return s.endsWith(r[0].value)}return!1}(i,r,o,a);if(function(e){return"number"===e}(s))return function(e,i,n,r){if(-1===kr.whitelist.indexOf(n))return t(n,"number"),!1;const s=parseFloat(e[i]+""),o=parseFloat(r[0].value);switch(n){case kr.equalTo:return s===o;case kr.inBetween:return o<=s&&s<=parseFloat(r[1].value);case kr.lessThan:return s<o;case kr.greaterThan:return s>o}return!1}(i,r,o,a);if(function(e){return"boolean"===e}(s))return function(e,i,n,r){if(-1===Sr.whitelist.indexOf(n))return t(n,"boolean"),!1;const s=e[i]+"",o=r.value+"";if(n===Sr.is)return s===o;return!1}(i,r,o,n.constraint);(function(e){return"date"===e})(s)&&e.error("Contextual bandits: Date type is not supported."),Er(s)&&e.error("Contextual bandits: List type is not supported.")}catch(t){e.debug("Event filter error:",t)}return!1};function t(t,i){e.error("Contextual Bandits: operation "+t+" not suported for type "+i+".")}}function Er(e){return"list"===e}!function(e){e.isSet="is set",e.isNotSet="is not set",e.hasValue="has value",e.hasNoValue="has no value",e.whitelist=[e.isSet,e.isNotSet,e.hasValue,e.hasNoValue]}(wr||(wr={})),function(e){e.equals="equals",e.doesNotEqual="does not equal",e.isIn="in",e.isNotIn="not in",e.contains="contains",e.doesNotContain="does not contain",e.startsWith="starts with",e.endsWith="ends with",e.whitelist=[e.equals,e.doesNotEqual,e.isIn,e.isNotIn,e.contains,e.doesNotContain,e.startsWith,e.endsWith]}(_r||(_r={})),function(e){e.equalTo="equal to",e.inBetween="in between",e.lessThan="less than",e.greaterThan="greater than",e.whitelist=[e.equalTo,e.inBetween,e.lessThan,e.greaterThan]}(kr||(kr={})),function(e){e.is="is",e.whitelist=[e.is]}(Sr||(Sr={}));class Cr{constructor(e,t){this.contextualBandit=e,this.debug=t,this.optimizationTargets=[],this.eventFilterMatcher=xr(this.debug)}put(e,t,i,n){if(""===e)throw new Error("Event type can't be an empty string");if(""===i)throw new Error("Reward token can't be an empty string");this.optimizationTargets.push({eventType:e,eventFilters:t,rewardToken:i,rewardWeight:n})}reward(e,t){const{matchingTargets:i,remainingTargets:n}=this.optimizationTargets.reduce(function(e,t,i){return function(n,r){return r.eventType!==i?(n.remainingTargets.push(r),n):r.eventFilters.reduce(((i,n)=>i&&t(e,n)),!0)?(n.matchingTargets.push(r),n):(n.remainingTargets.push(r),n)}}(e,this.eventFilterMatcher,t),{matchingTargets:[],remainingTargets:[]});i.forEach((e=>{this.contextualBandit.rewardBandit(e.rewardToken,e.rewardWeight)})),this.optimizationTargets=n}}function Ar(e){if("number"!=typeof e)return e;const t=new Date;return new Date(t.getTime()+1e3*e)}!function(e){e[e.defer=0]="defer",e[e.immediate=1]="immediate"}(Tr||(Tr={}));class Or{constructor(e,t,i,n,r,s,o){this.config=e,this.debug=t,this.logger=i,this.queue=n,this.location=r,this.document=s,this.segments=o}getCookie(e){const t=this.document.cookie?this.document.cookie.split("; "):[];for(let i=0,n=t.length;i<n;i++){const n=t[i].split("="),r=n.shift();if(r){const t=decodeURIComponent(r),i=n.join("=");if(e===t)return this.parseCookieValue(i)}}}setCookie(e,t,i){let n=this.config.getOptions().cookies.expires[i];n=Ar(n);const r=function(e,t=document.location.hostname){if(!e)return"";if(or(e))return e;const i=t.match(/[a-z0-9][a-z0-9\-]+\.[a-z\.]{2,6}$/i),n=i?i[0]:"";return n||""}(this.config.getOptions().cookies.cross_subdomain);this.document.cookie=[encodeURIComponent(e),"=",encodeURIComponent(t),"; expires="+n.toUTCString(),"; path=/",r?"; domain="+r:"","https:"===this.location.protocol?"; secure; samesite=none":"; samesite=lax"].join("")}sendCustomerCookieToServer(e){this.queue.enqueue({name:tn.Ids,isBlocking:!0,prepareData:()=>Pr(this.config,{cookie:e}),processResponse:e=>{this.debug.log("received customer ids response",e);const t=e.data,i=t.cookie;this.debug.log("cookie received from server is "+i),this.setTrackingCookie(i),this.config.extendOptions({customer:t}),this.segments.prefetch()}},{process:Tr.immediate})}setTrackingCookie(e){this.setCookie(i,e,"tracking")}setFreshTrackingCookie(){const e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}));return this.setTrackingCookie(e),e}sanitizeCookieOptions(){let e=this.config.getOptions().cookies.expires;function t(e,t,i,n,r){"number"==typeof t&&t>0||lr(t)&&t>new Date||("number"==typeof t?n.warn(`When specifying the number of seconds for cookies.expires.${e}, you have to use a positive number. You passed in '${t}'. The SDK will use the default value of ${i}. Read more at\nhttps://docs.exponea.com/docs/configuration#cookies-options`):lr(t)?n.warn(`When specifying a Date for cookies.expires.${e}, you have to use a date in the future. You passed in '${t}'. The SDK will use the default value of ${i}. Read more at\nhttps://docs.exponea.com/docs/configuration#cookies-options`):n.warn(`You can only use a number or a Date object for cookies.expires.${e}, not '${typeof t}'. The SDK will use the default value of ${i}. Read more at\nhttps://docs.exponea.com/docs/configuration#cookies-options`),r.extendOptions({cookies:{expires:{[e]:i}}}))}ge(e)&&!lr(e)||(e={tracking:e,ab_test:e,time:e},this.config.extendOptions({cookies:{expires:e}})),t("tracking",e.tracking,mr,this.logger,this.config),t("ab_test",e.ab_test,fr,this.logger,this.config),t("time",e.time,3600,this.logger,this.config)}parseCookieValue(e){0===e.indexOf('"')&&(e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return e=decodeURIComponent(e.replace(/\+/g," "))}catch(t){return this.debug.error("error while parsing cookie value, ignoring",t),e}}}function Pr(e,t){const i=e.getOptions().cookies.expires,n=Yn(e.getOptions().customer);return delete n.cookie,{data:{project_id:e.getToken(),cookie:t.cookie,tifc:t.tifc,customer:n,expires:Math.floor(Ar(i.tracking).getTime()/1e3)}}}function jr(e){setTimeout(e)}function Lr(e,t,i,n=!1){let r;t.start();try{r=i(),t.end()}catch(i){if(t.setError(i),t.end(),!n)throw i;e.error(i)}return r}class Ir{}const Br=new Ir;var zr;function Dr(e){return function(t,i,n){const r=n.value;return n.value=function(){let t,i=Br;"string"==typeof e||"object"==typeof e&&e instanceof Ir?i=e:void 0!==e&&(e.operation&&(i=e.operation),e.onRoot&&(t=this.tracing._trace));const n=this.tracing.registerNewSpan(i,t),s=n.isChildOfTrace();return Lr(this.tracing.debug,n,r.bind(this,...Array.from(arguments)),s)},n}}!function(e){var t;(t=e.State||(e.State={}))[t.Waiting=0]="Waiting",t[t.Running=1]="Running",t[t.EndedSync=2]="EndedSync",t[t.EndedAsync=3]="EndedAsync"}(zr||(zr={}));const Fr=Object.freeze({immediate:!1});class Rr{constructor(e,t,i,n,r,s,o,a,c,u,h,l,d){this.tracing=e,this.config=t,this.contextualBanditEventFilter=i,this.time=n,this.timestamp=r,this.queue=s,this.debug=o,this.document=a,this.location=c,this.initializeState=u,this.window=h,this.url=l,this.browserExtension=d,this._defaultEventProperties={},this.eventTrackingListeners=[]}track(e,t={},i={}){i=Tn(i,Fr);const n=Object.assign(Object.assign(Object.assign({location:this.location.href},un(this.window,this.document)),this._defaultEventProperties),t),r=this.timestamp.getTimestamp(),s=this.browserExtension.sendPayload({type:"event",eventType:e,eventProperties:n},{type:"pending"});this.tracing.tracePromise(this.initializeState.whenInitialized()).then((()=>{this.contextualBanditEventFilter.reward(n,e),this.queue.enqueue({name:tn.Events,prepareData:t=>{const i=this.config.getOptions().customer;this.debug.log("Tracking event: "+e,n);const s={customer_ids:i,company_id:this.config.getToken(),type:e,age:t-r,properties:n};this.time.isTimeInitialized()&&(s.timestamp=this.timestamp.getTimestampWithOffset());try{this.triggerEventTrackingListeners(e,n)}catch(e){this.debug.error("Error triggering event tracking listeners",e)}return{data:s}},processResponse:(e,t,n)=>{jr((()=>{var r;return null===(r=i.successCallback)||void 0===r?void 0:r.call(i,e,t,n)})),s({type:"success"})},processError:e=>{jr((()=>{var t;return null===(t=i.errorCallback)||void 0===t?void 0:t.call(i,e)})),s({type:"error",error:String(e)})}},{process:i.immediate?Tr.immediate:Tr.defer})}))}addUtmParamsToDefaultEventPropertiesIfEnabled(){const e=this.config.getOptions();if(e.utm_always){const t=e.utm_params?this.url.getParams(e.utm_params):{};this._addDefaultEventProperties(t)}}addTrackDefaultPropertiesToDefaultEventPropertiesIfEnabled(){const e=this.config.getOptions();e.track&&e.track.default_properties&&this._addDefaultEventProperties(e.track.default_properties)}_addDefaultEventProperties(e){Object.assign(this._defaultEventProperties,e)}registerEventTrackingListener(e){this.eventTrackingListeners.push(e)}trackPageVisitEventIfEnabled(){const e=this.config.getOptions().track;e&&e.visits&&(this.trackPageVisitEvent(),this.config.isSpaReloadingEnabled("visits")&&this.url.onChange("trackPageVisitOnUrlChange",(()=>{this.trackPageVisitEvent()})))}trackPageVisitEvent(){this.track("page_visit",Object.assign({referrer:this.document.referrer,location:this.location.href,path:this.location.pathname},this.url.getParams(this.config.getOptions().track.visits_query_params)))}triggerEventTrackingListeners(e,t){for(let i=0;i<this.eventTrackingListeners.length;i++)try{this.eventTrackingListeners[i](e,t)}catch(e){this.debug.error(`Error when processing event listener ${this.eventTrackingListeners[i].name||i}`,e)}}}gi([Dr("EventTracker.track"),mi("design:type",Function),mi("design:paramtypes",[String,Object,Object]),mi("design:returntype",void 0)],Rr.prototype,"track",null);function Mr(e,t,i,n=0){if(n>10)throw new Error(`Maximum number of retries reached while waiting for window.ga to appear (already waited for ${500*n}ms). window.gtag is available but it does not appear to load window.ga anymore!`);if(t.ga)return e.log(`window.ga is available after ${n} retries`),void t.ga(i);if(t.gtag)return e.log(`window.gtag is available, trying ${n} retry`),void t.setTimeout(Mr.bind(void 0,e,t,i,n+1),500);throw new Error("No window.ga nor window.gtag is available in waitForGoogleAnalyticsSdkToLoad!")}var Nr;!function(e){e.BannersShow="campaigns/banners/show",e.ExperimentsShow="campaigns/experiments/show",e.HtmlGet="campaigns/html/get",e.ManagedTagsShow="managed-tags/show",e.Recommendation="optimization/recommend/user",e.WebOptimization="webxp/projects/<project_id>/bundle",e.Segments="webxp/projects/<project_id>/segments?cookie=<cookie>",e.LinkIds="webxp/projects/<project_id>/cookies/<cookie>/link-ids"}(Nr||(Nr={}));class qr{constructor(e,t,i,n,r,s,o,a,c){this.tracing=e,this.config=t,this.queue=i,this.debug=n,this.initializeState=r,this.window=s,this.cookies=o,this.browserExtension=a,this.segments=c}requestCustomerIdsFromServer(e,t=(()=>{})){this.queue.enqueue({name:tn.Ids,isBlocking:!0,prepareData:()=>Pr(this.config,e),processResponse:e=>{this.debug.log("received customer ids response",e);const i=e.data,n=i.cookie;this.debug.log("cookie received from server is "+n),this.cookies.setTrackingCookie(n),this.config.extendOptions({customer:i}),t(i),this.segments.prefetch(),this.segments.notify()}},{first:!0})}filterEmptyCustomerIds(e){const t={};for(const i in e)!e.hasOwnProperty(i)||null!==e[i]&&void 0!==e[i]&&""!==e[i]?t[i]=e[i]:this.debug.log("Removed empty customer id: "+i,e[i]);return t}identifyCustomerWithGoogleAnalyticsId(){const e=this.config.getOptions();e.customer&&e.customer.google_analytics||e.track.google_analytics&&(!function(e){return"ga"in e||"gtag"in e}(this.window)?this.debug.warn("Missing Google Analytics SDK (window.ga and window.gtag are not defined). Either integrate Google Analytics with your website or disable Google Analytics integration in the SDK config:\nhttps://docs.exponea.com/docs/config-object"):!function(e){return"ga"in e&&"function"!=typeof e.ga}(this.window)?Mr(this.debug,this.window,(()=>{if(!this.window.ga||!this.window.ga.getAll)throw new Error("window.ga is missing the getAll function");const t=this.window.ga.getAll();if(!t)return;const i=function(e){var t;const i=e.find((e=>{var t;return null===(t=e.get)||void 0===t?void 0:t.call(e,"clientId")}));return null===(t=null==i?void 0:i.get)||void 0===t?void 0:t.call(i,"clientId")}(t);i&&(this.config.extendOptions({customer:Object.assign(Object.assign({},e.customer),{google_analytics:i})}),this.updateCustomer({}))})):this.debug.warn("Incorrect Google Analytics SDK detected (window.ga is "+typeof this.window.ga+"). Are you using an old Google Analytics SDK? This is not supported in the SDK so Google Analytics integration will not work. Either upgrade the Google Analytics SDK or disable Google Analytics integration in the SDK config:\nhttps://docs.exponea.com/docs/config-object"))}updateCustomer(e,t=(()=>{}),i=(()=>{}),n=!1){this.tracing.tracePromise(this.initializeState.whenInitialized()).then((()=>{this.queue.enqueue({name:tn.Customers,prepareData:()=>{const t=Object.assign({},e);return{data:{ids:this.config.getOptions().customer,company_id:this.config.getToken(),properties:t}}},processResponse:t,processError:i},{process:n?Tr.immediate:Tr.defer})}))}linkCustomerIds(e=(()=>{}),t=(()=>{}),i=!1){this.tracing.tracePromise(this.initializeState.whenInitialized()).then((()=>{this.queue.enqueue({name:Nr.LinkIds,allowedToFail:!0,noBulk:!0,prepareData:()=>({data:{external_ids:this.config.getOptions().customer}}),processResponse:e,processError:t},{process:i?Tr.immediate:Tr.defer})}))}identifyCustomer(e,t={},i=(()=>{}),n=(()=>{}),r=!1,s,o){"string"!=typeof e&&"number"!=typeof e||(e={registered:e});const a=this.config.getOptions().customer,c=this.filterEmptyCustomerIds(e);c.cookie=a.cookie,a.google_analytics&&(c.google_analytics=a.google_analytics),this.debug.log("Identifying customer: ",c),this.browserExtension.sendPayload({type:"ids",ids:c}),this.config.extendOptions({customer:c}),this.updateCustomer(t,i,n,r),s&&this.linkCustomerIds(s,o,r)}}class Ur{constructor(e,t){this.window=e,this.logger=t,this.database.catch((()=>{}))}get database(){return this.isSupported()?(this.dbRequest||(this.dbRequest=function(e,t,i){const n=e.open("exponea",1);return n.onblocked=()=>{t.warn("A new version of this page is ready. Please close all other tabs with this site open to update.")},n.onupgradeneeded=e=>{!function(e,t){const i=e.result;t.oldVersion<1&&i.createObjectStore("settings",{keyPath:"key"})}(n,e)},new Promise(((e,t)=>{n.onsuccess=()=>{const t=n.result;t.onversionchange=()=>{t.close()},t.onclose=()=>{i()},e(t)},n.onerror=()=>{t(n.error)}}))}(this.window.indexedDB,this.logger,(()=>this.dbRequest=void 0))),this.dbRequest):Promise.reject("IndexedDB is not supported, some features may be broken")}setItem(e,t){return this.database.then((i=>{const n=Object.assign(Object.assign({},t),{key:e}),r=i.transaction("settings","readwrite").objectStore("settings").put(n);return new Promise(((e,t)=>{r.onsuccess=()=>e(),r.onerror=()=>t(r.error)}))}))}getItem(e){return this.database.then((t=>{const i=t.transaction("settings").objectStore("settings").get(e);return new Promise(((e,t)=>{i.onsuccess=()=>e(i.result),i.onerror=()=>{t(i.error)}}))}))}isSupported(){return void 0!==this.window.indexedDB}}class Wr{constructor(e,t,i,n){this.config=e,this.location=t,this.logger=i,this.storageUtils=n}error(e,...t){"string"==typeof e?this.print("error",e,...t):this.print("error",e)}log(e,...t){this.print("log",e,...t)}warn(e,...t){this.print("warn",e,...t)}debug(e,...t){this.print("debug",e,...t)}canPrintMessages(e="production",i=t){return"production"!==e&&i||this.config.getOptions().debug||this.location.search.includes(`${c}_debug=true`)||!!this.storageUtils.readBooleanFromStorage("localStorage",`${c}_debug`)}print(e,...t){this.canPrintMessages()&&this.logger[e](...t.filter((e=>void 0!==e)))}}class $r{constructor(e,t){this.config=e,this.tracing=t,this.DEFAULT_DEPENDENCIES={exp:"https://exp-framework.exponea.com/exp.js"},this.loadedDependencies={}}get options(){return this.config.getOptions()}loadDependency(e){let t;t="[object Array]"===Object.prototype.toString.call(e)?e:[e];try{const e=this.getDependencyUrls(t);return this.getDependencyLoadingChain(e)}catch(e){return this.tracing.tracePromise(Promise.reject(e))}}getDependencyUrls(e){const t=[];for(const i of e){let e=this.DEFAULT_DEPENDENCIES[i];if(this.options.dependencies&&this.options.dependencies[i]&&(e=this.options.dependencies[i]),!e)throw new Error(`unknown dependency named '${i}'`);t.push(e)}return t}getDependencyLoadingChain(e){let t=this.tracing.tracePromise(Promise.resolve());for(const i of e)t=t.then((()=>this.loadDependencyFromUrl(i)));return t}isDependencyPresent(e){return this.loadedDependencies[e]}markDependencyAsPresent(e){this.loadedDependencies[e]=!0}loadDependencyFromUrl(e){if(this.isDependencyPresent(e))return this.tracing.tracePromise(Promise.resolve());this.markDependencyAsPresent(e);const t=new Promise(((t,i)=>{const n=document.getElementsByTagName("head")[0]||document.documentElement,r=document.createElement("script");r.src=e;let s=!1;r.onload=r.onreadystatechange=function(){s||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(s=!0,t(),r.onload=r.onreadystatechange=null,n&&r.parentNode&&n.removeChild(r))},r.onerror=function(t){const n="message"in t?`: ${t.message}`:"";i(new Error(`Loading of dependency '${e}' failed${n}`))},r.onabort=function(){i(new Error(`Loading of dependency '${e}' was aborted`))},n.insertBefore(r,n.firstChild)}));return this.tracing.tracePromise(t)}}class Hr{constructor(e,t){this.window=e,this.document=t}whenLoaded(){return this.loadedPromise||(this.loadedPromise=new Promise((e=>function(e,t,i){let n=!1,r=!0;const s=t.documentElement,o="addEventListener"in t?"addEventListener":"attachEvent",a="removeEventListener"in t?"removeEventListener":"detachEvent",c="addEventListener"in t?"":"on";if("complete"===t.readyState)i.call(e,"lazy");else{if(t.createEventObject&&s.doScroll){try{r=!e.frameElement}catch(e){}r&&function t(){try{s.doScroll("left")}catch(e){return void setTimeout(t,50)}n=!0,i.call(e,"poll")}()}t[o](c+"DOMContentLoaded",u,!1),t[o](c+"readystatechange",u,!1),e[o](c+"load",u,!1)}function u(r){if("readystatechange"===r.type&&"complete"!==t.readyState)return;const s="load"===r.type?e:t;s[a].bind(s)(c+r.type,u,!1),n||(n=!0,i.call(e,r.type))}}(this.window,this.document,e)))),this.loadedPromise}}var Vr;!function(e){const t=["id","name","price","brand","category","variant","list","position"],i=["product_id","name","price","brand","category","variant","list","position"],n=["currencyCode"],r=["currency_code"],s=["id","name","brand","category","variant","price","quantity","coupon","position"],o=["product_id","name","brand","category","variant","price","quantity","coupon","position"],a=["id","affiliation","revenue","tax","shipping","coupon","list","step","option"],c=["transaction_id","affiliation","revenue","tax","shipping","coupon","list","step","option"],u=["id","name","creative","position"],h=["promo_id","name","creative","position"];function l(e,t,i,n=i){i.forEach(((i,r)=>{const s=n[r];t.hasOwnProperty(i)&&t[i]&&(e[s]=t[i])}))}function d(e,t){l(e,t,n,r)}function p(e,t){l(e,t,a,c)}e.Tracker=class{constructor(e,t){this.debug=e,this.eventTracker=t}trackEnhancedEcommerce(e,t="all"){jn(e)?("impressions"!==t&&"all"!==t||this.trackProductImpressions(e),"click"!==t&&"all"!==t||this.trackProductAction(e,"click","product_click"),"detail"!==t&&"all"!==t||this.trackProductAction(e,"detail","product_detail"),"add"!==t&&"all"!==t||this.trackProductAction(e,"add","product_add_to_cart"),"remove"!==t&&"all"!==t||this.trackProductAction(e,"remove","product_remove_from_cart"),"promoView"!==t&&"all"!==t||this.trackPromotionAction(e,"promoView","promo_impression"),"promoClick"!==t&&"all"!==t||this.trackPromotionAction(e,"promoClick","promo_click"),"checkout"!==t&&"all"!==t||this.trackCheckout(e),"checkout_option"!==t&&"all"!==t||this.trackCheckoutOption(e),"purchase"!==t&&"all"!==t||this.trackPurchase(e),"refund"!==t&&"all"!==t||this.trackRefund(e)):this.debug.error("Ecommerce parameter is not a plain object")}trackProductImpressions(e){e.impressions?e.impressions.forEach((n=>{const r={};d(r,e),l(r,n,t,i),this.trackEnhancedEcommerceEvent("product_impression",r)})):this.debug.warn("There are no impressions in the ecommerce object")}trackProductAction(e,t,i){var n;const r=e[t];if(!r)return void this.debug.debug(`${t} not found in the ecommerce object`);if(!r.products)return void this.debug.debug(`${t} in the ecommerce object does not have any products`);const a=null!==(n=r.actionField)&&void 0!==n?n:{};r.products.forEach((t=>{const n={};d(n,e),p(n,a),l(n,t,s,o),this.trackEnhancedEcommerceEvent(i,n)}))}trackPromotionAction(e,t,i){const n=e[t];n?n.promotions?n.promotions.forEach((t=>{const n={};d(n,e),l(n,t,u,h),this.trackEnhancedEcommerceEvent(i,n)})):this.debug.debug(`${t} in the ecommerce object does not have any promotions`):this.debug.debug(`${t} not found in the ecommerce object`)}trackCheckout(e){var t;if(!e.checkout)return void this.debug.debug("There is no checkout in the ecommerce object");this.trackProductAction(e,"checkout","product_checkout");const i=null!==(t=e.checkout.actionField)&&void 0!==t?t:{},n={};d(n,e),p(n,i),this.trackEnhancedEcommerceEvent("checkout",n)}trackCheckoutOption(e){var t;if(!e.checkout_option)return void this.debug.debug("There is no checkout option in the ecommerce object");const i=null!==(t=e.checkout_option.actionField)&&void 0!==t?t:{},n={};d(n,e),p(n,i),this.trackEnhancedEcommerceEvent("checkout_option",n)}trackPurchase(e){var t;if(!e.purchase)return void this.debug.debug("There is no purchase in the ecommerce object");this.trackProductAction(e,"purchase","product_purchase");const i=null!==(t=e.purchase.actionField)&&void 0!==t?t:{},n={};d(n,e),p(n,i),this.trackEnhancedEcommerceEvent("transaction",n)}trackRefund(e){var t;if(!e.refund)return void this.debug.debug("There is no refund in the ecommerce object");const i=null!==(t=e.refund.actionField)&&void 0!==t?t:{},n={};d(n,e),p(n,i),e.refund.products?(n.refund_type="partial",this.trackProductAction(e,"refund","product_refund")):n.refund_type="full",this.trackEnhancedEcommerceEvent("refund",n)}trackEnhancedEcommerceEvent(e,t){this.eventTracker.track(e,Object.assign({tracked_via:"eecommerce"},t))}}}(Vr||(Vr={}));class Gr{static matches(e,t){return!t.enabled||!(t.from_date&&t.from_date>e)&&!(t.to_date&&t.to_date<e)}}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function Kr(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Qr={};({get exports(){return Qr},set exports(e){Qr=e}}).exports=is;var Jr,Yr,Zr,Xr=Qr.isMobile=is,es=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i,ts=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino|android|ipad|playbook|silk/i;function is(e,t){return t||null===e||"object"!=typeof e||(t=e),e||"undefined"==typeof navigator||(e=navigator.userAgent),e&&e.headers&&"string"==typeof e.headers["user-agent"]&&(e=e.headers["user-agent"]),"string"==typeof e&&(t||(t={}),t.tablet?ts.test(e):es.test(e))}class ns{static matches(e,t){return!e||("mobile"===e.type?Xr(t):"desktop"!==e.type||!Xr(t))}}class rs{static matches(e,t,i,n,r,s){if(!n||!i.isStorageAvailable("localStorage"))return!0;const o=s+r,a=t.getStoredTimestamp(o+"_last_show"),c=t.getStoredTimestamp(o+"_last_interaction"),u=e.getLastSessionStart();switch(n){case"only_once":return!a;case"until_visitor_interacts":return!c;case"once_per_visit":return!a||!u||a<u}return!0}}function ss(e,t,i){return`${e}${i?" "+i:""} was filtered out by ${t} filter`}function os(e,t){return(i,n)=>function(e,t,i,n){return r=>{const s=n(r);return s||t.log(ss(e,i,"_id"in r?r._id:void 0),r),s}}(e,t,i,n)}function as(){let e=!1;return{initialize(){},track(){},trackLink(){},identify(){},update(){},anonymize(){},loadDependency:window[c].loadDependency.bind(window[c]),notifications:{isAvailable:e=>(null==e||e(!0),!0),isSubscribed:t=>(t(e,!1),e),subscribe(t){setTimeout((()=>{e=!0,t(Yr.Subscribed)}),500)},unsubscribe(t){setTimeout((()=>{e=!1,t(Yr.Unsubscribed)}),500)}}}}!function(e){e.WebLayer="Weblayer",e.Experiment="Experiment",e.ManagedTag="Managed tag"}(Jr||(Jr={})),function(e){e.Error="error",e.PermissionDenied="permission-denied",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed",e.Default="default",e.Unsupported="unsupported"}(Yr||(Yr={}));class cs{static matches(e,t){if("page"in t)return this.matchesURLFilter(e,t.page);if(t.exclude_pages)for(const i of t.exclude_pages)if(this.matchesURLFilter(e,i))return!1;if(t.include_pages)for(const i of t.include_pages)if(this.matchesURLFilter(e,i))return!0;return!1}static parseURL(e){const t={source:e};let i;const n=/^(.{1,5}?):\/\//;var r,s,o,a,c,u;(i=n.exec(e))&&(t.protocol=i[1],e=e.replace(n,"")),s="//",r=Xt(r=e),o=null==o?0:(a=Kn(o),c=0,u=r.length,a==a&&(void 0!==u&&(a=a<=u?a:u),void 0!==c&&(a=a>=c?a:c)),a),s=Zt(s),r.slice(o,o+s.length)==s&&(e=e.substr(2));const h=/(.*?)(\/|$)/;if(i=h.exec(e)){const n=i[1].split(":");""!==n[0]&&(t.host=n[0]),n.length>1&&(t.port=n[1]),e=e.replace(h,"/")}const l=/(.*?)(\?|$|#)/;(i=l.exec(e))&&(t.path=i[1],e=e.replace(l,i[2]));const d=/^\?(.*?)($|#)/;(i=d.exec(e))&&(t.query=i[1],e=e.replace(d,i[2]));if((i=/^#(.*)/.exec(e))&&(t.hash=i[1]),t.withoutHost=t.path,t.query&&(t.withoutHost+=`?${t.query}`),t.hash&&(t.withoutHost+=`#${t.hash}`),t.host){const e=t.port?`:${t.port}`:"";t.withoutProtocol=`//${t.host}${e}${t.withoutHost}`}return t}static escapeRegex(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}static wildcardToRegex(e){const t=("^"+this.escapeRegex(e)+"$").replace(new RegExp("\\\\\\*","g"),".*");return new RegExp(t)}static matchesExactURL(e,t){const i=this.parseURL(e),n=this.parseURL(t);return!(n.host||!n.withoutHost||!i.withoutHost||!i.withoutHost.match(this.wildcardToRegex(n.withoutHost)))||(!(n.protocol||!n.withoutProtocol||!i.withoutProtocol||!i.withoutProtocol.match(this.wildcardToRegex(n.withoutProtocol)))||!!i.source.match(this.wildcardToRegex(n.source)))}static matchesContainsURL(e,t){return ur(e,t)}static matchesRegexURL(e,t){try{const i=new RegExp(t);if(e.match(i))return!0;const n=this.parseURL(e);return!(!n.withoutProtocol||!n.withoutProtocol.match(i))||!(!n.withoutHost||!n.withoutHost.match(i))}catch(e){if(e instanceof Error)return!1;throw e}}static matchesURLFilter(e,t){return"any"===t.type||("exact"===t.type?this.matchesExactURL(e,t.url):"contains"===t.type?this.matchesContainsURL(e,t.url):"regex"===t.type&&this.matchesRegexURL(e,t.regex))}}class us{constructor(e,t,i,n,r,s,o,a,c,u,h,l,d,p){this.tracing=e,this.config=t,this.queue=i,this.timestamp=n,this.ping=r,this.modifications=s,this.experimentsEditor=o,this.tracker=a,this.location=c,this.debug=u,this.documentContentLoaded=h,this.storageUtils=l,this.newExperiments=d,this.url=p,this.applyingExperimentsInProgress=!1,this.experimentRevertFunctions=[]}applyExperimentModificationsAndTrackEvent(e,t=!0){let i;try{i=this.modifications.applyModifications(e)}catch(e){return this.debug.error("Error applying experiment",e),()=>{}}return this.experimentRevertFunctions.push(i),t&&this.tracker.track("experiment",{action:"show",experiment_id:e.params.experiment_id,experiment_name:e.params.experiment_name,variant_id:e.params.variant_id,variant_name:e.params.variant_name,location:window.location.href,path:window.location.pathname}),i}revertExistingExperiments(){for(const e of this.experimentRevertFunctions)try{e()}catch(e){this.debug.error("Error from revert experiment script",e)}this.experimentRevertFunctions=[]}applyExperiment(e){if(!this.filterByCustomCondition(e))return void this.debug.log(ss(Jr.Experiment,e.params.experiment_id,"custom condition"));this.debug.log(`Applying experiment ${e.params.experiment_id}...`,e);const t=this.applyExperimentModificationsAndTrackEvent(e,!0);this.experimentRevertFunctions.push(t)}processDefinition(e){this.newExperiments.areAlreadyApplied()?this.debug.log("Not applying experiments with the SDK because new_experiments are enabled."):(this.debug.log("Processing experiments...",e),this.filterAndApplyExperiments(e),this.config.isSpaReloadingEnabled("experiments")&&this.url.onChange("onUrlChangeFilterAndApplyExperiments",(()=>this.filterAndApplyExperiments(e))))}filterAndApplyExperiments(e){if(this.applyingExperimentsInProgress)return;this.revertExistingExperiments();const t=this.filterExperimentsForCustomer(e);0!==t.length&&(this.applyingExperimentsInProgress=!0,this.queryAndApplyExperimentsModifications(t))}filterExperimentsForCustomer(e){const t=os(Jr.Experiment,this.debug);return e.filter(t("page",(e=>cs.matches(this.location.href,e.trigger)))).filter(t("date",(e=>Gr.matches(this.timestamp.getTimestamp(),e.date_filter)))).filter(t("device",(e=>ns.matches(e.device_target)))).filter(t("frequency",(e=>rs.matches(this.ping,this.timestamp,this.storageUtils,e.frequency,e._id,"__exponea_experiment_event__"))))}queryAndApplyExperimentsModifications(e){const t=e.map((e=>e._id));let i=Yn(this.config.getOptions().customer);this.queue.enqueue({name:Nr.ExperimentsShow,noBulk:!0,prepareData:()=>(this.debug.debug("Get filtered experiments by IDs",t),i&&i.cookie||(i=Yn(this.config.getOptions().customer)),{data:{company_id:this.config.getToken(),customer_ids:i,personalisation_ids:t}}),processResponse:e=>{this.applyExperimentsModifications(e.data)},processError:()=>{this.applyingExperimentsInProgress=!1}})}applyExperimentsModifications(e){this.debug.log("Applying experiments..."),this.tracing.tracePromise(this.documentContentLoaded.whenLoaded()).then((()=>{e.forEach((e=>{this.applyExperiment(e)})),this.applyingExperimentsInProgress=!1}))}filterByCustomCondition(e){if(!e.custom_condition||this.experimentsEditor.isEditorRunning())return!0;try{return!!this.setupCustomConditionScriptFunction(e.params,e.custom_condition)()}catch(t){return this.debug.error(`Custom condition for experiment ${e.params.experiment_id} threw an error`,t),!1}}setupCustomConditionScriptFunction(e,t){const i={};i.inPreview=this.experimentsEditor.isEditorRunning(),i.sdk=i.inPreview?as():window[c],i.data=i.params=e;let n=t;n.length>0&&n.indexOf("\n")<0&&n.indexOf(";")<0&&n.indexOf("return")<0&&(n="return "+n);const r=new Function(n).bind(i);return r.context=i,r}}gi([Dr("applyExperimentModificationsAndTrackEvent"),mi("design:type",Function),mi("design:paramtypes",[Object,Object]),mi("design:returntype",void 0)],us.prototype,"applyExperimentModificationsAndTrackEvent",null),gi([Dr("revertExistingExperiments"),mi("design:type",Function),mi("design:paramtypes",[]),mi("design:returntype",void 0)],us.prototype,"revertExistingExperiments",null),gi([Dr("applyExperiment"),mi("design:type",Function),mi("design:paramtypes",[Object]),mi("design:returntype",void 0)],us.prototype,"applyExperiment",null);class hs{constructor(e,t,i,n,r,s,o,a){this.http=e,this.config=t,this.location=i,this.document=n,this.history=r,this.window=s,this.debug=o,this.storageUtils=a,this.urlParamsMatch=null,this.urlParamsMatchBase64=null}matchUrlWithParams(){this.urlParamsMatch=this.location.href.match("(#|\\?)?exponea-editor-params=((%7B|{).*(%7D|}))"),this.urlParamsMatchBase64=this.location.href.match("(?:#|\\?)?exponea-editor-params=([a-zA-Z0-9-_=]+)")}areEditorParamsInURL(){return!!this.urlParamsMatch||!!this.urlParamsMatchBase64}placeParamsFromURLToStorage(){let e="";if(this.urlParamsMatch&&(e=decodeURIComponent(this.urlParamsMatch[2])),this.urlParamsMatchBase64){const t=this.urlParamsMatchBase64[1].replace(/-/g,"+").replace(/_/g,"/");e=atob(t)}e&&(this.storageUtils.writeToStorage("sessionStorage",f,e)||this.debug.warn("The editor is not supported in this browser"))}removeParamsFromURL(){let e="";this.urlParamsMatch&&(e=this.urlParamsMatch[0]),this.urlParamsMatchBase64&&(e=this.urlParamsMatchBase64[0]),e&&(this.history&&this.history.replaceState?this.history.replaceState(null,this.document.title,this.location.href.replace(e,"")):this.location.href=this.location.href.replace(e,""))}shouldStartEditor(){return!!this.storageUtils.readStringFromStorage("sessionStorage",f)}bootstrapEditor(){return this.isEditorRunning()?(this.debug.log("The editor is already running"),Promise.resolve()):this.location.host.indexOf("localhost")>=0?(this.debug.log("Auto-launching of the editor is disabled in development environments"),Promise.resolve()):this._waitForPageToLoad().then((()=>{this._insertEditorLoadingElement();const e=this._insertEditorIframe();return this.http.get(this.config.getOptions().target+"/editor/index.html?timestamp="+(new Date).getTime(),{responseType:"text"}).then((e=>e.body)).then((t=>{if(e){const i=t.replace(/base\shref=".*"/,`base href="${this.config.getOptions().target}${y}"`);e.srcdoc=i}else this.debug.error("The created iframe's content document is null! Is the iframe in the DOM?")})).catch((()=>this.http.get(this.config.getOptions().target+"/editor/version.txt?timestamp="+(new Date).getTime(),{responseType:"text"}).then((t=>{const i=t.body.trim();this.debug.log(`Fetching editor version ${i}`);const n=v.map((e=>`<script type="text/javascript" src="${this.config.getOptions().target+y+i+`/${e}.js`}"><\/script>`)).join();e?e.srcdoc=`<html><head><title>Exponea Web Optimization Editor</title><meta charset="utf-8"></head><body>${n}</body></html>`:this.debug.error("The created iframe's content document is null! Is the iframe in the DOM?")})).catch((e=>this.debug.error("Failed to fetch the editor version",e)))))}))}_waitForPageToLoad(){return new Promise((e=>{this.document.body?e():this.window.addEventListener("load",(()=>e()))}))}isEditorRunning(){return!!this.document.getElementById(b)}_insertEditorLoadingElement(){this.debug.log("Inserting experiments editor loading element");const e=this.document.createElement("style");e.textContent=".exponea-loading-backdrop{margin:0;padding:0;position:fixed;top:0;left:0;right:0;bottom:0;background-color:rgba(87,91,154,.5);display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;z-index:2147483642}.exponea-loading-icon{width:50px;height:50px;border:4px solid #ffd500;border-right-color:transparent;border-radius:50%;-webkit-animation:rotate .8s infinite linear;animation:rotate .8s infinite linear}@-webkit-keyframes rotate{from{-webkit-transform:rotate(0);transform:rotate(0)}to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes rotate{from{-webkit-transform:rotate(0);transform:rotate(0)}to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}";const t=this.document.createElement("div");t.innerHTML='<div class="exponea-loading-backdrop"><div class="exponea-loading-icon"></div></div>',this.document.head.appendChild(e),Se(t.childNodes,(e=>this.document.body.appendChild(e)))}_insertEditorIframe(){const e=this.document.createElement("div"),t=this.document.createElement("iframe");return e.id=b,e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.right="0",e.style.bottom="0",e.style.border="none",e.style.width="auto",e.style.height="auto",e.style.margin="0",e.style.padding="0",e.style.backgroundColor="transparent",e.style.zIndex="2147483647",t.src="about:blank",t.frameBorder="0",t.style.left="0",t.style.top="0",t.style.width="100%",t.style.height="100%",t.style.backgroundColor="transparent",t.style.margin="0",t.style.padding="0",t.style.display="block",t.style.visibility="visible",this.document.body.appendChild(e),e.appendChild(t),t}}class ls{constructor(e,t,i,n){this.eventTracker=e,this.experimentsEditor=t,this.document=i,this.debug=n}applyModifications(e){const t=[];e.modifications=e.modifications||[];for(const i of e.modifications)switch(i.type){case"add":this._applyAddModification(i,t);break;case"remove":this._applyRemoveModification(i,t);break;case"change":this._applyChangeModification(i,t);break;case"run":this._applyRunModification(i,e.params,t);break;case"track":this._applyTrackModification(i,t);break;case"banner":this._applyBannerModification(i,e.params,t)}return()=>{return i=e=>e(),($(e=t)?ir:rr)(e,ke(i));var e,i}}_applyAddModification(e,t){const i=this.document.createElement("div");e.parametrized_parts?i.innerHTML=e.parametrized_parts.html:i.innerHTML=e.html;const n=[].slice.call(i.childNodes);let r;try{r=this.document.querySelector(e.place_to.element)}catch(t){return void this.debug.warn("Invalid selector, ignoring the add modification",e.place_to.element)}if(r)switch(e.place_to.placement){case"before":Se(n,(i=>{r.parentElement?(r.parentElement.insertBefore(i,r),t.push(this._revertInsertElement.bind(this,i))):this.debug.warn("Attempting to insert HTML before an element without a parent",e.place_to.element)}));break;case"after":Se(n,(i=>{r.parentElement?(r.parentElement.insertBefore(i,r.nextSibling),t.push(this._revertInsertElement.bind(this,i))):this.debug.warn("Attempting to insert HTML after an element without a parent",e.place_to.element)}));break;case"prepend_child":Se(n,(e=>{r.insertBefore(e,r.firstChild),t.push(this._revertInsertElement.bind(this,e))}));break;case"append_child":Se(n,(e=>{r.appendChild(e),t.push(this._revertInsertElement.bind(this,e))}))}else this.debug.warn("No element matched the selector, ignoring the add modification",e.place_to.element)}_applyRemoveModification(e,t){let i=[];try{const t=this.document.querySelectorAll(e.element);i=[].slice.call(t)}catch(t){return void this.debug.warn("Invalid selector, ignoring the remove modification",e.element)}0!==i.length?Se(i,(i=>{switch(e.method){case"visibility":t.push(this._revertHideElement.bind(this,i)),i.style.visibility="hidden";break;case"display":t.push(this._revertHideElement.bind(this,i)),i.style.display="none";break;case"remove":i.parentElement?(t.push(this._revertRemoveElement.bind(this,i,i.parentElement,i.nextElementSibling)),i.parentElement.removeChild(i)):this.debug.warn("Attempting to remove an element without a parent",e.element)}})):this.debug.warn("The selector matched no elements, ignoring the remove modification",e.element)}_applyChangeModification(e,t){let i=[];try{const t=this.document.querySelectorAll(e.element);i=[].slice.call(t)}catch(t){return void this.debug.warn("Invalid selector, ignoring the change modification",e.element)}if(0===i.length)return void this.debug.warn("The selector matched no elements, ignoring the change modification",e.element);let n=[];if(e.place_to){try{const t=this.document.querySelectorAll(e.place_to.element);n=[].slice.call(t)}catch(t){return void this.debug.warn("Invalid container selector, ignoring the change modification",e.place_to.element)}if(0===n.length)return void this.debug.warn("The container selector matched no elements, ignoring the change modification",e.place_to.element);if(n.length!==i.length)return void this.debug.warn("The container selector matched a different number of elements then the source selector")}Se(i,((i,r)=>{if(e.html){const n=this.document.createElement("div");n.innerHTML=e.html;const r=[].slice.call(n.childNodes),s=i.parentElement,o=i.nextElementSibling;s?(Se(r,(e=>{s.insertBefore(e,i),t.push(this._revertInsertElement.bind(this,e))})),s.removeChild(i),t.push(this._revertRemoveElement.bind(this,i,s,o))):this.debug.warn("Cannot replace an element's HTML without a parent",e.element)}if(e.text){const n=i.innerHTML;i.innerText=e.text,t.push(this._revertTextChange.bind(this,i,n))}if(e.place_to){const s=n[r];if(!i.parentElement)return void this.debug.warn("Attempting to move an element without a parent",e.element);switch(t.push(this._revertRemoveElement.bind(this,i,i.parentElement,i.nextElementSibling)),e.place_to.placement){case"before":s.parentElement?s.parentElement.insertBefore(i,s):this.debug.warn("Attempting to insert an element before a container without a parent",e.place_to.element);break;case"after":s.parentElement?s.parentElement.insertBefore(i,s.nextSibling):this.debug.warn("Attempting to insert an element after a container without a parent",e.place_to.element);break;case"prepend_child":s.insertBefore(i,s.firstChild);break;case"append_child":s.appendChild(i)}}e.attributes&&sr(e.attributes,((e,n)=>{const r=i.getAttribute(n);r&&!i.getAttribute(`data-original-${n}`)&&i.setAttribute(`data-original-${n}`,r),i.setAttribute(n,e),t.push(this._revertAttributeChange.bind(this,i,n))})),e.style&&sr(e.style,((e,n)=>{i.style.setProperty(n,e,"important"),t.push(this._revertStyleChange.bind(this,i,n))}))}))}_applyTrackModification(e,t){let i=[];try{const t=this.document.querySelectorAll(e.element);i=[].slice.call(t)}catch(t){return void this.debug.warn("Invalid selector, ignoring the change modification",e.element)}0!==i.length?i.forEach((i=>{const n=this._buildTrackClickEventListener(this.eventTracker,e);i.addEventListener("click",n),t.push(this._revertClickEventTracking.bind(this,i,n))})):this.debug.warn("The selector matched no elements, ignoring the change modification",e.element)}_applyRunModification(e,t,i){const n=this;function r(){let t=null;try{const i=n.document.querySelectorAll(e.element);t=[].slice.call(i)}catch(t){n.debug.log("Invalid selector but still applying run modification",e.element)}if(t&&0===t.length){if("once_per_element"===e.execute)return void n.debug.log("The selector of run modification matched no elements",e.element);n.debug.log("The selector matched no elements but still applying run modification",e.element)}try{"once_per_element"===e.execute?t&&t.forEach((e=>s([e]))):s(t)}catch(e){n.debug.error("The run modification script threw an error",e)}}function s(r){const s=ds(n._setupModificationScriptFunction(e,t,r),t.experiment_id,n.debug);me(s)?i.push(s):hn(s)&&i.push(s.remove.bind(s))}e.execute&&"document_ready"!==e.execute||"complete"===document.readyState?r():document.addEventListener("DOMContentLoaded",r)}_applyBannerModification(e,t,i){let n=null;try{const t=this.document.querySelectorAll(e.element);n=[].slice.call(t)}catch(t){this.debug.warn("Invalid selector but still applying banner modification",e.element)}n&&0===n.length&&this.debug.warn("The selector matched no elements but still applying banner modification",e.element);try{const r=this._setupModificationScriptFunction(e,t,n);e.parametrized_parts?(r.context.html=e.parametrized_parts.html,r.context.style=e.parametrized_parts.style):(r.context.html=e.html,r.context.style=e.style);const s=ds(r,t.experiment_id,this.debug);me(s)?i.push(s):hn(s)&&i.push(s.remove.bind(s))}catch(e){this.debug.error("The banner modification script threw an error",e)}}_buildTrackClickEventListener(e,t){return()=>{e.track(t.event_type,Object.assign({},t.event_properties))}}_revertInsertElement(e){e.parentElement?e.parentElement.removeChild(e):this.debug.warn("Cannot remove an inserted element without a parent")}_revertHideElement(e){e.style.removeProperty("visibility"),e.style.removeProperty("display")}_revertRemoveElement(e,t,i){t?t.insertBefore(e,i):this.debug.warn("Cannot re-insert a removed element without a parent")}_revertClickEventTracking(e,t){e.removeEventListener("click",t)}_revertAttributeChange(e,t){const i=e.getAttribute(`data-original-${t}`);i&&(e.setAttribute(t,i),e.removeAttribute(`data-original-${t}`))}_revertStyleChange(e,t){e.style.removeProperty(t)}_revertTextChange(e,t){e.innerHTML=t}_setupModificationScriptFunction(e,t,i){const n={};n.inPreview=this.experimentsEditor.isEditorRunning(),n.sdk=n.inPreview?as():window[c],n.data=n.params=t,i&&i.length>0?(n.element=i[0],n.elements=i):(n.element=null,n.elements=[]),n.selector=e.element;const r="parametrized_parts"in e?e.parametrized_parts.script:e.script;let s;try{s=new Function(r).bind(n),s.context=n}catch(e){throw this.debug.error(`Syntax error in the experiment javascript code.\n\nThis is not an SDK error but rather an error in the experiment ${t.experiment_id}\njavascript code. Check the experiment code for syntax errors, such errors are\nusually highlighted in the UI. The first line of the stack trace below should\ngive you a clue.\n\n`,e),e}return s}}function ds(e,t,i){try{return e()}catch(e){throw i.error(`Error when executing a modification javascript code.\n\nThis is not an SDK error but rather an error in the experiment ${t}\njavascript code. Check the web layer javascript code for errors. This is not\na syntax error and may be hard to spot, but the first line of the stack trace\nbelow should give you a clue.\n\n`,e),e}}!function(e){e.sdk854_implement_trace_sampling="sdk854_implement_trace_sampling",e.ep3_use_new_experiments="ep3_use_new_experiments"}(Zr||(Zr={}));const ps=Object.freeze({[Zr.sdk854_implement_trace_sampling]:!1,[Zr.ep3_use_new_experiments]:!1});class gs{constructor(e,t,i=ps,n="eyJleHA3MjhfcmVtb3ZlX3dlYnhwX2NvbmZpZ19mcm9tX2FzeW5jX2FwaSI6IHRydWV9Cg=="){this.debug=e,this.window=t;try{this.flagConfig=Object.freeze(Object.assign(Object.assign({},i),function(e,t,i,n){const r=e.match(/^%%%%.+%%%%$/)?"e30=":e,s=JSON.parse(n.atob(r)),o={};return sr(s,((e,n)=>{n in t?"boolean"==typeof e?o[n]=e:i.error(`Incorrect value '${e}' for feature flag '${n}', expected a boolean but received '${typeof e}'`):i.error(`Feature '${n}' is not a feature flag supported by this SDK version`)})),o}(n,i,this.debug,this.window)))}catch(e){this.debug.error("Failed to parse feature flags",e),this.flagConfig=Object.freeze(i)}this.debug.debug("Initialized feature flags",this.flags)}get flags(){return this.flagConfig}setFlags(e){this.flagConfig=Object.freeze(Object.assign(Object.assign({},this.flagConfig),e)),this.debug.debug("Overwritten feature flags",this.flags)}}class ms{constructor(e,t,i,n){this.config=e,this.debug=t,this.documentContentLoaded=i,this.queue=n}getHtml(e,t){this.queue.enqueue({name:Nr.HtmlGet,noBulk:!0,prepareData:()=>(this.debug.log("Get html: ",e),{data:{company_id:this.config.getToken(),customer_ids:this.config.getOptions().customer,html_campaign_name:e}}),processResponse:e=>{jr((()=>{t(e.data)}))}})}showHtml(e,t){this.getHtml(t,(t=>{""!==t&&this.documentContentLoaded.whenLoaded().then((()=>{const i=di(e);for(let e=0;e<i.length;e++)i[e].innerHTML=t}),(e=>{this.debug.error("Failed to show HTML",e)}))}))}}var fs;!function(e){e[e.Fetch=0]="Fetch"}(fs||(fs={}));class bs extends Error{constructor(e){super(),this.response=e}}class ys{constructor(e=e){this.window=e,this.type=fs.Fetch,this.fetch=(e,t)=>this.window.fetch(e,t)}static isSupported(){if(!XMLHttpRequest)return!1;return"withCredentials"in new XMLHttpRequest}post(e,t,i){return this.fetch(e,Object.assign(Object.assign({},i),{headers:Object.assign({Accept:"application/json"},i.headers||{}),method:"POST",body:JSON.stringify(t),credentials:i.credentials?i.credentials:"include"})).then(vs).then(ws)}get(e,t){return this.fetch(e,{headers:Object.assign({Accept:"application/json"},t.headers||{}),method:"GET"}).then(vs).then(ws)}}function vs(e){const{status:t}=e;return{json:function(){return i().then((e=>{try{return JSON.parse(e)}catch(t){return e}}))},text:i,status:t};function i(){return e.text()}}function ws(e){if(e.status>=200&&e.status<300)return e;throw new bs(e)}class _s extends Error{constructor(e){super(e.message),this.name="HttpNetworkError"}}class ks extends Error{constructor(e){super(function(e){const{body:t}=e;if("string"==typeof t)return t;return JSON.stringify(t)}(e)),this.name="HttpServerError",this.response=e}}const Ss={responseType:"json"};class Ts{constructor(e){ys.isSupported()&&(this.transport=new ys(e))}hasTransport(){return void 0!==this.transport}get(e,t=Ss){if(t=Tn({},t,Ss),void 0===this.transport)throw new Error("Can't do a get request since no http transport is available!");return this.transport.get(e,t).catch(Es(t)).then(xs(t))}post(e,t,i=Ss){if(i=Tn({},i,Ss),void 0===this.transport)throw new Error("Can't do a post request since no http transport is available!");return this.transport.post(e,t,i).catch(Es(i)).then(xs(i))}}function xs(e){return function(t){return function(e,t){if("text"===e)return t.text();return t.json()}(e.responseType,t).then((e=>{const{status:i}=t;return{body:e,status:i}}))}}function Es(e){return function(t){return t instanceof bs?function(e,t){const i=xs(t);return i(e.response).then((e=>Promise.reject(new ks(e))))}(t,e):t instanceof TypeError?Promise.reject(new _s(t)):Promise.reject(t)}}var Cs;function As(e){return new Promise(((t,i)=>{e.execute({name:Nr.WebOptimization,noBulk:!0,httpMethod:Cs.get,processResponse(e){t(e)},processError:e=>{i(e)}})}))}function Os(e,t){const i=e.getOptions();return!1!==i.webOptimization&&!(i.webOptimization&&!1===i.webOptimization[t])}function Ps(e){const t=e[c];return t?t[m]?t[m]:t.start?"v2.0.0":"v1.0.0":"v0.0.0-unknown"}!function(e){e[e.post=0]="post",e[e.get=1]="get"}(Cs||(Cs={}));class js extends Error{constructor(e){super(e)}}class Ls{constructor(e,t,i,n,r,s,o,a,c,u,h,l,d,p,g,m,f,b,y,v,w,_,k,S,T,x,E,C,A,O=As){this.tracing=e,this.debug=t,this.config=i,this.time=n,this.cookies=r,this.ping=s,this.customer=o,this.userActivityTracking=a,this.experimentsEditor=c,this.experiments=u,this.webLayers=h,this.managedTags=l,this.campaignClicks=d,this.eventTracker=p,this.queryTracking=g,this.window=m,this.unloader=f,this.initializeState=b,this.queue=y,this.pushWebApi=v,this.pushSafariApi=w,this.transferIdentity=_,this.url=k,this.http=S,this.logger=T,this.performanceTracker=x,this.newExperiments=E,this.featureFlags=C,this.browserExtension=A,this.getDefinitions=O,this.webxpClientReadyRemote=function(e){let t,i;const n=new Promise(((e,n)=>{t=e,i=n}));return t&&i?{promise:n,resolve:t,reject:i}:(e.error("Error building promise remote: Promise executor has not been called synchronously"),{promise:Promise.reject(),resolve:()=>{},reject:()=>{}})}(this.logger)}get isWebxpClientReady(){return this.webxpClientReadyRemote.promise}initialize(e){if(!this.http.hasTransport())return void this.logger.warn(`${c} sdk won't be initialized because no supported HTTP transport method was found in this browser!`);if(this.initializeState.isInitializing())return void this.debug.log("The SDK is already being initialized");if(this.initializeState.isInitialized())return void this.debug.log("The SDK is already initialized");this.debug.log("Starting to initialize the SDK"),this.debug.log("Checking the cookie first"),this.debug.log("attempting to get cookie from browser");let t=this.cookies.getCookie(i);const n=this.window[w];if(n&&n.skipExperiments){if(!t&&(this.debug.log("The SDK does not have a cookie yet, communicating with webxp client to get one"),e&&!n.init)){if("boolean"==typeof e)throw new js("Invalid type of argument 0 - initialize, expected object but got boolean");return this.storedOptions=e,this.window.setTimeout(this.initialize.bind(this,!1),500),void this.debug.log("Initialization was postponed until the modifications script loads")}if(!e){if(!this.storedOptions)return;e=this.storedOptions}if(!t){if("boolean"==typeof e)throw new js("Invalid type of argument 0 - initialize, expected object but got boolean");if(n.config&&n.config.cookie){let i=this.config.getOptions().cookies.cross_subdomain;e&&e.cookies&&void 0!==e.cookies.cross_subdomain&&(i=e.cookies.cross_subdomain),this.config.extendOptions({cookies:{cross_subdomain:i}}),t=n.config.cookie,this.cookies.setTrackingCookie(t)}}}if("boolean"==typeof e)throw new js("Invalid type of argument 0 - initialize, expected object but got boolean");if(this.debug.log('Webxp client communication handled, continuing with initialization - SDK is marked as "initializing" now'),!or(e.token))throw new js("Invalid type of project token, expected string but got "+typeof e.token);if(""===e.token)throw new js("Invalid value of project token, the token cannot be an empty string");if(this.isComplianceConfigurationChanged(e))throw new js("It is disallowed to change `compliance` configuration during SDK initialization. Please set the `compliance` option in the snippet");this.tracedInitialize(e,t)}extendOptions(e){"boolean"!=typeof e&&this.config.extendOptions({token:e.token,target:e.target,compliance:e.compliance})}tracedInitialize(t,i){const n=this.tracing.registerNewSpan("initialize");this.preProcessCustomerIds(t),this.config.extendOptions(t);const r=this.config.getOptions();try{n.start(),this.initializeState.markInitializing(),this.browserExtension.initialize(),this.browserExtension.sendPayload({type:"versions",sdkVersion:e,snippetVersion:Ps(this.window)}),this.browserExtension.sendPayload({type:"config",config:t});if((!0===r.compliance.opt_in||!0===r.compliance.opt_in.new_customer_profile)&&(i=this.cookies.setFreshTrackingCookie(),this.config.setNewCustomerIds({cookie:i}),this.browserExtension.sendPayload({type:"ids",ids:{cookie:i}})),this.cookies.sanitizeCookieOptions(),this.featureFlags.flags.sdk854_implement_trace_sampling&&void 0===t.error_reporting&&this.config.extendOptions({error_reporting:!0}),r.feature_flags&&this.featureFlags.setFlags(r.feature_flags),this.experimentsEditor.matchUrlWithParams(),this.experimentsEditor.areEditorParamsInURL()&&(this.experimentsEditor.placeParamsFromURLToStorage(),this.experimentsEditor.removeParamsFromURL()),this.experimentsEditor.shouldStartEditor())return void this.experimentsEditor.bootstrapEditor();this.time.queryTime(),this.pushWebApi.initialize(),i&&(this.config.extendOptions({customer:Object.assign(Object.assign({},r.customer),{cookie:i})}),this.debug.log("cookie retrieved from browser: "+i),jr((()=>{me(r.cookies.retrieve_callback)&&(r.cookies.retrieve_callback(i),r.cookies.retrieve_callback=null)})));const s=r.transfer_identity?this.transferIdentity.getTransferIdentityFirstClickToken():void 0;this.customer.requestCustomerIdsFromServer({cookie:i,tifc:s},(e=>{this.browserExtension.sendPayload({type:"ids",ids:e}),i||jr((()=>{me(r.cookies.retrieve_callback)&&(r.cookies.retrieve_callback(e.cookie),r.cookies.retrieve_callback=null)})),s&&r.link_cookie&&jr((()=>{this.executeLinkCookies(r.link_cookie)}))})),r.transfer_identity&&(this.debug.log("transferring identity from URL"),this.config.extendOptions({customer:Object.assign(Object.assign({},r.customer),this.transferIdentity.getCustomerIdentityFromUrl())})),this.eventTracker.addUtmParamsToDefaultEventPropertiesIfEnabled(),this.eventTracker.addTrackDefaultPropertiesToDefaultEventPropertiesIfEnabled(),r.track&&r.track.google_analytics&&this.customer.identifyCustomerWithGoogleAnalyticsId(),this.userActivityTracking.trackExitsWithDataAttribute(),this.campaignClicks.parseUrlAndTrackCampaignClick(),r.ping&&(r.ping.enabled||r.lazy_merge)||this.customer.identifyCustomer(r.customer),!s&&r.link_cookie&&jr((()=>{this.executeLinkCookies(r.link_cookie)})),this.ping.restartPinging(),this.userActivityTracking.startActivityTracking(),this.eventTracker.trackPageVisitEventIfEnabled(),this.queryTracking.initialize(),this.tracing.tracePromise(this.getDefinitions(this.queue)).then((e=>{this.featureFlags.flags.ep3_use_new_experiments?function(e,t,i,n){Os(e,"webLayers")&&t.processDefinition(n.webLayers),Os(e,"tagManager")&&i.processDefinition(n.constantManagedTags)}(this.config,this.webLayers,this.managedTags,e):function(e,t,i,n,r){Os(e,"experiments")&&t.processDefinition(r.experiments),Os(e,"webLayers")&&i.processDefinition(r.webLayers),Os(e,"tagManager")&&n.processDefinition(r.constantManagedTags)}(this.config,this.experiments,this.webLayers,this.managedTags,e)})),this.featureFlags.flags.ep3_use_new_experiments&&!this.config.getOptions().new_experiments&&(!function(e,t){const i=encodeURIComponent(window.location.href.split("#")[0]),n="webxpClient",r=`${e.target}/webxp/script-async/${window[n].sign}/modifications.min.js?http-referer=${i}`;window[n].skipExperiments=!0,window[n].legacyFlickeringMode=!0;const s=document.createElement("script");s.src=r,s.onload=()=>t.resolve(!0),s.onerror=e=>t.reject(e);const o=document.getElementsByTagName("script")[0];o&&o.parentNode&&o.parentNode.insertBefore(s,o)}(this.config.getOptions(),this.webxpClientReadyRemote),this.config.isSpaReloadingEnabled("experiments")&&this.url.onChange("onUrlChangeFilterAndApplyExperiments",(()=>window[w].reset()))),Os(this.config,"experiments")&&this.newExperiments.initialize(),Os(this.config,"tagManager")&&this.managedTags.queryNonConstantManagedTagsAndShowOnUrlChange(),this.unloader.initialize(),this.pushSafariApi.handleDeniedSubscription(),this.performanceTracker.trackPerformanceMetricsWhenAvailable(),this.debug.log('The SDK initialization is finished, SDK is marked as "initialized" now'),this.initializeState.markInitialized(),n.end()}catch(e){if(this.queue.clear(),this.initializeState.markFailedInitialization(),e instanceof js)throw n.destroy(),e;n.setError(e),n.end(),this.debug.error(e)}}preProcessCustomerIds(e){"number"!=typeof e.customer&&"string"!=typeof e.customer||(e.customer={registered:e.customer}),e.customer&&("cookie"in e.customer&&delete e.customer.cookie,e.customer=this.customer.filterEmptyCustomerIds(e.customer),this.config.extendOptions(e))}isComplianceConfigurationChanged(e){const t=e.compliance;if(void 0===t)return!1;const i=this.config.getOptions().compliance;return!It(t,i)}executeLinkCookies(e){let t,i;"object"==typeof e&&me(e.link_cookie_initialize_success)&&(t=e.link_cookie_initialize_success,me(e.link_cookie_initialize_error)&&(i=e.link_cookie_initialize_error)),this.customer.linkCustomerIds(t,i)}}class Is{constructor(){this.initializing=!1,this.initialized=!1,this.initializedPromiseResolve=()=>{},this.initializedPromiseReject=()=>{},this.initializedPromise=new Promise(((e,t)=>{this.initializedPromiseResolve=e,this.initializedPromiseReject=t}))}markInitializing(){this.initializing=!0,this.initialized=!1}markInitialized(){this.initializing=!1,this.initialized=!0,this.initializedPromiseResolve()}markFailedInitialization(){this.initializing=!1,this.initialized=!1,this.initializedPromiseReject()}isInitializing(){return this.initializing}isInitialized(){return this.initialized}whenInitialized(){return this.initializedPromise}}const Bs="sendBeacon"in navigator;var zs;!function(e){e[e.Ready=0]="Ready",e[e.Sending=1]="Sending",e[e.Sent=2]="Sent"}(zs||(zs={}));class Ds{constructor(e,t,i,n,r=Bs){this.tracing=e,this.debug=t,this.eventTracker=i,this.eventTypeAndPropertiesGetter=n,this.isSendBeaconSupported=r,this.EVENT_TRIGGERED_DEADLINE=300,this.phase=zs.Ready,this.lockedUntil=0,this.timeoutID=void 0}trackClick(e){const t=e.target,i=this.eventTypeAndPropertiesGetter(t);this.isSendBeaconSupported?this._trackClickWithBeacon(i):(this.phase===zs.Ready&&(e.preventDefault(),e.stopImmediatePropagation()),this._trackClickWithoutBeacon(t,i))}_trackClickWithBeacon({type:e,properties:t}){this.eventTracker.track(e,t)}_trackClickWithoutBeacon(e,{type:t,properties:i}){if(this.phase===zs.Ready){const n=this.tracing.trace((()=>{e.click()}));if((new Date).getTime()<this.lockedUntil)return void this.debug.log("Ignoring apparent duplicate click");this.phase=zs.Sending,this.timeoutID=setTimeout((()=>{this.debug.log("Click timed out"),this.phase===zs.Sending&&n()}),this.EVENT_TRIGGERED_DEADLINE),this.eventTracker.track(t,i,{successCallback:()=>{this.debug.log("Click tracked successfully"),clearTimeout(this.timeoutID),delete this.timeoutID,this.phase=zs.Sent,n()},errorCallback:()=>{this.debug.error("Cannot connect to server."),clearTimeout(this.timeoutID),delete this.timeoutID,this.phase=zs.Sent,n()}})}else this.phase===zs.Sending?(clearTimeout(this.timeoutID),delete this.timeoutID,this.phase=zs.Ready,this.lockedUntil=(new Date).getTime()+500):this.phase===zs.Sent&&(this.phase=zs.Ready,this.lockedUntil=(new Date).getTime()+500)}}class Fs{constructor(e,t,i,n){this.tracing=e,this.eventTracker=t,this.debug=i,this.documentContentLoaded=n}trackLink(e,t,i){const n=new Ds(this.tracing,this.debug,this.eventTracker,(e=>{if(me(t)){return t(e)}return{type:t,properties:i||{}}}));or(e)?this.tracing.tracePromise(this.documentContentLoaded.whenLoaded()).then((function(){const t=di(e);for(let e=0;e<t.length;e++)t[e].onclick=e=>n.trackClick(e)})):e.onclick=e=>n.trackClick(e)}}function Rs(e,t,i){return"attachEvent"in e&&"function"==typeof e?e.attachEvent("on"+t,i):e.addEventListener(t,i,!1)}class Ms{constructor(e,t){this.tracing=e,this.document=t,this._liveEventListeners={click:[],submit:[]}}initialize(){this._registerLiveEventListener("submit"),this._registerLiveEventListener("click")}_handleLiveEventListeners(e,t){e.forEach((e=>{try{di.matchesSelector(t.target,e.selector)&&e.callback(t)}catch(e){if(!(e instanceof Error))throw e}}))}addLiveEventListener(e,t,i){this._liveEventListeners[e].push({selector:t,callback:i})}clearLiveEventListeners(){this._liveEventListeners={click:[],submit:[]}}_registerLiveEventListener(e){Rs(this.document,e,(t=>this._handleLiveEventListeners(this._liveEventListeners[e],t)))}}gi([Dr("LiveEventHandler.initialize"),mi("design:type",Function),mi("design:paramtypes",[]),mi("design:returntype",void 0)],Ms.prototype,"initialize",null),gi([Dr({operation:"LiveEventHandler._handleLiveEventListeners",onRoot:!0}),mi("design:type",Function),mi("design:paramtypes",[Array,Event]),mi("design:returntype",void 0)],Ms.prototype,"_handleLiveEventListeners",null);class Ns{constructor(e,t){this.console=e,this.logPrefix=t}getMessagePrefix(){const e=(new Date).toUTCString();return`${this.logPrefix} [${e}]`}error(...e){this.print("error",e)}log(...e){this.print("log",e)}warn(...e){this.print("warn",e)}debug(...e){this.print("debug",e)}print(e,t){this.isConsoleSupported(e)&&0!==t.length&&("string"==typeof t[0]?t[0]=`${this.getMessagePrefix()} ${t[0]}`:t.unshift(this.getMessagePrefix()),this.console[e](...t))}isConsoleSupported(e){return void 0!==this.console&&"function"==typeof this.console[e]}}var qs={};
/**
     * @file postscribe
     * @description Asynchronously write javascript, even with document.write.
     * @version v2.0.8
     * @see {@link https://krux.github.io/postscribe}
     * @license MIT
     * @author Derek Brans
     * @copyright 2016 Krux Digital, Inc
     */
!function(e,t){var i;i=function(){return function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={exports:{},id:n,loaded:!1};return e[n].call(r.exports,r,r.exports,i),r.loaded=!0,r.exports}return i.m=e,i.c=t,i.p="",i(0)}([function(e,t,i){var n,r=i(1),s=(n=r)&&n.__esModule?n:{default:n};e.exports=s.default},function(e,t,i){t.__esModule=!0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e};t.default=m;var r,s=i(2),o=(r=s)&&r.__esModule?r:{default:r},a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i(4));function c(){}var u={afterAsync:c,afterDequeue:c,afterStreamStart:c,afterWrite:c,autoFix:!0,beforeEnqueue:c,beforeWriteToken:function(e){return e},beforeWrite:function(e){return e},done:c,error:function(e){throw new Error(e.msg)},releaseAsync:!1},h=0,l=[],d=null;function p(){var e=l.shift();if(e){var t=a.last(e);t.afterDequeue(),e.stream=g.apply(void 0,e),t.afterStreamStart()}}function g(e,t,i){(d=new o.default(e,i)).id=h++,d.name=i.name||d.id,m.streams[d.name]=d;var r=e.ownerDocument,s={close:r.close,open:r.open,write:r.write,writeln:r.writeln};function a(e){e=i.beforeWrite(e),d.write(e),i.afterWrite(e)}n(r,{close:c,open:c,write:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return a(t.join(""))},writeln:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return a(t.join("")+"\n")}});var u=d.win.onerror||c;return d.win.onerror=function(e,t,n){i.error({msg:e+" - "+t+": "+n}),u.apply(d.win,[e,t,n])},d.write(t,(function(){n(r,s),d.win.onerror=u,i.done(),d=null,p()})),d}function m(e,t,i){if(a.isFunction(i))i={done:i};else if("clear"===i)return l=[],d=null,void(h=0);i=a.defaults(i,u);var n=[e=/^#/.test(e)?window.document.getElementById(e.substr(1)):e.jquery?e[0]:e,t,i];return e.postscribe={cancel:function(){n.stream?n.stream.abort():n[1]=c}},i.beforeEnqueue(n),l.push(n),d||p(),e.postscribe}n(m,{streams:{},queue:l,WriteStream:o.default})},function(e,t,i){t.__esModule=!0;var n,r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},s=i(3),o=(n=s)&&n.__esModule?n:{default:n},a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i(4));function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var u="data-ps-",h="ps-style",l="ps-script";function d(e,t){var i=u+t,n=e.getAttribute(i);return a.existy(n)?String(n):n}function p(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=u+t;a.existy(i)&&""!==i?e.setAttribute(n,i):e.removeAttribute(n)}var g=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};c(this,e),this.root=t,this.options=i,this.doc=t.ownerDocument,this.win=this.doc.defaultView||this.doc.parentWindow,this.parser=new o.default("",{autoFix:i.autoFix}),this.actuals=[t],this.proxyHistory="",this.proxyRoot=this.doc.createElement(t.nodeName),this.scriptStack=[],this.writeQueue=[],p(this.proxyRoot,"proxyof",0)}return e.prototype.write=function(){var e;for((e=this.writeQueue).push.apply(e,arguments);!this.deferredRemote&&this.writeQueue.length;){var t=this.writeQueue.shift();a.isFunction(t)?this._callFunction(t):this._writeImpl(t)}},e.prototype._callFunction=function(e){var t={type:"function",value:e.name||e.toString()};this._onScriptStart(t),e.call(this.win,this.doc),this._onScriptDone(t)},e.prototype._writeImpl=function(e){this.parser.append(e);for(var t=void 0,i=void 0,n=void 0,r=[];(t=this.parser.readToken())&&!(i=a.isScript(t))&&!(n=a.isStyle(t));)(t=this.options.beforeWriteToken(t))&&r.push(t);r.length>0&&this._writeStaticTokens(r),i&&this._handleScriptToken(t),n&&this._handleStyleToken(t)},e.prototype._writeStaticTokens=function(e){var t=this._buildChunk(e);return t.actual?(t.html=this.proxyHistory+t.actual,this.proxyHistory+=t.proxy,this.proxyRoot.innerHTML=t.html,this._walkChunk(),t):null},e.prototype._buildChunk=function(e){for(var t=this.actuals.length,i=[],n=[],r=[],s=e.length,o=0;o<s;o++){var a=e[o],c=a.toString();if(i.push(c),a.attrs){if(!/^noscript$/i.test(a.tagName)){var d=t++;n.push(c.replace(/(\/?>)/," "+u+"id="+d+" $1")),a.attrs.id!==l&&a.attrs.id!==h&&r.push("atomicTag"===a.type?"":"<"+a.tagName+" "+u+"proxyof="+d+(a.unary?" />":">"))}}else n.push(c),r.push("endTag"===a.type?c:"")}return{tokens:e,raw:i.join(""),actual:n.join(""),proxy:r.join("")}},e.prototype._walkChunk=function(){for(var e=void 0,t=[this.proxyRoot];a.existy(e=t.shift());){var i=1===e.nodeType;if(!i||!d(e,"proxyof")){i&&(this.actuals[d(e,"id")]=e,p(e,"id"));var n=e.parentNode&&d(e.parentNode,"proxyof");n&&this.actuals[n].appendChild(e)}t.unshift.apply(t,a.toArray(e.childNodes))}},e.prototype._handleScriptToken=function(e){var t=this,i=this.parser.clear();i&&this.writeQueue.unshift(i),e.src=e.attrs.src||e.attrs.SRC,(e=this.options.beforeWriteToken(e))&&(e.src&&this.scriptStack.length?this.deferredRemote=e:this._onScriptStart(e),this._writeScriptToken(e,(function(){t._onScriptDone(e)})))},e.prototype._handleStyleToken=function(e){var t=this.parser.clear();t&&this.writeQueue.unshift(t),e.type=e.attrs.type||e.attrs.TYPE||"text/css",(e=this.options.beforeWriteToken(e))&&this._writeStyleToken(e),t&&this.write()},e.prototype._writeStyleToken=function(e){var t=this._buildStyle(e);this._insertCursor(t,h),e.content&&(t.styleSheet&&!t.sheet?t.styleSheet.cssText=e.content:t.appendChild(this.doc.createTextNode(e.content)))},e.prototype._buildStyle=function(e){var t=this.doc.createElement(e.tagName);return t.setAttribute("type",e.type),a.eachKey(e.attrs,(function(e,i){t.setAttribute(e,i)})),t},e.prototype._insertCursor=function(e,t){this._writeImpl('<span id="'+t+'"/>');var i=this.doc.getElementById(t);i&&i.parentNode.replaceChild(e,i)},e.prototype._onScriptStart=function(e){e.outerWrites=this.writeQueue,this.writeQueue=[],this.scriptStack.unshift(e)},e.prototype._onScriptDone=function(e){e===this.scriptStack[0]?(this.scriptStack.shift(),this.write.apply(this,e.outerWrites),!this.scriptStack.length&&this.deferredRemote&&(this._onScriptStart(this.deferredRemote),this.deferredRemote=null)):this.options.error({msg:"Bad script nesting or script finished twice"})},e.prototype._writeScriptToken=function(e,t){var i=this._buildScript(e),n=this._shouldRelease(i),r=this.options.afterAsync;e.src&&(i.src=e.src,this._scriptLoadHandler(i,n?r:function(){t(),r()}));try{this._insertCursor(i,l),i.src&&!n||t()}catch(e){this.options.error(e),t()}},e.prototype._buildScript=function(e){var t=this.doc.createElement(e.tagName);return a.eachKey(e.attrs,(function(e,i){t.setAttribute(e,i)})),e.content&&(t.text=e.content),t},e.prototype._scriptLoadHandler=function(e,t){function i(){e=e.onload=e.onreadystatechange=e.onerror=null}var n=this.options.error;function s(){i(),null!=t&&t(),t=null}function o(e){i(),n(e),null!=t&&t(),t=null}function a(e,t){var i=e["on"+t];null!=i&&(e["_on"+t]=i)}a(e,"load"),a(e,"error"),r(e,{onload:function(){if(e._onload)try{e._onload.apply(this,Array.prototype.slice.call(arguments,0))}catch(t){o({msg:"onload handler failed "+t+" @ "+e.src})}s()},onerror:function(){if(e._onerror)try{e._onerror.apply(this,Array.prototype.slice.call(arguments,0))}catch(t){return void o({msg:"onerror handler failed "+t+" @ "+e.src})}o({msg:"remote script failed "+e.src})},onreadystatechange:function(){/^(loaded|complete)$/.test(e.readyState)&&s()}})},e.prototype._shouldRelease=function(e){return!/^script$/i.test(e.nodeName)||!!(this.options.releaseAsync&&e.src&&e.hasAttribute("async"))},e}();t.default=g},function(e,t,i){
/**
    		 * @file prescribe
    		 * @description Tiny, forgiving HTML parser
    		 * @version vundefined
    		 * @see {@link https://github.com/krux/prescribe/}
    		 * @license MIT
    		 * @author Derek Brans
    		 * @copyright 2016 Krux Digital, Inc
    		 */
var n;n=function(){return function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={exports:{},id:n,loaded:!1};return e[n].call(r.exports,r,r.exports,i),r.loaded=!0,r.exports}return i.m=e,i.c=t,i.p="",i(0)}([function(e,t,i){var n,r=i(1),s=(n=r)&&n.__esModule?n:{default:n};e.exports=s.default},function(e,t,i){t.__esModule=!0;var n,r=u(i(2)),s=u(i(3)),o=i(6),a=(n=o)&&n.__esModule?n:{default:n},c=i(5);function u(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var l={comment:/^<!--/,endTag:/^<\//,atomicTag:/^<\s*(script|style|noscript|iframe|textarea)[\s\/>]/i,startTag:/^</,chars:/^[^<]/},d=function(){function e(){var t=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};h(this,e),this.stream=i;var s=!1,o={};for(var c in r)r.hasOwnProperty(c)&&(n.autoFix&&(o[c+"Fix"]=!0),s=s||o[c+"Fix"]);s?(this._readToken=(0,a.default)(this,o,(function(){return t._readTokenImpl()})),this._peekToken=(0,a.default)(this,o,(function(){return t._peekTokenImpl()}))):(this._readToken=this._readTokenImpl,this._peekToken=this._peekTokenImpl)}return e.prototype.append=function(e){this.stream+=e},e.prototype.prepend=function(e){this.stream=e+this.stream},e.prototype._readTokenImpl=function(){var e=this._peekTokenImpl();if(e)return this.stream=this.stream.slice(e.length),e},e.prototype._peekTokenImpl=function(){for(var e in l)if(l.hasOwnProperty(e)&&l[e].test(this.stream)){var t=s[e](this.stream);if(t)return"startTag"===t.type&&/script|style/i.test(t.tagName)?null:(t.text=this.stream.substr(0,t.length),t)}},e.prototype.peekToken=function(){return this._peekToken()},e.prototype.readToken=function(){return this._readToken()},e.prototype.readTokens=function(e){for(var t=void 0;t=this.readToken();)if(e[t.type]&&!1===e[t.type](t))return},e.prototype.clear=function(){var e=this.stream;return this.stream="",e},e.prototype.rest=function(){return this.stream},e}();for(var p in t.default=d,d.tokenToString=function(e){return e.toString()},d.escapeAttributes=function(e){var t={};for(var i in e)e.hasOwnProperty(i)&&(t[i]=(0,c.escapeQuotes)(e[i],null));return t},d.supports=r,r)r.hasOwnProperty(p)&&(d.browserHasFlaw=d.browserHasFlaw||!r[p]&&p)},function(e,t){t.__esModule=!0;var i=!1,n=!1,r=window.document.createElement("div");try{var s="<P><I></P></I>";r.innerHTML=s,t.tagSoup=i=r.innerHTML!==s}catch(e){t.tagSoup=i=!1}try{r.innerHTML="<P><i><P></P></i></P>",t.selfClose=n=2===r.childNodes.length}catch(e){t.selfClose=n=!1}r=null,t.tagSoup=i,t.selfClose=n},function(e,t,i){t.__esModule=!0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.comment=function(e){var t=e.indexOf("--\x3e");if(t>=0)return new r.CommentToken(e.substr(4,t-1),t+3)},t.chars=function(e){var t=e.indexOf("<");return new r.CharsToken(t>=0?t:e.length)},t.startTag=o,t.atomicTag=function(e){var t=o(e);if(t){var i=e.slice(t.length);if(i.match(new RegExp("</\\s*"+t.tagName+"\\s*>","i"))){var n=i.match(new RegExp("([\\s\\S]*?)</\\s*"+t.tagName+"\\s*>","i"));if(n)return new r.AtomicTagToken(t.tagName,n[0].length+t.length,t.attrs,t.booleanAttrs,n[1])}}},t.endTag=function(e){var t=e.match(s.endTag);if(t)return new r.EndTagToken(t[1],t[0].length)};var r=i(4),s={startTag:/^<([\-A-Za-z0-9_]+)((?:\s+[\w\-]+(?:\s*=?\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)>/,endTag:/^<\/([\-A-Za-z0-9_]+)[^>]*>/,attr:/(?:([\-A-Za-z0-9_]+)\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+)))|(?:([\-A-Za-z0-9_]+)(\s|$)+)/g,fillAttr:/^(checked|compact|declare|defer|disabled|ismap|multiple|nohref|noresize|noshade|nowrap|readonly|selected)$/i};function o(e){var t,i,o;if(-1!==e.indexOf(">")){var a=e.match(s.startTag);if(a){var c=(t={},i={},o=a[2],a[2].replace(s.attr,(function(e,n){arguments[2]||arguments[3]||arguments[4]||arguments[5]?arguments[5]?(t[arguments[5]]="",i[arguments[5]]=!0):t[n]=arguments[2]||arguments[3]||arguments[4]||s.fillAttr.test(n)&&n||"":t[n]="",o=o.replace(e,"")})),{v:new r.StartTagToken(a[1],a[0].length,t,i,!!a[3],o.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""))});if("object"===(void 0===c?"undefined":n(c)))return c.v}}}},function(e,t,i){t.__esModule=!0,t.EndTagToken=t.AtomicTagToken=t.StartTagToken=t.TagToken=t.CharsToken=t.CommentToken=t.Token=void 0;var n=i(5);function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.Token=function e(t,i){r(this,e),this.type=t,this.length=i,this.text=""},t.CommentToken=function(){function e(t,i){r(this,e),this.type="comment",this.length=i||(t?t.length:0),this.text="",this.content=t}return e.prototype.toString=function(){return"\x3c!--"+this.content},e}(),t.CharsToken=function(){function e(t){r(this,e),this.type="chars",this.length=t,this.text=""}return e.prototype.toString=function(){return this.text},e}();var s=t.TagToken=function(){function e(t,i,n,s,o){r(this,e),this.type=t,this.length=n,this.text="",this.tagName=i,this.attrs=s,this.booleanAttrs=o,this.unary=!1,this.html5Unary=!1}return e.formatTag=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i="<"+e.tagName;for(var r in e.attrs)if(e.attrs.hasOwnProperty(r)){i+=" "+r;var s=e.attrs[r];void 0!==e.booleanAttrs&&void 0!==e.booleanAttrs[r]||(i+='="'+(0,n.escapeQuotes)(s)+'"')}return e.rest&&(i+=" "+e.rest),e.unary&&!e.html5Unary?i+="/>":i+=">",null!=t&&(i+=t+"</"+e.tagName+">"),i},e}();t.StartTagToken=function(){function e(t,i,n,s,o,a){r(this,e),this.type="startTag",this.length=i,this.text="",this.tagName=t,this.attrs=n,this.booleanAttrs=s,this.html5Unary=!1,this.unary=o,this.rest=a}return e.prototype.toString=function(){return s.formatTag(this)},e}(),t.AtomicTagToken=function(){function e(t,i,n,s,o){r(this,e),this.type="atomicTag",this.length=i,this.text="",this.tagName=t,this.attrs=n,this.booleanAttrs=s,this.unary=!1,this.html5Unary=!1,this.content=o}return e.prototype.toString=function(){return s.formatTag(this,this.content)},e}(),t.EndTagToken=function(){function e(t,i){r(this,e),this.type="endTag",this.length=i,this.text="",this.tagName=t}return e.prototype.toString=function(){return"</"+this.tagName+">"},e}()},function(e,t){t.__esModule=!0,t.escapeQuotes=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e?e.replace(/([^"]*)"/g,(function(e,t){return/\\/.test(t)?t+'"':t+'\\"'})):t}},function(e,t){t.__esModule=!0,t.default=function(e,t,i){var o=function(){var e=[];return e.last=function(){return this[this.length-1]},e.lastTagNameEq=function(e){var t=this.last();return t&&t.tagName&&t.tagName.toUpperCase()===e.toUpperCase()},e.containsTagName=function(e){for(var t,i=0;t=this[i];i++)if(t.tagName===e)return!0;return!1},e}(),a={startTag:function(i){var r=i.tagName;"TR"===r.toUpperCase()&&o.lastTagNameEq("TABLE")?(e.prepend("<TBODY>"),c()):t.selfCloseFix&&n.test(r)&&o.containsTagName(r)?o.lastTagNameEq(r)?s(e,o):(e.prepend("</"+i.tagName+">"),c()):i.unary||o.push(i)},endTag:function(n){o.last()?t.tagSoupFix&&!o.lastTagNameEq(n.tagName)?s(e,o):o.pop():t.tagSoupFix&&(i(),c())}};function c(){var t=function(e,t){var i=e.stream,n=r(t());return e.stream=i,n}(e,i);t&&a[t.type]&&a[t.type](t)}return function(){return c(),r(i())}};var i=/^(AREA|BASE|BASEFONT|BR|COL|FRAME|HR|IMG|INPUT|ISINDEX|LINK|META|PARAM|EMBED)$/i,n=/^(COLGROUP|DD|DT|LI|OPTIONS|P|TD|TFOOT|TH|THEAD|TR)$/i;function r(e){return e&&"startTag"===e.type&&(e.unary=i.test(e.tagName)||e.unary,e.html5Unary=!/\/>$/.test(e.text)),e}function s(e,t){var i=t.pop();e.prepend("</"+i.tagName+">")}}])},e.exports=n()},function(e,t){t.__esModule=!0;var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function n(e){return null!=e}function r(e,t,i){var n=void 0,r=e&&e.length||0;for(n=0;n<r;n++)t.call(i,e[n],n)}function s(e,t,i){for(var n in e)e.hasOwnProperty(n)&&t.call(i,n,e[n])}function o(e,t){return!(!e||"startTag"!==e.type&&"atomicTag"!==e.type||!("tagName"in e)||!~e.tagName.toLowerCase().indexOf(t))}t.existy=n,t.isFunction=function(e){return"function"==typeof e},t.each=r,t.eachKey=s,t.defaults=function(e,t){return e=e||{},s(t,(function(t,i){n(e[t])||(e[t]=i)})),e},t.toArray=function(e){try{return Array.prototype.slice.call(e)}catch(s){var t=(n=[],r(e,(function(e){n.push(e)})),{v:n});if("object"===(void 0===t?"undefined":i(t)))return t.v}var n},t.last=function(e){return e[e.length-1]},t.isTag=o,t.isScript=function(e){return o(e,"script")},t.isStyle=function(e){return o(e,"style")}}])},e.exports=i()}({get exports(){return qs},set exports(e){qs=e}});var Us=Kr(qs);class Ws{constructor(e,t,i,n,r,s,o){this.tracing=e,this.config=t,this.queue=i,this.location=n,this.document=r,this.debug=s,this.url=o}queryNonConstantManagedTagsAndShowOnUrlChange(){this.queryNonConstantManagedTagsAndShow(!0),this.config.isSpaReloadingEnabled("tags")&&this.url.onChange("onUrlChangeQueryNonConstantManagedTagsAndShow",(()=>{this.queryNonConstantManagedTagsAndShow(!1)}))}showManagedTag(e){this.debug.log("Showing managed tag...",e);const t="definition"in e?e.definition:e.parametrized_definition;if("js"===e.type){let e;try{e=new Function(t)}catch(e){return this.debug.error("Syntax error in the managed tag javascript code.\n\nThis is not an SDK error but rather an error in a managed tag javascript code.\nCheck managed tags javascript code for syntax errors, such errors are usually\nhighlighted in the UI. The first line of the stack trace below should give you\na clue.\n\n",e)}try{e()}catch(e){this.debug.error("Error when executing the managed tag javascript code.\n\nThis is not an SDK error but rather an error in a managed tag javascript code.\nCheck managed tags javascript code for errors. This is not a syntax error and\nmay be hard to spot, but the first line of the stack trace below should give\nyou a clue.\n\n",e)}}else if("html"===e.type)try{Us(this.document.body,t)}catch(e){this.debug.error("Error when applying an html managed tag.\n\nThere was an error when applying the html managed tag using\nPostscribe (https://github.com/krux/postscribe/).\n\n",e)}else this.debug.error(`Unknown managed tag type "${e.type}". The type\nmay only be "html" or "js".`)}processDefinition(e){this.debug.log("Processing managed tags...",e),this.removeOverlayAndShowManagedTags(e,!0),this.config.isSpaReloadingEnabled("tags")&&this.url.onChange("onUrlChangeRemoveOverlayAndShowManagedTags",(()=>{this.removeOverlayAndShowManagedTags(e,!1)}))}removeOverlayAndShowManagedTags(e,t){if(t){const t=this.document.getElementById("__exponea__overlay__"),i=!t&&this.config.getOptions().modify.overlay&&!!window[c].__;this.filterAndShowManagedTags(e,i),t&&t.parentElement&&t.parentElement.removeChild(t)}else this.filterAndShowManagedTags(e,!1)}queryNonConstantManagedTagsAndShow(e){let t=Yn(this.config.getOptions().customer);this.queue.enqueue({name:Nr.ManagedTagsShow,noBulk:!0,prepareData:()=>(this.debug.log("Getting non-constant managed tags"),t&&t.cookie||(t=Yn(this.config.getOptions().customer)),{data:{company_id:this.config.getToken(),customer_ids:t,current_url:this.location.href}}),processResponse:t=>{this.removeOverlayAndShowManagedTags(t.data,e)},processError:e=>{this.debug.error("Error getting non-constant managed tags",e)}})}filterAndShowManagedTags(e,t){const i=os(Jr.ManagedTag,this.debug);this.showManagedTags(e.filter(i("overlay",(e=>!t||!e.uses_overlay))).filter(i("page",(e=>!("trigger"in e)||cs.matches(this.location.href,e.trigger)))))}showManagedTags(e){e.forEach((e=>this.showManagedTag(e)))}}gi([Dr("queryNonConstantManagedTagsAndShow"),mi("design:type",Function),mi("design:paramtypes",[]),mi("design:returntype",void 0)],Ws.prototype,"queryNonConstantManagedTagsAndShowOnUrlChange",null),gi([Dr("showManagedTag"),mi("design:type",Function),mi("design:paramtypes",[Object]),mi("design:returntype",void 0)],Ws.prototype,"showManagedTag",null);class $s{constructor(e,t,i,n,r,s,o){this.tracing=e,this.window=t,this.serviceWorkerManager=i,this.database=n,this.storageUtils=r,this.config=s,this.logger=o,this.webExperienceObject=this.getWebExperienceObject()}initialize(){const e=this.config.getNewExperimentsOptions();if(e&&"sync"===e.mode&&this.serviceWorkerManager.isAvailable()&&this.database.isSupported()&&this.storageUtils.isStorageAvailable("localStorage")){const e=this.config.storeInIndexedDB().then((()=>this.serviceWorkerManager.isRegistered())).then((t=this.serviceWorkerManager,i=this.storageUtils,function(e){if(!e)return i.removeFromStorage("localStorage",d),t.register().then((()=>{Hs(i)}));Hs(i)})).catch((e=>{this.logger.error('Failed to initialize the "sync" mode for the new experiments because of:',e),this.logger.error('The SDK will now use the new experiments in "async" mode. Note that the service worker is only required for the "sync" mode. If you don\'t want to use it, consider switching to the "async" mode. Read more in https://docs.exponea.com/docs/integrating-and-using-experiments.')}));this.tracing.tracePromise(e)}var t,i}areAlreadyApplied(){return!(!this.webExperienceObject||!this.webExperienceObject.skipExperiments)}getWebExperienceObject(){const e=this.window[c],t=e&&e.webxp,i=this.window[w];return t||i}}function Hs(e){e.writeToStorage("localStorage",d,!0)}gi([Dr("NewExperiments.initialize"),mi("design:type",Function),mi("design:paramtypes",[]),mi("design:returntype",void 0)],$s.prototype,"initialize",null);class Vs{constructor(e,t,i,n,r=Date){this.window=e,this.config=t,this.debug=i,this.tracing=n,this.date=r}trackPerformanceMetricsWhenAvailable(){const e=this.config.getNewExperimentsOptions();if(!e)return;const t=this.window[c]._performance;!function(e){if(!e)return!1;return!(!e.snippetStartTime||!e.nowFn)}(t)?this.debug.debug("Performance metrics are not available"):!function(e){return!(!e.fastExperimentsEndTime||!e.personalizedExperimentsEndTime)}(t)?t.callbackFn=()=>this.trackMetricsSpans(t,e):this.trackMetricsSpans(t,e)}trackMetricsSpans(e,t){e.callbackFn&&delete e.callbackFn;const i=e.fastExperimentsEndTime-e.snippetStartTime,n=e.personalizedExperimentsEndTime-e.snippetStartTime,r=function(e,t,i){if(i>1e9)return i;if(!e.performance)throw new Error("Unexpected condition failed: the snippet start time is a small number but window.performance is not available!");const n=e.performance.now();return t.now()-Math.round(n-i)}(this.window,this.date,e.snippetStartTime),s={id:on(16),start_time:r/1e3,duration:i/1e3,operation:"modificationFast",tags:{status:i<=t.timeout?"success":"timeout"}},o={id:on(16),start_time:r/1e3,duration:n/1e3,operation:"modificationPersonalized",tags:{status:n<=t.timeout?"success":"timeout"}};this.debug.log("Adding spans with performance metrics"),this.debug.log(`Fast experiments: ${i}ms, slow experiments: ${n}ms`),this.tracing.addSerializedSpanToSend(s,o)}}const Gs={click:!0,key:!0,move:!0,scroll:!0},Ks={click:["click","mousedown","pointerdown","touchstart"],move:["mousemove","pointermove"],key:["keydown"],scroll:["wheel","touchmove","scroll"]};class Qs{constructor(e,t={},i){this.window=e,this.activityCallback=i,this.listenersRegistered=!1,this.options=Tn({},t,Gs)}registerActionListeners(){this.listenersRegistered||(sr(Ks,((e,t)=>{e.forEach((e=>{Rs(this.window,e,(()=>{this.options[t]&&(this.lastActivity=t,this.activityCallback&&this.activityCallback(t))}))}))})),this.listenersRegistered=!0)}setOptions(e){this.options=Tn({},e,this.options)}getLastUserActivity(){return this.lastActivity}resetActivity(){this.lastActivity=void 0}}class Js{constructor(e,t,i,n,r,s,o,a,c,u,h,l){this.tracing=e,this.config=t,this.timestamp=i,this.eventTracker=n,this.window=r,this.location=s,this.document=o,this.debug=a,this.cookies=c,this.storageUtils=u,this.unloader=h,this.url=l,this.activityHandler=new Qs(this.window,this.config.getActivityHandlerOptions(),(e=>this.resumePinging(e))),this.config.getOptions().track.unloads&&this.unloader.addListener((()=>{this.eventTracker.track("web_unload",this.getPingParams()||{})}))}sendPing(e=!1,t){const i=this.config.getOptions().ping;if(!i||!i.enabled)return this.stopPinging();const n=!!i.activity;if(e&&n&&!this.activityHandler.getLastUserActivity())return this.debug.log("No user activity detected so not pinging"),void this.stopPinging();this.debug.log("Sending session ping");const r=this.getPingParams(t);r&&this.eventTracker.track("session_ping",r),this.onSessionPing(),this.activityHandler.resetActivity()}restartPinging(){this.stopPinging();const e=this.config.getOptions().ping;e&&e.enabled&&(this.debug.log("Session ping is enabled"),this.activityHandler.registerActionListeners(),this.sendPing(!1,"page_load"),this.intervalId=this.window.setInterval((()=>this.sendPing(!0)),1e3*e.interval))}setOptions(e){this.debug.log("Changing ping configuration: ",e),this.config.extendOptions({ping:e}),this.setActivityHandlerOptions()}onSessionPing(e=(new Date).getTime()){const t=this.getLastSessionPing();this.storageUtils.isStorageAvailable("localStorage")&&((null===t||t<e-12e5)&&this.onSessionStart(e),this.setLastSessionPing(e))}getPingParams(e){const t=this.config.getOptions();if(t.ping){let n={};t.utm_params&&(n=this.url.getParams(t.utm_params)),Object.assign(n,t.ping.properties),n.referrer=this.document.referrer,n.location=this.location.href,n.path=this.location.pathname,e?n.activity=e:this.activityHandler&&this.activityHandler.getLastUserActivity()&&(n.activity=this.activityHandler.getLastUserActivity());const r=this.cookies.getCookie(i);return r&&(n.cookie=r),n}}getLastSessionStart(){return this.timestamp.getStoredTimestamp(a)}setActivityHandlerOptions(){this.activityHandler.setOptions(this.config.getActivityHandlerOptions())}onSessionStart(e=(new Date).getTime()){this.setLastSessionStart(e)}setLastSessionPing(e){this.timestamp.storeTimestamp(o,e)}setLastSessionStart(e){this.timestamp.storeTimestamp(a,e)}stopPinging(){this.intervalId&&(this.window.clearInterval(this.intervalId),this.intervalId=void 0)}resumePinging(e){const t=this.config.getOptions().ping;t&&t.enabled&&!this.intervalId&&(this.debug.log("Resuming session ping"),this.activityHandler.registerActionListeners(),this.sendPing(!1,e),this.intervalId=this.window.setInterval((()=>this.sendPing(!0)),1e3*t.interval))}getLastSessionPing(){return this.timestamp.getStoredTimestamp(o)}}function Ys(e,t=""){return function(i,n,r){const s=r.value,o=t+String(n);return r.value=function(){return Zs(e,o,arguments),Xs(e,o,arguments),s.apply(this,arguments)},r}}function Zs(e,t,i){const n=gr(e,(e=>!e.optional)).length;if(i.length<n)throw new js(`Invalid number of arguments when calling ${c}.${String(t)}, expected ${n} but got ${i.length}`)}function Xs(e,t,i){Se(i,((i,n)=>{const r=e[n];if(!r){if(n>=e.length)return;throw new js(`Missing definition for argument ${n} of ${c}.${t} inthe @${Ys.name} decorator!`)}if(void 0===i){if(r.optional)return;throw new js(`Missing argument ${n} - ${r.name} when calling ${c}.${t}, `+to(r)+" but got "+typeof i)}const s=typeof i;let o;switch(s){case"boolean":case"number":case"bigint":case"string":case"symbol":case"function":o=s;break;case"object":o=$(i)?"array":i instanceof HTMLElement?"element":null===i?"null":"object";break;default:throw eo(t,n,r,typeof i,i)}if("type"in r){if(o!==r.type)throw eo(t,n,r,o,i)}else if(!function(e,t,i){var n=$(e)?Je:pr;return i&&_n(e,t,i)&&(t=void 0),n(e,ai(t))}(r.oneOf,(e=>e===o)))throw eo(t,n,r,o,i)}))}function eo(e,t,i,n,r){return new js(`Invalid type of argument ${t} - ${i.name} when calling ${c}.${e}, `+to(i)+` but got ${n}: `+function(e,t){let i=String(e);"object"===t&&(i=JSON.stringify(e));"array"===t&&(i=`[${i}]`);if("element"===t){i=`HTMLElement ${e.tagName.toLowerCase()}`}i.length>128&&(i=i.substring(0,128)+"...");return i}(r,n))}function to(e){return"type"in e?`expected ${e.type}`:`expected one of ${e.oneOf.join(", ")}`}gi([Dr({operation:"sendPing",onRoot:!0}),mi("design:type",Function),mi("design:paramtypes",[Object,String]),mi("design:returntype",void 0)],Js.prototype,"sendPing",null);class io{constructor(e,t){this.pushWebApi=e,this.pushSafariApi=t,this._=[]}subscribe(e=(()=>{})){this.pushWebApi.isAvailable()?this.pushWebApi.subscribe(e):this.pushSafariApi.isAvailable()?this.pushSafariApi.subscribe(e):e(Yr.Unsupported)}unsubscribe(e=(()=>{})){this.pushWebApi.isAvailable()?this.pushWebApi.unsubscribe(e):this.pushSafariApi.isAvailable()?this.pushSafariApi.unsubscribe(e):e(Yr.Unsupported)}isAvailable(e){const t=this.pushWebApi.isAvailable()||this.pushSafariApi.isAvailable();return e&&e(t),t}isSubscribed(e){this.pushWebApi.isAvailable()?this.pushWebApi.isSubscribed(e):this.pushSafariApi.isAvailable()?this.pushSafariApi.isSubscribed(e):e(!1,!1)}}gi([Ys([{name:"callback",type:"function",optional:!0}],"notifications."),mi("design:type",Function),mi("design:paramtypes",[Function]),mi("design:returntype",void 0)],io.prototype,"subscribe",null),gi([Ys([{name:"callback",type:"function",optional:!0}],"notifications."),mi("design:type",Function),mi("design:paramtypes",[Function]),mi("design:returntype",void 0)],io.prototype,"unsubscribe",null),gi([Ys([{name:"callback",type:"function",optional:!0}],"notifications."),mi("design:type",Function),mi("design:paramtypes",[Function]),mi("design:returntype",Boolean)],io.prototype,"isAvailable",null),gi([Ys([{name:"callback",type:"function"}],"notifications."),mi("design:type",Function),mi("design:paramtypes",[Function]),mi("design:returntype",void 0)],io.prototype,"isSubscribed",null);class no{constructor(e,t,i,n,r){this.window=e,this.config=t,this.customer=i,this.location=n,this.storageUtils=r}subscribe(e,t={}){var i,n;const r=Object.assign({},this.config.getOptions().customer),s=this.getWebServiceUrl(),o=null===(i=this.config.getOptions().push.safari)||void 0===i?void 0:i.websitePushID;if(!o||!(null===(n=this.window.safari)||void 0===n?void 0:n.pushNotification))return void e(Yr.Unsupported);const a=this.window.safari.pushNotification.permission(o);if(!a)return void e(Yr.Error);const{permission:c}=a;"denied"!==c?this.window.safari.pushNotification.requestPermission(s,o,r,(({deviceToken:i,permission:n})=>{"granted"===n&&(this.storageUtils.writeToStorage("localStorage",l,!0),this.customer.updateCustomer(Object.assign({safari_push_notification:i},t))),e(this.getStatusForPermission(n))})):e(this.getStatusForPermission(c))}unsubscribe(e){this.storageUtils.writeToStorage("localStorage",l,!1),this.customer.updateCustomer({safari_push_notification:""},(()=>e(Yr.Unsubscribed)),(()=>e(Yr.Error)),!0)}handleDeniedSubscription(){this.isAvailable()&&this.isSafariSubscriptionEqual("denied")&&this.isPushTokenStoredInExponea((e=>{e&&this.unsubscribe((()=>{}))}))}isAvailable(e=this.location){var t,i;return!(!(null===(t=this.window.safari)||void 0===t?void 0:t.pushNotification)||!(null===(i=this.config.getOptions().push.safari)||void 0===i?void 0:i.websitePushID)||"https:"!==e.protocol&&"localhost"!==e.hostname&&"127.0.0.1"!==e.hostname)}isSubscribed(e){this.isPushTokenStoredInExponea((t=>{e(this.isSafariSubscriptionEqual("granted")&&t,this.isSafariSubscriptionEqual("denied"))}))}isPushTokenStoredInExponea(e){setTimeout((()=>{try{e(!!this.storageUtils.readBooleanFromStorage("localStorage",l))}catch(t){e(!1)}}))}isSafariSubscriptionEqual(e){var t,i;const n=null===(t=this.window.safari)||void 0===t?void 0:t.pushNotification,r=null===(i=this.config.getOptions().push.safari)||void 0===i?void 0:i.websitePushID;if(!n||!r)return!1;return n.permission(r).permission===e}getWebServiceUrl(){const{target:e}=this.config.getOptions(),t=this.config.getToken();let i=`${e.replace(/\/$/,"")}/integrations/push/projects/${t}/safari`;return/^\/\//.test(i)&&(i="https:"+i),i}getStatusForPermission(e){switch(e){case"granted":return Yr.Subscribed;case"denied":return Yr.PermissionDenied;default:return Yr.Default}}}class ro{constructor(e,t,i,n,r,s,o,a){this.window=e,this.location=t,this.debug=i,this.logger=n,this.config=r,this.customer=s,this.queue=o,this.serviceWorkerManager=a,this._setVapidKey=()=>{},this.vapidKeyPromise=new Promise((e=>this._setVapidKey=e))}initialize(){this.isAvailable()&&this.requestVapidKey()}subscribe(e,t={},i=Notification){"granted"===i.permission?this.subscribeServiceWorker(e,t):i.requestPermission((i=>{"granted"===i?this.subscribeServiceWorker(e,t):e("default"===i?Yr.Default:Yr.PermissionDenied)}))}unsubscribe(e){this.serviceWorkerManager.isReady().then((e=>e.pushManager.getSubscription())).then((e=>{if(e)return e.unsubscribe().then((e=>{if(!e)throw new Error("Failed to unsubscribe");this.notifyServer(!1)}))})).then((()=>e(Yr.Unsubscribed))).catch((()=>e(Yr.Error)))}isAvailable(e=this.location){const t=this.window;return"Notification"in t&&"PushManager"in t&&this.serviceWorkerManager.isAvailable()&&"showNotification"in t.ServiceWorkerRegistration.prototype&&("https:"===e.protocol||"localhost"===e.hostname||"127.0.0.1"===e.hostname)}isSubscribed(e,t=Notification){const{permission:i}=t,n="denied"===i;"granted"===i&&this.serviceWorkerManager.isAvailable()?this.serviceWorkerManager.register().then((()=>this.serviceWorkerManager.isReady())).then((e=>e.pushManager.getSubscription())).then((e=>{if(!e)throw new Error("Missing push notification subscription");return e})).then((()=>this.config.storeInIndexedDB())).then((()=>{e(!0,n)})).catch((t=>{this.logger.error("Failed to check whether the user is subscribed:",t),e(!1,n)})):e(!1,n)}notifyServer(e,t={}){if(e){const{data:i,vapidKey:n}=e;t[p]=i,t[g]=n||""}else t[p]="",t[g]="";this.customer.updateCustomer(t,void 0,void 0,!0)}subscribeServiceWorker(e,t){this.serviceWorkerManager.register().then((()=>this.serviceWorkerManager.isReady())).then((e=>this.config.storeInIndexedDB().then((()=>this.vapidKeyPromise)).then((e=>{if(void 0===e)return{vapidKey:void 0,vapidKeyUint8Array:void 0};try{return{vapidKey:e,vapidKeyUint8Array:so(e)}}catch(e){throw this.debug.error(new Error("Could not convert vapid key to Uint8Array. Maybe it is not in the Base64 format?")),e}})).then((({vapidKey:t,vapidKeyUint8Array:i})=>e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:i}).then((e=>({subscription:e,vapidKey:t}))))))).then((({subscription:i,vapidKey:n})=>{const r=Object.assign(Object.assign({},i.toJSON()),{vapidKey:!!n});this.notifyServer({data:r,vapidKey:n},t),e(Yr.Subscribed)})).catch((t=>{this.logger.error("Failed to subscribe the push notifications because of:",t),e(Yr.Error)}))}requestVapidKey(){this.queue.enqueue({name:tn.PushNotificationsVapidKey,prepareData:()=>({data:{company_id:this.config.getToken()}}),processResponse:({data:{vapidKey:e}})=>{this.debug.log(`Vapid key for browser push notifications is ${e}`),this._setVapidKey(e)},processError:()=>{this._setVapidKey(void 0)}})}}function so(e){const t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),i=atob(t),n=new Uint8Array(i.length);for(let e=0;e<i.length;++e)n[e]=i.charCodeAt(e);return n}class oo{constructor(e,t,i,n,r,s,o,a,c,u,h,l){this.tracing=e,this.config=t,this.queue=i,this.debug=n,this.timestamp=r,this.automaticTracking=s,this.window=o,this.eventTracker=a,this.customer=c,this.liveEventHandler=u,this.storageUtils=h,this.url=l}initialize(){this.config.getOptions().track.auto&&(this.liveEventHandler.initialize(),this._getTrackingDefinition())}_getTrackingDefinition(){this.debug.log("attempting to get tracking definition");const e=this._getCachedTrackingDefinition();e?this._trackByRules(e):this._fetchTrackingDefinitionAndTrackByRules()}_getCachedTrackingDefinition(){const e=this.storageUtils.readStringFromStorage("sessionStorage",r);if(!e)return this.debug.log("tracking definition not found in session storage"),null;this.debug.log("tracking definition found in session storage",e);let t=null;try{t=JSON.parse(e)}catch(e){this.debug.error("failed parsing cached tracked definition")}if(t){if(t.expires>this.timestamp.getUnixTimestamp())return t.data;this.debug.warn("tracking definition from session storage is expired")}return null}_fetchTrackingDefinitionAndTrackByRules(){this.queue.enqueue({name:tn.Tracking,prepareData:()=>(this.debug.log("fetching automatic tracking definition"),{data:{company_id:this.config.getToken()}}),processResponse:e=>{const{data:t}=e;this._storeTrackingDefinitionIntoCache(t),this._trackByRules(t)},processError:e=>{this.debug.error("Error getting automatic tracking definition",e)}})}_trackByRules(e){this._doTrackByRules(e),this.config.isSpaReloadingEnabled("automatic_tracking")&&this.url.onChange("QueryTracking.doTrackByRulesOnUrlChange",(()=>{this.liveEventHandler.clearLiveEventListeners(),this._doTrackByRules(e)}))}_doTrackByRules(e){e.filter((e=>cs.matches(this.window.location.href,e.trigger))).forEach((e=>{"visit"===e.trigger.type?this._doTrackAction(e.action,null):"click"===e.trigger.type?this._doBindOnClickHandlers(e.trigger.selector,e.action):"submit"===e.trigger.type&&this._doBindOnSubmitHandlers(e.trigger.selector,e.action)}))}_doBindOnClickHandlers(e,t){this.liveEventHandler.addLiveEventListener("click",e,(e=>{this._doTrackAction(t,e.target,{immediate:!Bs})}))}_doBindOnSubmitHandlers(e,t){this.liveEventHandler.addLiveEventListener("submit",e,(e=>{this._doTrackAction(t,e.target,{immediate:!Bs})}))}_storeTrackingDefinitionIntoCache(e){this.storageUtils.writeToStorage("sessionStorage",r,JSON.stringify({expires:this.timestamp.getUnixTimestamp()+3600,data:e}))}_doTrackAction(e,t,i={}){"track"===e.type?this.automaticTracking.materializeProperties(e.properties,t,this.tracing.trace("trackEvent",(t=>{this.eventTracker.track(e.event_type,t,i)}))):"identify"===e.type?this.automaticTracking.materializeIds(e.as_who,t,this.tracing.trace("identifyCustomer",(e=>{this.customer.identifyCustomer(e,{},void 0,void 0,i.immediate)}))):"update"===e.type&&this.automaticTracking.materializeProperties(e.properties,t,this.tracing.trace("updateCustomer",(e=>{this.customer.updateCustomer(e,void 0,void 0,i.immediate)})))}}gi([Dr("QueryTracking.initialize"),mi("design:type",Function),mi("design:paramtypes",[]),mi("design:returntype",void 0)],oo.prototype,"initialize",null);const ao={track:!1,callback:!0,retry:!0};class co{constructor(e,t,i,n,r){this.options=e,this.tracing=t,this.timestamp=i,this.debug=n,this.config=r,this.enqueuedAt=this.timestamp.getUnixTimestamp(),this.commandSpan=this.tracing.registerNewSpan("command"),this.commandSpan.addTags({command_name:e.name}),this.commandSpan.start(),this.requestSpan=this.tracing.registerNewSpan("httpRequest",this.commandSpan),this.commandSpan.end(),this.setApiCallPropertyOnRequestSpan()}get targetUrl(){return this.getCommandTargetUrl()}get name(){return this.options.name}processResponse(e,t,i){const n=this.options.processResponse;if(!n)return this.requestSpan.end();const r=this.tracing.registerNewSpan(this.requestSpan);Lr(this.debug,r,(()=>n(e,t,i)),!0),this.requestSpan.end()}processError(e,t={}){if((t=Tn(t,ao)).track&&this.requestSpan.setError(e),t.callback&&this.options.processError){const t=this.tracing.registerNewSpan(this.requestSpan),i=this.options.processError;Lr(this.debug,t,(()=>i(e)),!0)}if(t.retry){const e=this.requestSpan;this.requestSpan=this.tracing.registerNewSpan("httpRequest",this.commandSpan),this.setApiCallPropertyOnRequestSpan(),e.end()}else this.requestSpan.end()}prepareData(e){this.requestSpan.start();const t=this.options.prepareData;if(!t)return{state:void 0};try{return Lr(this.debug,this.commandSpan,(()=>t(e)))}catch(e){this.processError(e,{retry:!1})}}cancel(){this.commandSpan.destroy()}setApiCallPropertyOnRequestSpan(){this.requestSpan.setApiCall({method:this.getHttpRequestMethod(),url:this.targetUrl})}getHttpRequestMethod(){return ho(this)?"POST":"GET"}getCommandTargetUrl(){return po(this)?uo(`${this.config.getOptions().target}/${this.name}`,this.config):uo(`${this.config.getOptions().target}/bulk`,this.config)}}function uo(e,t){const i=t.getToken(),n=t.getOptions().customer.cookie||"";return e.replace(/<project_id>/g,i).replace(/<cookie>/g,n)}function ho(e){return!po(e)||e.options.httpMethod!==Cs.get}function lo(e){return!e.options.noBulk}function po(e){return!!e.options.noBulk}const go=36e5;function mo(e,t=5e3,i=2){return fo(e,t,i)}function fo(e,t=5e3,i,n=0){return function(){return n++,void setTimeout((function(){let r=t*i;r>go&&(r=go);if(n>=100)return void e();const s=fo(e,r,i,n);e(s)}),t)}}class bo{constructor(e){this.capacity=e,this.takenTokens=0}takeToken(){if(this.takenTokens===this.capacity)throw new Error("There is no free token to take");this.takenTokens++}releaseToken(){if(!this.takenTokens)throw new Error("There are no taken tickets");this.takenTokens--}hasFreeToken(){return this.takenTokens<this.capacity}}const yo="Command queue retry limit reached!",vo=Object.freeze({maxCommandsInQueue:1e3,maxCommandsProcessedInParallel:500,maxCommandsInBulkRequest:50,processDebounceTime:100}),wo=Object.freeze({first:!1,process:Tr.defer});class _o{constructor(e,t,i,n,r,s,o,a={},c=o.navigator){this.tracing=e,this.config=t,this.http=i,this.debug=n,this.timestamp=r,this.unloader=s,this.window=o,this.navigator=c,this.commandsList=[],this.isProcessingBlockingCommands=!1,this.numberOfEnqueuedCommandsIgnored=0,this.options=Object.freeze(Tn(a,vo)),this.unloader.addAfterListener((()=>{this.sendBulkWithBeacon()})),this.tokenSystem=new bo(this.options.maxCommandsProcessedInParallel),this.debounceProcess=tr((()=>this.process()),this.options.processDebounceTime)}get length(){return this.commandsList.length}enqueue(e,t={}){if(t=Tn(t,wo),this.debug.log("Enqueuing command "+e.name),this.isQueueExceeded())return this.debounceProcess(),!1;const i=new co(e,this.tracing,this.timestamp,this.debug,this.config);return t.first?this.commandsList.unshift(i):this.commandsList.push(i),t.process===Tr.immediate?this.process():t.process===Tr.defer?this.debounceProcess():this.debug.debug("Queue is not processing the enqueued command because 'process' is false"),!0}execute(e){this.debug.log("Executing command "+e.name);const t=new co(e,this.tracing,this.timestamp,this.debug,this.config),i=mo((e=>{To(t,this.tokenSystem,this.debug,this.sendSingle.bind(this),e)}),this.options.processDebounceTime,1);e.allowedToFail?this.sendSingle(t,void 0):To(t,this.tokenSystem,this.debug,this.sendSingle.bind(this),i)}clear(){this.commandsList.forEach((e=>e.cancel())),this.commandsList=[]}registerPostBulkCallback(e){this.postBulkCallback=e}process(){if(this.commandsList.length<=0)return void this.debug.debug("Queue is empty, there are no commands to process");if(this.isProcessingBlockingCommands)return this.debug.debug("Queue is currently processing blocking commands and has to wait"),void this.debounceProcess();this.debug.debug("Processing queue commands"),this.debug.debug(`There are ${this.length} enqueued commands`);const e=[];for(let t=this.commandsList.shift();t;t=this.commandsList.shift()){if(po(t)){const i=xo(t,this.tokenSystem,this.sendSingle.bind(this));i&&e.push(i)}else{const i=Eo(t,this.commandsList,this.tokenSystem,this.debug,this.options,(()=>this.isProcessingBlockingCommands=!0),this.sendBulk.bind(this));e.push(...i)}if(this.isProcessingBlockingCommands){this.debug.debug("Queue is now blocked and it cannot continue processing commands"),e.push(...this.commandsList);break}}this.debug.debug("Queue commands have been processed"),this.debug.debug(`There are ${e.length} commands that will be processed in the next batch after a timeout`,e),this.commandsList=e,this.commandsList.length>0&&this.debounceProcess()}sendBulkWithBeacon(){if(0===this.commandsList.length)return;const e=this.commandsList.filter(lo);this.debug.log("Queue is sending "+e.length+"/"+this.commandsList.length+" commands with beacon",e);var t;if(this.commandsList=this.commandsList.filter((t=lo,e=>!t(e))),0===e.length)return;const i=this.config.getOptions().target+"/bulk",{bulkData:n}=So(e,this.timestamp),r={beacon:!0,commands:n},s=new Blob([JSON.stringify(r)],{type:"application/json"});this.navigator.sendBeacon(i,s)||this.debug.warn("Beacon data has not been queued for transfer!")}sendBulk(t,i){if(!t.length)return;const n=`${this.config.getOptions().target}/bulk`,{bulkData:r,commandStates:s}=So(t,this.timestamp),o={sdk:"js-client",sdk_version:e,sdk_snippet_version:Ps(this.window),commands:r};this.debug.log(`Queue is sending ${t.length} commands in bulk`,t),this.http.post(n,o).then((e=>{const i=e.body;this.postBulkCallback&&this.postBulkCallback(),t.forEach(((e,t)=>{e.options.isBlocking&&(this.isProcessingBlockingCommands=!1);const n=i.results[t];"ok"===n.status?e.processResponse(n,s[t],{start_time:i.start_time,end_time:i.end_time}):e.processError(new Error(n.errors.join(", ")),{retry:!1}),this.tokenSystem.releaseToken()}))})).catch((e=>{this.debug.warn("Queue bulk request failed with errors:",e),ko(e)&&e.response.status<500?t.forEach((t=>{t.processError(e,{retry:!1}),this.tokenSystem.releaseToken()})):(t.forEach((t=>t.processError(e,{callback:!1}))),i?(this.debug.log("Retrying the request...",t),i()):t.forEach((e=>e.processError(new Error(yo)))))}))}sendSingle(e,t){const i=this.timestamp.getTimestamp(),n=e.prepareData(i);n&&(this.debug.log("Queue is sending a single command "+e.name,e),function(e,t,i){if(ho(t))return e.post(t.targetUrl,i.data);return e.get(t.targetUrl)}(this.http,e,n).then((t=>{e.options.isBlocking&&(this.isProcessingBlockingCommands=!1),e.processResponse(t.body,n.state),this.tokenSystem.releaseToken()})).catch((i=>{if(this.debug.warn("Queue single command request failed with errors:",i),ko(i)&&i.response.status<500){const t=new Error(function(e){const t=e.response.body;if("string"==typeof t)return t;return Object.entries(t.errors||{}).map((([e,t])=>`${e}: ${t.join(", ")}`)).join("; ")}(i));e.processError(t,{retry:!1}),this.tokenSystem.releaseToken()}else e.processError(i,{callback:!1}),t?(this.debug.log("Retrying the request...",e),t()):e.processError(new Error(yo))})))}isQueueExceeded(){const e=this.commandsList.length>=this.options.maxCommandsInQueue;return e?(this.numberOfEnqueuedCommandsIgnored+=1,1===this.numberOfEnqueuedCommandsIgnored&&this.debug.warn("Maximum queue length has been exceeded, further commands will be ignored")):this.numberOfEnqueuedCommandsIgnored>0&&(this.debug.debug(`Queue has been processed and it can receive commands again. There were ${this.numberOfEnqueuedCommandsIgnored} commands that were ignored.`),this.numberOfEnqueuedCommandsIgnored=0),e}}function ko(e){return e instanceof ks}function So(e,t){const i=[],n=[],r=t.getTimestamp();for(const t of e){const e=t.prepareData(r);e&&(i.push({name:t.name,data:e.data}),n.push(e.state))}return{bulkData:i,commandStates:n}}function To(e,t,i,n,r){if(xo(e,t,n)){if(!r){const t=`Max retry count reached for ${e.name}`;return i.error(t),void e.processError(new Error(t))}i.log(`Retry ${e.name} execution later because there were no free tokens...`),r()}}function xo(e,t,i){if(!t.hasFreeToken())return e;t.takeToken();const n=mo((t=>{i(e,t)}));return i(e,e.options.allowedToFail?void 0:n),null}function Eo(e,t,i,n,r,s,o){const a=[],c=[],u=[];for(;e;e=t.shift())if(po(e))c.push(e);else if(i.hasFreeToken()){if(i.takeToken(),e.options.isBlocking&&(s(),n.log("Queue encountered a blocking command"),n.log("Further requests will not be made until this one finishes")),a.push(e),a.length>=r.maxCommandsInBulkRequest)break}else u.push(e);t.unshift(...c);const h=a.every((e=>!!e.options.allowedToFail)),l=mo((e=>o(a,e)));return o(a,h?void 0:l),u}class Co{constructor(e,t,i){this.config=e,this.queue=t,this.debug=i}fetch(e,t){let i;i=or(e)?this.migrateOldGetRecommendationSignature.apply(this,t):e,this.queue.enqueue({name:Nr.Recommendation,noBulk:!0,prepareData:()=>(this.debug.log("Get recommendations: ",i.recommendationId),{data:this.processGetRecommendationOptions(i)}),processResponse:e=>{jr((()=>{i.callback(e.data)}))}})}processGetRecommendationOptions(e){const t=this.config.getOptions(),i={project_id:this.config.getToken(),customer_ids:t.customer,engine_id:e.recommendationId,anti:!!e.anti,similarity:!!e.similarity,anonymous:!!e.anonymous,consider_known_items:!!e.considerKnowItems,fill_with_random:e.fillWithRandom,catalog_filter:e.catalogFilter,catalog_attributes_whitelist:e.catalogAttributesWhitelist,category_names:e.categoryNames};if(e.size&&(i.size=e.size),e.strategy&&(i.strategy=e.strategy),e.item)i.items={},i.items[e.item]=1;else if($(e.items)&&e.items.length>0){i.items={};for(let t=0;t<e.items.length;t++)i.items[e.items[t]]=1}else ge(e.items)&&!function(e){if(null==e)return!0;if(fe(e)&&($(e)||"string"==typeof e||"function"==typeof e.splice||K(e)||se(e)||W(e)))return!e.length;var t=Ct(e);if("[object Map]"==t||"[object Set]"==t)return!e.size;if(ue(e))return!pe(e).length;for(var i in e)if(dr.call(e,i))return!1;return!0}(e.items)&&(i.items=e.items);return e.noTrack&&(i.no_track=e.noTrack),i}migrateOldGetRecommendationSignature(e,t,i,n,r){return{recommendationId:e,callback:t,size:i,strategy:n,item:r}}}class Ao{constructor(e,t=window.performance){this.config=e,this.performance=t,this.data=null,this.updatedAt=0}get(){return this.isFresh()?this.data:null}set(e){this.data=e,this.updatedAt=this.performance.now()}clear(){this.data=null,this.updatedAt=this.performance.now()}isFresh(){return this.performance.now()-this.updatedAt<this.config.getOptions().exposed_segments.ttl}}class Oo{constructor(e,t,i,n,r=window.performance){this.tracing=e,this.config=t,this.initializeState=i,this.queue=n,this.performance=r,this._=[],this.inProgress=!1,this.discoverySubscribers=new Map,this.contentSubscribers=new Map,this.discoverySubscriberId=0,this.contentSubscriberId=0,this.lastSegmentNotificationValue=null,this.cache=new Ao(this.config,this.performance)}getSegments(e,t,i,n={force:!1}){const r=function(i){t(function(t){return t[e]}(i))};n.force&&this.cache.clear();const s=this.cache.get();s?r(s):(this.prefetch(!0),this.segmentsPromise&&this.segmentsPromise.then(r,i))}prefetch(e=!1){(this.config.getOptions().exposed_segments.prefetch||e)&&!1===this.inProgress&&(this.inProgress=!0,this.segmentsPromise=this.segmentsQueuePromise(),this.segmentsPromise.then((e=>{this.cache.set(e)}),(()=>{this.cache.clear()})),this.segmentsPromise.finally((()=>{this.inProgress=!1})))}flush(){this.cache.clear()}subscribe(e,t,i){if("discovery"===e){const e=++this.discoverySubscriberId;return this.discoverySubscribers.set(e,{successCallback:t,errorCallback:i}),{unsubscribe:()=>{this.discoverySubscribers.delete(e)}}}if("content"===e){const e=++this.contentSubscriberId;return this.contentSubscribers.set(e,{successCallback:t,errorCallback:i}),{unsubscribe:()=>{this.contentSubscribers.delete(e)}}}throw new Error(`Unsupported subscription category: ${e}.`)}notify(){return fi(this,void 0,void 0,(function*(){if(this.config.getOptions().exposed_segments.notify)try{this.segmentsPromise=this.segmentsQueuePromise();const e=yield this.segmentsPromise,t=this.lastSegmentNotificationValue;this.notifySuccessSubscribers("discovery",t,e),this.notifySuccessSubscribers("content",t,e),this.lastSegmentNotificationValue=e}catch(e){this.notifyErrorSubscribers("discovery",e),this.notifyErrorSubscribers("content",e),this.lastSegmentNotificationValue=null}}))}notifySuccessSubscribers(e,t,i){let n;if("content"===e)n=this.contentSubscribers;else{if("discovery"!==e)throw new Error(`Unsupported subscription category: ${e}.`);n=this.discoverySubscribers}if(function(e,t,i){if(!t)return!0;if(!i&&!t)return!1;if(!i&&t)return!0;const n=t[e]||[],r=i[e]||[];if(r.length!==n.length)return!0;return r.some((e=>{const t=n.find((t=>t.segmentation_id===e.segmentation_id));return!t||!(!t||e.id===t.id)}))}(e,t,i))for(const[t,r]of n)r.successCallback(i[e])}notifyErrorSubscribers(e,t){let i;if("content"===e)i=this.contentSubscribers;else{if("discovery"!==e)throw new Error(`Unsupported subscription category: ${e}.`);i=this.discoverySubscribers}for(const[e,n]of i)n.errorCallback&&n.errorCallback(t)}segmentsQueuePromise(){return new Promise(((e,t)=>{this.tracing.tracePromise(this.initializeState.whenInitialized()).then((()=>{this.queue.enqueue({name:Nr.Segments,noBulk:!0,httpMethod:Cs.get,processResponse:e,processError:t},{process:Tr.immediate})}))}))}}gi([Dr("Segments.getSegments"),mi("design:type",Function),mi("design:paramtypes",[String,Function,Function,Object]),mi("design:returntype",void 0)],Oo.prototype,"getSegments",null),gi([Dr("Segments.prefetch"),mi("design:type",Function),mi("design:paramtypes",[Boolean]),mi("design:returntype",void 0)],Oo.prototype,"prefetch",null),gi([Dr("Segments.flush"),mi("design:type",Function),mi("design:paramtypes",[]),mi("design:returntype",void 0)],Oo.prototype,"flush",null),gi([Dr("Segments.subscribe"),mi("design:type",Function),mi("design:paramtypes",[String,Function,Function]),mi("design:returntype",Object)],Oo.prototype,"subscribe",null),gi([Dr("Segments.notify"),mi("design:type",Function),mi("design:paramtypes",[]),mi("design:returntype",Promise)],Oo.prototype,"notify",null);class Po{constructor(e,t,i){this.window=e,this.debug=t,this.config=i}get serviceWorker(){return this.window.navigator.serviceWorker}get serviceWorkerPath(){return this.config.getOptions().service_worker_path}isAvailable(){return"serviceWorker"in this.window.navigator&&"ServiceWorkerRegistration"in this.window}register(){return this.serviceWorker.register(this.serviceWorkerPath,{updateViaCache:"none"}).catch((e=>{throw this.debug.error(`Failed to the register service worker on '${this.serviceWorkerPath}' because of:`,e),e}))}isReady(){return this.serviceWorker.ready}isRegistered(){return this.serviceWorker.getRegistration(this.serviceWorkerPath).then((e=>!!e))}}class jo{constructor(e,t,i){this.logger=e,this.localStorage=t,this.sessionStorage=i,this.isAvailable={localStorage:Lo(t),sessionStorage:Lo(i)}}writeToStorage(e,t,i){if(!this.isStorageAvailable(e))return!1;try{return ge(i)?this.getStorage(e).setItem(t,JSON.stringify(i)):this.getStorage(e).setItem(t,String(i)),!0}catch(e){return this.logger.error("Couldn't write to local storage, some features may be broken.",e),!1}}removeFromStorage(e,t){return!!this.isStorageAvailable(e)&&(this.getStorage(e).removeItem(t),!0)}readStringFromStorage(e,t){if(!this.isStorageAvailable(e))return null;try{return this.getStorage(e).getItem(t)}catch(e){return null}}readNumberFromStorage(e,t){const i=this.readStringFromStorage(e,t);if(!i)return null;const n=parseInt(i,10);return isNaN(n)?null:n}readBooleanFromStorage(e,t){const i=this.readStringFromStorage(e,t);return null===i?null:"true"===i}isStorageAvailable(e){return this.isAvailable[e]}getStorage(e){return this[e]}}function Lo(e){try{const t=`__${c}_storage_test__`;return e.setItem(t,t),e.removeItem(t),!0}catch(e){return!1}}class Io{constructor(e,t,i,n){this.timestamp=e,this.queue=t,this.cookies=i,this.debug=n,this.timeInitialized=!1}isTimeInitialized(){return this.timeInitialized}queryTime(e){if(this.timeInitialized)return;let t=this.cookies.getCookie(n);if("string"==typeof t&&(this.debug.log("getting time offset from cookie",t),t=Number(t),!isNaN(t)))return this.debug.log("timestamp is valid number, choosing"),this.timestamp.timestampOffset=t,this.timeInitialized=!0,void this.cookies.setCookie(n,t.toString(),"time");this.debug.log("no time offset stored, getting from server");const i=this.timestamp,r=this.cookies;this.queue.enqueue({name:tn.Time,prepareData:()=>{const e=i.getTimestamp(),t={clientTS:e};return this.debug.log("getting server timestamp",t),{data:t,state:{clientTS:e}}},processResponse:(t,s,o)=>{const a=s.clientTS,c=i.getTimestamp();if(o&&o.start_time&&o.end_time){const e=c-a-(o.end_time-o.start_time);i.timestampOffset=o.end_time+e/2-c}else{this.debug.log("received time response",t);const e=t.time,n=c-(c-a)/2;i.timestampOffset=e-n}this.debug.log(`time offset is ${i.timestampOffset} `),r.setCookie(n,i.timestampOffset.toString(),"time"),e&&e()}},{first:!0})}}class Bo{constructor(e){this.storageUtils=e,this.lastUsedTimestamp=null,this.timestampOffsetValue=0}getUnixTimestamp(){return(new Date).getTime()/1e3}storeTimestamp(e,t){this.storageUtils.writeToStorage("localStorage",e,t)}getStoredTimestamp(e){return this.storageUtils.readNumberFromStorage("localStorage",e)}getTimestamp(){let e=this.getUnixTimestamp();return null!=this.lastUsedTimestamp&&this.lastUsedTimestamp>=e&&(e=this.lastUsedTimestamp+.001),this.lastUsedTimestamp=e,e}getTimestampWithOffset(){return this.getTimestamp()+this.timestampOffsetValue}set timestampOffset(e){this.timestampOffsetValue=e}get timestampOffset(){return this.timestampOffsetValue}}function zo(){return"object"==typeof window.performance&&"function"==typeof window.performance.now?performance.now():Date.now()}var Do;!function(e){e[e.Enabled=1]="Enabled",e[e.DisabledByOptions=2]="DisabledByOptions",e[e.DisabledBecauseOfMissingToken=3]="DisabledBecauseOfMissingToken"}(Do||(Do={}));class Fo{constructor(e,t,i,n,r){this.config=e,this.debug=t,this.http=i,this.featureFlags=n,this.isTraceSampled=r,this._sendingTraces=!1,this._update=tr(this.sendTrace.bind(this),4e3),this._target="//sdk-tracing.exponea.com/webxp-trace/record/browser/v1",this._serializedSpansToSend=[],this._children=[],this._id=on(32)}get children(){return this._children}get operationName(){return"traceRoot"}serialize(){return this.isTracingEnabled()!==Do.Enabled?(this._removeSerializableSpans(),null):{id:this._id,instance_id:"MAL",sdk_version:e,company_id:this.config.getToken(),spans:[...this._serializeSpans(),...this._serializedSpansToSend]}}isTracingEnabled(){try{this.config.getToken()}catch(e){return Do.DisabledBecauseOfMissingToken}return!1!==this._getErrorReportingOption()?Do.Enabled:Do.DisabledByOptions}sendTrace(){if(this._sendingTraces)return;const e=this.serialize();e&&e.spans.length?(this._sendingTraces=!0,this.debug.log("Sending trace",e),this._sendTrace(e).then((()=>{this._sendingTraces=!1,this._removeSpansById(e.spans.map((({id:e})=>e))),this._serializedSpansToSend=[],this.debug.log("Trace was successfully sent")})).catch((e=>{this._sendingTraces=!1,this.debug.error("Error while sending the trace",e)}))):e||this.isTracingEnabled()!==Do.DisabledBecauseOfMissingToken||this.debug.warn('Trace won\'t be send because "token" is missing from the config object')}sendTraceWithBeacon(){if(this._sendingTraces||!Bs)return;const e=this.serialize();if(!e||!e.spans.length)return;this.debug.log("Sending trace with beacon",e);const t=new Blob([JSON.stringify(e)],{type:"application/json"});navigator.sendBeacon(this._target,t)}addSerializedSpanToSend(...e){const t=e.filter((e=>!this._serializedSpansToSend.find((t=>t.id===e.id))));this._serializedSpansToSend.push(...t)}_serializeSpans(){var e,t,i,n;return this._children.filter((e=>e.canBeSerialized())).filter((t=this.isTraceSampled,i=this._getErrorReportingOption(),n=this.featureFlags,e=e=>"errors_only"===i?e.hasErrorDeep():i&&n.flags.sdk854_implement_trace_sampling?t||e.hasErrorDeep():i,function(){return!e(...arguments)})).forEach((e=>e.destroy())),this._children.filter((e=>e.canBeSerialized())).reduce(((e,t)=>Ro(t,e)),[])}_addChildSpan(e){this.children.push(e)}_removeSpansById(e){this._children=this._children.filter((({id:t})=>-1===e.indexOf(t)))}_sendTrace(e){return this.http.post(this._target,e,{responseType:"text",headers:{"Content-type":"application/json"},credentials:"omit"})}_removeSerializableSpans(){this._removeSpansById(this._children.filter((e=>e.canBeSerialized())).map((({id:e})=>e)))}_getErrorReportingOption(){return this.config.getOptions().error_reporting}}function Ro(e,t){const i=e.serialize();return i&&t.push(i),e.children.forEach((e=>Ro(e,t))),t}class Mo{constructor(e,t,i,n,r,s){this.parent=e,this.operation=t,this.debug=i,this.spanStack=n,this.children=[],this._getPrecisionTime=zo,this._state=zr.State.Waiting,this._tags={},this.id=on(16),e._addChildSpan(this),this.debug.debug(`Registered child span '${this.operationName}' of '${e.operationName}'`,this),this.isTransient()&&e instanceof Fo&&this.debug.warn("Registered transient span as a child of the root trace, this span will not be serialized and sent in trace.",this),this.addTags({url:r.href.split(/[?#]/)[0],host:r.hostname,is_sampled:s.toString()})}get tags(){return this._tags}get startTime(){return this._startTime}get startPrecisionTime(){return this._startPrecisionTime}get endPrecisionTimeSync(){return this._endPrecisionTimeSync}get endPrecisionTimeAsync(){return this._endPrecisionTimeAsync}get state(){return this._state}get name(){return this.operation}get duration(){if(!this.endPrecisionTimeAsync)throw new Error(`Span ${this.operationName} still has some async children running so cannot calculate async duration`);if(!this.startPrecisionTime)throw new Error(`Span ${this.operationName} wasn't started yet so cannot calculate duration`);return(this.endPrecisionTimeAsync-this.startPrecisionTime)/1e3}get syncDuration(){if(!this.endPrecisionTimeSync)throw new Error(`Span ${this.operationName} wasn't ended yet so cannot calculate duration`);if(!this.startPrecisionTime)throw new Error(`Span ${this.operationName} wasn't started yet so cannot calculate duration`);return(this.endPrecisionTimeSync-this.startPrecisionTime)/1e3}get parentSpan(){return this.parent}get operationName(){return"object"==typeof this.operation?"transientOperation":this.operation}isChildOfTrace(){return this.parent instanceof Fo}destroy(){const e=this.parent;e instanceof Mo?e._removeChildSpan(this):e._removeSpansById([this.id]),this.parent._update()}start(){this.isWaiting()&&(this._state=zr.State.Running,this.spanStack.push(this),this._startTime=Date.now()/1e3,this._startPrecisionTime=this._getPrecisionTime(),this.debug.debug(`Span '${this.operationName}' started`,this))}hasError(e){return!!this._error&&(e instanceof Error?this._error.name===e.name&&this._error.message===e.message:this._error.message===String(e))}hasErrorDeep(){return!!this._error||this.children.some((e=>e.hasErrorDeep()))}isErrorAlreadyTracked(e){return this.children.some((t=>t.isTransient()?t.isErrorAlreadyTracked(e):t.hasError(e)))}setError(e){let t;t=e instanceof Error?e:new Error(String(e)),this.isErrorAlreadyTracked(e)||(t.name||(t.name="Unknown Error"),this._error={name:t.name,message:t.message,stack:this._getErrorStack(t)})}setApiCall(e){this._apiCall=e}end(){this.isRunning()&&(this._endPrecisionTimeSync=this._getPrecisionTime(),this.debug.debug(`Span '${this.operationName}' ended in ${this.syncDuration}ms`,this),this._state=zr.State.EndedSync,this.spanStack.pop(),this._update())}isTransient(){return"object"==typeof this.operation}isRunning(){return this.state===zr.State.Running}isWaiting(){return this.state===zr.State.Waiting}isEndedSync(){return this.state===zr.State.EndedSync}isEndedAsync(){return this.state===zr.State.EndedAsync}canBeSerialized(){return this.isEndedAsync()}serialize(){if(!this.canBeSerialized()||this.isTransient()||!this.startTime)return null;const e={id:this.id,start_time:this.startTime,duration:this.duration,operation:this.operation,tags:this.tags},t=this._getParentSpan();return t instanceof Mo&&(e.parent_span_id=t.id),this._error&&(e.error=this._error),this._apiCall&&(e.api_call=this._apiCall),e}addTags(e){this._tags=Object.assign(Object.assign({},this.tags),e)}getSpanStackTrace(){const e=[];let t=this;for(;t instanceof Mo&&e.length<10;)e.push(t.operationName),t=t.parent;return e}_getParentSpan(){let e=this.parentSpan;for(;e&&e instanceof Mo&&e.isTransient();)e=e.parent;return e}_addChildSpan(e){this.children.push(e)}_removeChildSpan(e){const t=this.children.indexOf(e);-1!==t&&this.children.splice(t,1)}_update(){this.isEndedSync()&&this.children.every((e=>e.isEndedAsync()))&&(this._state=zr.State.EndedAsync,this._endPrecisionTimeAsync=this._getPrecisionTime(),this.debug.debug(`Span '${this.operationName}' ended in ${this.duration}ms`,this),this.parent._update())}_getErrorStack(e){const t=this.getSpanStackTrace().map((e=>`   at ${e} (span:0:0)`)).join("\n");return`${e.name}: ${e.message}\n${t}`}}class No{constructor(){this.items=[]}pop(){return this.items.pop()}push(e){this.items.push(e)}top(){if(this.items.length)return this.items[this.items.length-1]}isEmpty(){return!this.top()}}class qo{constructor(e,t,i,n){this.debug=t,this.tracing=i,this.parentSpan=n,this.spanQueue=[],this.tracedPromise=e.then((e=>(Wo(this.spanQueue,"then"),e))).catch((e=>(Wo(this.spanQueue,"catch"),Promise.reject(e))))}then(e){const t=this.tracing.registerNewSpan(this.parentSpan);this.spanQueue.push({type:"then",spanObject:t});const i=this.tracedPromise.then((i=>{let n;Uo(this.spanQueue,t),this.spanQueue.shift(),t.start();try{n=e(i),t.end(),Wo(this.spanQueue,"then")}catch(e){throw t.setError(e),t.end(),this.debug.error(e),Wo(this.spanQueue,"catch"),e}return n instanceof qo?n.tracedPromise:n}));return new qo(i,this.debug,this.tracing,this.parentSpan)}catch(e){const t=this.tracing.registerNewSpan(this.parentSpan);this.spanQueue.push({type:"catch",spanObject:t});const i=this.tracedPromise.catch((i=>{let n;Uo(this.spanQueue,t),this.spanQueue.shift(),t.start();try{n=e(i),t.end(),Wo(this.spanQueue,"then")}catch(e){throw t.setError(e),t.end(),this.debug.error(e),Wo(this.spanQueue,"catch"),e}return n instanceof qo?n.tracedPromise:n}));return new qo(i,this.debug,this.tracing,this.parentSpan)}}function Uo(e,t){$o(e,(e=>t===e.spanObject))}function Wo(e,t){$o(e,(e=>t===e.type))}function $o(e,t){for(let i=0;i<e.length;i++){const n=e[i];if(t(n))return;i--,e.shift(),n.spanObject.destroy()}}const Ho=Object.freeze({onRoot:!1});class Vo{constructor(e,t,i,n,r,s,o=.005){this.debug=e,this.location=n,this._executeWithinSpan=Lr,this._isTraceSampled=r.random()<o,this._trace=new Fo(i,e,t,s,this._isTraceSampled),this._spanStack=new No}trace(e,t,i){let n,r,s=Ho,o=this._trace;return void 0!==i?(n=e,r=t,s=Tn(i,s)):"function"==typeof t?(n=e,r=t):(n=Br,r=e,s=Tn(t,s)),s.onRoot||(o=this.getActiveSpan()),this._traceFunction(n,r,o)}sendTraceWithBeacon(){return this._trace.sendTraceWithBeacon()}getActiveSpan(){return this._spanStack.top()||this._trace}registerNewSpan(e,t){let i,n=Br;return"object"!=typeof e||e instanceof Ir?e?(n=e,i=t||this.getActiveSpan()):i=this.getActiveSpan():i=e,new Mo(i,n,this.debug,this._spanStack,this.location,this._isTraceSampled)}tracePromise(e){return new qo(e,this.debug,this,this.getActiveSpan())}addSerializedSpanToSend(...e){this._trace.addSerializedSpanToSend(...e)}_traceFunction(e,t,i){const n=this.registerNewSpan(e,i),r=n.isChildOfTrace(),s=this;return function(...e){return s._executeWithinSpan(s.debug,n,t.bind(this,...e),r)}}}const Go={_keyStr:"1BGFYekyHP0tx4OKnQCIoUfMbhRaVEqrzLN._su96W5g3AcvXpZDlJdj78-mSi2wT",decode:function(e){let t="";e=e.replace(/[^A-Za-z0-9\._-]/g,"");let i=0;for(;i<e.length;){const n=this._keyStr.indexOf(e.charAt(i++)),r=this._keyStr.indexOf(e.charAt(i++)),s=this._keyStr.indexOf(e.charAt(i++)),o=this._keyStr.indexOf(e.charAt(i++)),a=n<<2|r>>4,c=(15&r)<<4|s>>2,u=(3&s)<<6|o;t+=String.fromCharCode(a),64!==s&&(t+=String.fromCharCode(c)),64!==o&&(t+=String.fromCharCode(u))}return Go._utf8_decode(t)},_utf8_decode:function(e){let t="",i=0;const n="UTF-8 character cannot continue with: ";for(;i<e.length;){const r=e.charCodeAt(i);if(r<128)t+=String.fromCodePoint(r),i++;else if(r>191&&r<224){const s=e.charCodeAt(i+1);if(s<128||s>191)throw RangeError(n+s);t+=String.fromCodePoint((31&r)<<6|63&s),i+=2}else if(r>223&&r<240){const s=e.charCodeAt(i+1),o=e.charCodeAt(i+2);if(s<128||s>191)throw RangeError(n+s);if(o<128||o>191)throw RangeError(n+o);t+=String.fromCodePoint((15&r)<<12|(63&s)<<6|63&o),i+=3}else{if(!(r>239&&r<248))throw RangeError("UTF-8 character cannot start with: "+r);{const s=e.charCodeAt(i+1),o=e.charCodeAt(i+2),a=e.charCodeAt(i+3);if(s<128||s>191)throw RangeError(n+s);if(o<128||o>191)throw RangeError(n+o);if(a<128||a>191)throw RangeError(n+a);t+=String.fromCodePoint((7&r)<<18|(63&s)<<12|(63&o)<<6|63&a),i+=4}}}return t}};class Ko{constructor(e,t){this.debug=e,this.location=t}getCustomerIdentityFromUrl(){const e=this.getTransferIdentityToken();if(!e)return null;let t;this.debug.log("found iitt token in URL",e);try{t=Go.decode(e)}catch(e){return this.debug.error("iiit token is not valid base64 string"),null}this.debug.log("decoded token is",t);const i=t.indexOf(":");if(i<0)return this.debug.log("iit token is not valid"),null;const n={};return n[t.substring(0,i)]=t.substring(i+1),this.debug.log("resulting transferred customer ID is",n),n}getTransferIdentityFirstClickToken(){return this.getParameterValueFromUrl("xnpe_tifc")}getTransferIdentityToken(){return this.getParameterValueFromUrl("iitt")}getParameterValueFromUrl(e){const t=this.location.href.match(new RegExp("[?&]+"+e+"=([^&]*)","gi"));if(!t)return;const i=t[t.length-1].match(/[?&]+[^=]+=([^&]*)/i);return i?i[1]:void 0}}class Qo{constructor(e,t){this.tracing=e,this.window=t,this.callbacks=[],this.afterCallbacks=[]}initialize(){this.window.addEventListener("unload",(()=>{Jo(this.tracing,this.callbacks),Jo(this.tracing,this.afterCallbacks),this.tracing.sendTraceWithBeacon()}))}addListener(e){this.callbacks.push(e)}addAfterListener(e){this.afterCallbacks.push(e)}}function Jo(e,t){t.forEach((t=>{e.trace("unloaderCallback",t,{onRoot:!0})()}))}class Yo{constructor(e,t,i,n,r,s){this.tracing=e,this.config=t,this.location=i,this.history=n,this.window=r,this.logger=s,this.onChangeListeners=new Set}getParams(e){return function(e,t){const i={},n={};return e.forEach((e=>{n[e]=!0})),t.replace(/[?&]+([^=&]+)=([^&]*)/gi,((e,t,r)=>{if(t in n)try{i[t]=decodeURIComponent(r)}catch(e){}return""})),i}(e,this.location.href)}onChange(e,t){if(this.onChangeListeners.has(e))return;this.onChangeListeners.add(e);const i=tr(this.tracing.trace(e,t,{onRoot:!0}),10);!function(e,t,i,n,r){if(!(!0===e.spa_reloading||e.spa_reloading&&!1!==e.spa_reloading.on_url_change))return;let s=i.href.replace(i.hash,"");if(!n.pushState)return;const o=n.pushState;n.pushState=(...e)=>{o.apply(n,e),s=Zo(i,s,r)},Rs(t,"popstate",(()=>{s=Zo(i,s,r)}))}(this.config.getOptions(),this.window,this.location,this.history,i),function(e,t,i,n,r){if(!("object"==typeof e.spa_reloading&&!1!==e.spa_reloading.on_hash_change||!0===e.spa_reloading&&e.track_hash_changes))return;if(!("onhashchange"in t))return void n.warn("Browser is missing the HashChangeEvent support. The spa_reloading.on_hash_change option won't work.");Rs(t,"hashchange",(s=i.hash,o=r,()=>{i.hash!==s&&(s=i.hash,o())}));var s,o}(this.config.getOptions(),this.window,this.location,this.logger,i)}}function Zo(e,t,i){const n=e.href.replace(e.hash,"");return t!==n&&i(),n}class Xo{constructor(e,t,i,n,r,s,o,a){this.tracing=e,this.config=t,this.linkTracker=i,this.eventTracker=n,this.window=r,this.debug=s,this.documentContentLoaded=o,this.unloader=a,this.activity={start:null,last:null},this._activityHandler=new Qs(this.window),this.config.getOptions().track.activity&&this.unloader.addListener((()=>{this.trackActivityEvent(new Date)}))}trackExitsWithDataAttribute(){const e=this.config.getOptions().track;e&&(!0===e.exits||me(e.exits))&&this.tracing.tracePromise(this.documentContentLoaded.whenLoaded()).then((()=>{let t=e.exits;me(t)||(t=e=>{const t=e,i={location:t.href,current_location:window.location.href};return t.getAttribute("id")&&(i.element_id=t.getAttribute("id")),t.getAttribute("name")&&(i.element_name=t.getAttribute("name")),{type:"web_exit",properties:i}});const i=di("a[data-exponea-track]");for(let e=0;e<i.length;e++)this.debug.log("Registering web exit link tracking for",i[e]),this.linkTracker.trackLink(i[e],t)}))}startActivityTracking(){const e=this.config.getOptions().track;e&&e.activity&&(this.debug.log("Activity tracking enabled"),this._activityHandler.registerActionListeners(),this.window.setInterval((()=>this.checkLastActivity()),1e3))}checkLastActivity(){if(this._activityHandler.getLastUserActivity()&&this._setUserWasActive(),this._activityHandler.resetActivity(),null==this.activity.last)return;const e=new Date;e.getTime()-this.activity.last.getTime()>6e4&&(this.trackActivityEvent(e),this.activity={start:null,last:null})}trackActivityEvent(e){const t=this.config.getOptions().track;if(!t||!t.activity||null==this.activity.start||null==this.activity.last)return;const i=this.activity.start.getTime()/1e3,n=this.activity.last.getTime()/1e3;this.debug.log("Tracking user activity event"),this.eventTracker.track("user_active",{start_client_timestamp:i,end_client_timestamp:n,now_client_timestamp:e.getTime(),duration:n-i})}_setUserWasActive(){this.activity.last=new Date,null==this.activity.start&&(this.activity.start=this.activity.last)}}class ea{constructor(e,t,i,n,r,s,o,a,c,u,h,l,d){this.tracing=e,this.config=t,this.contextualBanditEventFilter=i,this.queue=n,this.timestamp=r,this.ping=s,this.tracker=o,this.location=a,this.debug=c,this.documentContentLoaded=u,this.initializeState=h,this.storageUtils=l,this.url=d,this.showingWebLayersInProgress=!1,this.webLayerHiders=[],this.tracker.registerEventTrackingListener(function(e,t){return function(i,n){"banner"===i&&"banner_id"in n&&(n.interaction&&ia(e,t,n.banner_id,"interaction","_last_interaction"),"show"===n.action&&ia(e,t,n.banner_id,"show event","_last_show"))}}(this.debug,this.storageUtils))}showWebLayer(e,t){let i,n;this.debug.log(`Showing weblayer ${t}...`);try{i=new Function(e)}catch(e){return this.debug.error(`Syntax error in the web layer javascript code.\n\nThis is not an SDK error but rather an error in the web layer ${t}\njavascript code. Check the web layer javascript code for syntax errors, such\nerrors are usually highlighted in the UI. The first line of the stack trace\nbelow should give you a clue.\n\n`,e)}try{n=i()}catch(e){return this.debug.error(`Error when executing the web layer javascript code.\n\nThis is not an SDK error but rather an error in the web layer ${t}\njavascript code. Check the web layer javascript code for errors. This is not\na syntax error and may be hard to spot, but the first line of the stack trace\nbelow should give you a clue.\n\n`,e)}n.hasOwnProperty("contextual_personalization")&&this.updateContextualBanditEventFilter(n.contextual_personalization),"function"==typeof n&&n.hasOwnProperty("remove")&&"function"==typeof n.remove&&this.webLayerHiders.push(n.remove)}queryAndShowWebLayer(e,t={},i=!1,n){i||this.hideExistingWebLayers(),this.queryAndShowWebLayers([e],t,n)}hideExistingWebLayers(){for(const e of this.webLayerHiders)try{e()}catch(e){this.debug.error("Error from hide weblayer script",e)}this.webLayerHiders=[]}processDefinition(e,t){const i=e.filter(ta);this.debug.log("Processing weblayers...",i),this.filterAndShowWebLayers(i,t,!1),this.config.isSpaReloadingEnabled("banners")&&this.url.onChange("onUrlChangeFilterAndShowWebLayers",(()=>{this.filterAndShowWebLayers(i)}))}processNonPersonalizedDefinition(e,t){const i=e.filter((e=>!ta(e)));this.debug.log("Processing Non-personalized weblayers...",i),this.filterAndShowNonPersonalizedWebLayers(i,t)}filterAndShowWebLayers(e,t,i=!0){if(this.showingWebLayersInProgress)return;i&&this.hideExistingWebLayers();const n=this.filterWebLayersForCustomer(e);if(0===n.length)return void(t&&jr(t));const r=n.map((({_id:e})=>e));this.showingWebLayersInProgress=!0,this.queryAndShowWebLayers(r,{},t)}filterAndShowNonPersonalizedWebLayers(e,t,i=!0){if(this.showingWebLayersInProgress)return;i&&this.hideExistingWebLayers();const n=this.filterWebLayersForCustomer(e);if(0===n.length)return void(t&&jr(t));this.showingWebLayersInProgress=!0;const r=n.map((e=>{var t;return null!==(t=e.data)&&void 0!==t?t:"return {}"})),s=n.map((e=>e._id));return this.showWebLayers(r,s).then((()=>{this.showingWebLayersInProgress=!1,t&&jr(t)}))}filterWebLayersForCustomer(e){const t=os(Jr.WebLayer,this.debug);return e.filter(t("page",(e=>cs.matches(this.location.href,e.trigger)))).filter(t("date",(e=>Gr.matches(this.timestamp.getTimestamp(),e.date_filter)))).filter(t("device",(e=>ns.matches(e.device_target)))).filter(t("frequency",(e=>rs.matches(this.ping,this.timestamp,this.storageUtils,e.frequency,e._id,s))))}queryAndShowWebLayers(e,t={},i){let n=Yn(this.config.getOptions().customer);this.tracing.tracePromise(this.initializeState.whenInitialized()).then((()=>{this.queue.enqueue({name:Nr.BannersShow,noBulk:!0,prepareData:()=>(this.debug.log("Get filtered weblayers by IDs",e),n&&n.cookie||(n=Yn(this.config.getOptions().customer)),{data:{company_id:this.config.getToken(),customer_ids:n,banner_ids:e,params:t}}),processResponse:({data:t})=>{this.showWebLayers(t,e).then((()=>{this.showingWebLayersInProgress=!1,i&&jr(i)}))},processError:e=>{this.showingWebLayersInProgress=!1,i&&jr(i.bind(void 0,e))}})}))}showWebLayers(e,t){return this.debug.log("Showing weblayers..."),this.tracing.tracePromise(this.documentContentLoaded.whenLoaded()).then((()=>{e.forEach(((e,i)=>this.showWebLayer(e,t[i])))}))}updateContextualBanditEventFilter(e){var t,i,n;const r=null===(t=e.optimization_target)||void 0===t?void 0:t.type,s=null===(i=e.optimization_target)||void 0===i?void 0:i.event_type,o=(null===(n=e.optimization_target)||void 0===n?void 0:n.event_filter)||[],a=e.reward_token,c=e.reward_value||1;"event_tracked"===r&&s&&a&&this.contextualBanditEventFilter.put(s,o,a,c)}}function ta(e){return void 0===e.uses_personalization||e.uses_personalization}function ia(e,t,i,n,r){e.log(`Recording ${n} for weblayer ${i}`),t.writeToStorage("localStorage",s+i+r,(new Date).valueOf().toString())}gi([Dr("WebLayers.showWebLayer"),mi("design:type",Function),mi("design:paramtypes",[String,String]),mi("design:returntype",void 0)],ea.prototype,"showWebLayer",null);class na{constructor(e){e&&Se(e,((e,t)=>{this[`_${t}`]=e}))}get location(){return this._location||(this._location=window.location),this._location}get document(){return this._document||(this._document=window.document),this._document}get date(){return this._date||(this._date=Date),this._date}get localStorage(){return this._localStorage||(this._localStorage=window.localStorage),this._localStorage}get sessionStorage(){return this._sessionStorage||(this._sessionStorage=window.sessionStorage),this._sessionStorage}get history(){return this._history||(this._history=window.history),this._history}get window(){return this._window||(this._window=window),this._window}get console(){return this._console||(this._console=window.console),this._console}get math(){return this._math||(this._math=Math),this._math}get config(){return this._config||(this._config=new yr(this.database,this.logger)),this._config}get featureFlags(){return this._featureFlags||(this._featureFlags=new gs(this.debug,this.window)),this._featureFlags}get contextualBandit(){return this._contextualBandit||(this._contextualBandit=new vr(this.config,this.http)),this._contextualBandit}get timestamp(){return this._timestamp||(this._timestamp=new Bo(this.storageUtils)),this._timestamp}get http(){return this._http||(this._http=new Ts(window)),this._http}get queue(){return this._queue||(this._queue=new _o(this.tracing,this.config,this.http,this.debug,this.timestamp,this.unloader,this.window)),this._queue}get cookies(){return this._cookies||(this._cookies=new Or(this.config,this.debug,this.logger,this.queue,this.location,this.document,this.segments)),this._cookies}get contextualBanditEventFilter(){return this._contextualBanditEventFilter||(this._contextualBanditEventFilter=new Cr(this.contextualBandit,this.debug)),this._contextualBanditEventFilter}get time(){return this._time||(this._time=new Io(this.timestamp,this.queue,this.cookies,this.debug)),this._time}get eventTracker(){return this._eventTracker||(this._eventTracker=new Rr(this.tracing,this.config,this.contextualBanditEventFilter,this.time,this.timestamp,this.queue,this.debug,this.document,this.location,this.initializeState,this.window,this.url,this.browserExtension)),this._eventTracker}get ping(){return this._ping||(this._ping=new Js(this.tracing,this.config,this.timestamp,this.eventTracker,this.window,this.location,this.document,this.debug,this.cookies,this.storageUtils,this.unloader,this.url)),this._ping}get dependencyLoader(){return this._dependencyLoader||(this._dependencyLoader=new $r(this.config,this.tracing)),this._dependencyLoader}get customer(){return this._customer||(this._customer=new qr(this.tracing,this.config,this.queue,this.debug,this.initializeState,this.window,this.cookies,this.browserExtension,this.segments)),this._customer}get userActivityTracking(){return this._userActivityTracking||(this._userActivityTracking=new Xo(this.tracing,this.config,this.linkTracker,this.eventTracker,this.window,this.debug,this.documentContentLoaded,this.unloader)),this._userActivityTracking}get experimentsEditor(){return this._experimentsEditor||(this._experimentsEditor=new hs(this.http,this.config,this.location,this.document,this.history,this.window,this.debug,this.storageUtils)),this._experimentsEditor}get experimentsModifications(){return this._experimentsModifications||(this._experimentsModifications=new ls(this.eventTracker,this.experimentsEditor,this.document,this.debug)),this._experimentsModifications}get experiments(){return this._experiments||(this._experiments=new us(this.tracing,this.config,this.queue,this.timestamp,this.ping,this.experimentsModifications,this.experimentsEditor,this.eventTracker,this.location,this.debug,this.documentContentLoaded,this.storageUtils,this.newExperiments,this.url)),this._experiments}get abTest(){return this._abTest||(this._abTest=new li(this.cookies)),this._abTest}get recommendations(){return this._recommendations||(this._recommendations=new Co(this.config,this.queue,this.debug)),this._recommendations}get webLayers(){return this._webLayers||(this._webLayers=new ea(this.tracing,this.config,this.contextualBanditEventFilter,this.queue,this.timestamp,this.ping,this.eventTracker,this.location,this.debug,this.documentContentLoaded,this.initializeState,this.storageUtils,this.url)),this._webLayers}get managedTags(){return this._managedTags||(this._managedTags=new Ws(this.tracing,this.config,this.queue,this.location,this.document,this.debug,this.url)),this._managedTags}get linkTracker(){return this._linkTracker||(this._linkTracker=new Fs(this.tracing,this.eventTracker,this.debug,this.documentContentLoaded)),this._linkTracker}get unloader(){return this._unloader||(this._unloader=new Qo(this.tracing,this.window)),this._unloader}get campaignClicks(){return this._campaignClicks||(this._campaignClicks=new dn(this.location,this.queue,this.config,this.timestamp,this.time,this.debug,this.window,this.document)),this._campaignClicks}get notifications(){return this._notifications||(this._notifications=new io(this.pushWebApi,this.pushSafariApi)),this._notifications}get pushWebApi(){return this._pushWebApi||(this._pushWebApi=new ro(this.window,this.location,this.debug,this.logger,this.config,this.customer,this.queue,this.serviceWorkerManager)),this._pushWebApi}get pushSafariApi(){return this._pushSafariApi||(this._pushSafariApi=new no(this.window,this.config,this.customer,this.location,this.storageUtils)),this._pushSafariApi}get debug(){return this._debug||(this._debug=new Wr(this.config,this.location,this.logger,this.storageUtils)),this._debug}get tracing(){return this._tracing||(this._tracing=new Vo(this.debug,this.http,this.config,this.location,this.math,this.featureFlags)),this._tracing}get initializer(){return this._initializer||(this._initializer=new Ls(this.tracing,this.debug,this.config,this.time,this.cookies,this.ping,this.customer,this.userActivityTracking,this.experimentsEditor,this.experiments,this.webLayers,this.managedTags,this.campaignClicks,this.eventTracker,this.queryTracking,this.window,this.unloader,this.initializeState,this.queue,this.pushWebApi,this.pushSafariApi,this.transferIdentity,this.url,this.http,this.logger,this.performanceTracker,this.newExperiments,this.featureFlags,this.browserExtension)),this._initializer}get queryTracking(){return this._queryTracking||(this._queryTracking=new oo(this.tracing,this.config,this.queue,this.debug,this.timestamp,this.automaticTracking,this.window,this.eventTracker,this.customer,this.liveEventHandler,this.storageUtils,this.url)),this._queryTracking}get automaticTracking(){return this._automaticTracking||(this._automaticTracking=new pi(this.tracing,this.documentContentLoaded)),this._automaticTracking}get liveEventHandler(){return this._liveEventHandler||(this._liveEventHandler=new Ms(this.tracing,this.document)),this._liveEventHandler}get documentContentLoaded(){return this._documentContentLoaded||(this._documentContentLoaded=new Hr(this.window,this.document)),this._documentContentLoaded}get initializeState(){return this._initializeState||(this._initializeState=new Is),this._initializeState}get transferIdentity(){return this._transferIdentity||(this._transferIdentity=new Ko(this.debug,this.location)),this._transferIdentity}get html(){return this._html||(this._html=new ms(this.config,this.debug,this.documentContentLoaded,this.queue)),this._html}get enhancedEcommerce(){return this._enhancedEcommerce||(this._enhancedEcommerce=new Vr.Tracker(this.debug,this.eventTracker)),this._enhancedEcommerce}get serviceWorkerManager(){return this._serviceWorkerManager||(this._serviceWorkerManager=new Po(this.window,this.debug,this.config)),this._serviceWorkerManager}get logger(){return this._logger||(this._logger=new Ns(this.console,u)),this._logger}get performanceTracker(){return this._performanceTracker||(this._performanceTracker=new Vs(this.window,this.config,this.debug,this.tracing,this.date)),this._performanceTracker}get storageUtils(){return this._storageUtils||(this._storageUtils=new jo(this.logger,this.localStorage,this.sessionStorage)),this._storageUtils}get database(){return this._database||(this._database=new Ur(this.window,this.logger)),this._database}get newExperiments(){return this._newExperiments||(this._newExperiments=new $s(this.tracing,this.window,this.serviceWorkerManager,this.database,this.storageUtils,this.config,this.logger)),this._newExperiments}get url(){return this._url||(this._url=new Yo(this.tracing,this.config,this.location,this.history,this.window,this.logger)),this._url}get browserExtension(){return this._browserExtension||(this._browserExtension=new en.Handler(this.window,this.debug)),this._browserExtension}get segments(){return this._segments||(this._segments=new Oo(this.tracing,this.config,this.initializeState,this.queue)),this._segments}}const ra=["anonymize","initialize","identify","getSegments","update","track","trackLink","trackEnhancedEcommerce","getHtml","showHtml","showBanner","showWebLayer","ping","getAbTest","loadDependency","getRecommendation","reloadWebLayers","_preInitialize","_initializeConfig","_bootstrapEditor","_insertExperiment","_revertExperiments","_rewardBandit"],sa=["version","isLoaded","isInitialized","configuration"],oa=["isAvailable","isSubscribed","subscribe","unsubscribe"],aa=["subscribe"];function ca(){return function(e,t,i){const n=i.value;return i.value=function(){const e=!this.isInitialized,t=this.config.getOptions();ua(t)?this.tracing.tracePromise(this.initializedState.whenInitialized()).then((()=>{e||n.apply(this,arguments)})):n.apply(this,arguments)},i}}function ua(e){return!0===e.compliance.opt_in||!0===e.compliance.opt_in.ignore_stored_command}function ha(){return window[w]}class la{constructor({config:e,dependencyLoader:t,cookies:i,eventTracker:n,initializer:r,initializeState:s,customer:o,experimentsEditor:a,experiments:c,notifications:u,recommendations:h,abTest:l,webLayers:d,linkTracker:p,ping:g,tracing:m,contextualBandit:f,queue:b,debug:y,html:v,enhancedEcommerce:w,browserExtension:_,segments:k,featureFlags:S,logger:T}){this._=[],this.config=e,this.dependencyLoader=t,this.cookies=i,this.eventTracker=n,this.initializer=r,this.initializeState=s,this.customer=o,this.experimentsEditor=a,this.experiments=c,this.notifications=u,this.recommendations=h,this.abTest=l,this.webLayers=d,this.linkTracker=p,this.pingService=g,this.tracing=m,this.contextualBandit=f,this.queue=b,this.debug=y,this.html=v,this.enhancedEcommerce=w,this.browserExtension=_,this.segments=k,this.featureFlags=S,this.logger=T,this.queue.registerPostBulkCallback((()=>{const e=this.config.getOptions().exposed_segments.segmentation_processing_delay;new Promise((t=>{setTimeout(t,e)})).then((()=>{this.segments.flush(),this.segments.prefetch(),this.segments.notify()}))}))}get version(){return e}get isLoaded(){return!0}get isInitialized(){return this.initializeState.isInitialized()}get configuration(){return nn(this.config.getOptions())}get initializedState(){return this.initializeState}initialize(e){return this.initializer.initialize(e)}_preInitialize(e){this.initializer.extendOptions(e),this.tracing.tracePromise(As(this.queue)).then((e=>this.webLayers.processNonPersonalizedDefinition(e.webLayers)))}_initializeConfig(e){this.initializer.extendOptions(e)}track(e,t,i,n,r){return this.eventTracker.track(e,t,{successCallback:i,errorCallback:n,immediate:r})}identify(e,t,i,n,r,s,o){return this.customer.identifyCustomer(e,t,i,n,r,s,o)}update(e){return this.customer.updateCustomer(e)}anonymize(){const e=this.cookies.setFreshTrackingCookie();this.config.setNewCustomerIds({cookie:e}),this.browserExtension.sendPayload({type:"ids",ids:{cookie:e}}),this.debug.log("sending new anonymized cookie to server"),this.cookies.sendCustomerCookieToServer(e),this.notifications.unsubscribe((()=>{})),this.segments.notify()}getAbTest(e,t,i){const n=`${h}${e}__`,r=this.cookies.getCookie(n),s=this.abTest.getAbTest(e,t);if(r||this.eventTracker.track("ab test",{name:e,variant:s}),!i)return s;jr((()=>i(s)))}showBanner(e,t,i=!1,n){return this.showWebLayer(e,t,i,n)}showWebLayer(e,t,i=!1,n){return this.webLayers.queryAndShowWebLayer(e,t,i,n)}getRecommendation(e){return this.recommendations.fetch(e,arguments)}getSegments(e,t,i,n={force:!1}){this.segments.getSegments(e,t,i,n)}trackLink(e,t,i){return this.linkTracker.trackLink(e,t,i)}loadDependency(e,t=(()=>{})){return this.ensureThatSdkIsInitialized(),this.dependencyLoader.loadDependency(e).then((()=>t())).catch((e=>t(e)))}ping(e){return void 0===e?this.pingService.sendPing():(this.pingService.setOptions(e),this.pingService.restartPinging())}reloadWebLayers(e){this.tracing.tracePromise(As(this.queue)).then((e=>this.webLayers.processDefinition(e.webLayers))).then((()=>{e&&jr(e)})).catch((t=>{e&&jr((()=>e(t)))}))}_bootstrapEditor(){return this.experimentsEditor.bootstrapEditor()}_insertExperiment(e,t){if(!this.featureFlags.flags.ep3_use_new_experiments)return this.experiments.applyExperimentModificationsAndTrackEvent(e,t);const i=ha();if(i&&i.applyModifications)return this._applyModificationsWhenMethodAvailable(e,i,t);const n=this.initializer.isWebxpClientReady.then((()=>i&&i.applyModifications?this._applyModificationsWhenMethodAvailable(e,i,t):(this.logger.error(`Unable to initialize experiment ${e.params.experiment_id}. Function applyModifications is not available.`),()=>{})),(e=>(this.logger.error("Unable to initialize experiments:",e),()=>{})));return()=>{n.then((e=>{"function"!=typeof e?this.logger.error("Unable to generate revert function"):e()}))}}_revertExperiments(){if(!this.featureFlags.flags.ep3_use_new_experiments)return this.experiments.revertExistingExperiments();{const e=ha();if(e&&e.revert)try{return e.revert()}catch(e){this.debug.error("Error from revert experiment script",e)}}}_rewardBandit(e,t,i,n){this.contextualBandit.rewardBandit(e,t,i,n)}trackEnhancedEcommerce(e,t="all"){this.enhancedEcommerce.trackEnhancedEcommerce(e,t)}getHtml(e,t){this.html.getHtml(e,t)}showHtml(e,t){this.html.showHtml(e,t)}ensureThatSdkIsInitialized(){if(!this.initializeState.isInitialized())throw new Error("You have to call initialize before any other Exponea SDK method can be called")}_applyModificationsWhenMethodAvailable(e,t,i){let n;try{n=t.applyModifications?t.applyModifications(e,!1):()=>{}}catch(e){return this.debug.error("Error applying experiment",e),()=>{}}return i&&this.eventTracker.track("experiment",{action:"show",experiment_id:e.params.experiment_id,experiment_name:e.params.experiment_name,variant_id:e.params.variant_id,variant_name:e.params.variant_name,location:window.location.href,path:window.location.pathname}),n}}gi([Ys([{name:"options",oneOf:["boolean","object"]}]),mi("design:type",Function),mi("design:paramtypes",[Object]),mi("design:returntype",void 0)],la.prototype,"initialize",null),gi([Ys([{name:"options",oneOf:["boolean","object"]}]),mi("design:type",Function),mi("design:paramtypes",[Object]),mi("design:returntype",void 0)],la.prototype,"_preInitialize",null),gi([Ys([{name:"options",oneOf:["boolean","object"]}]),mi("design:type",Function),mi("design:paramtypes",[Object]),mi("design:returntype",void 0)],la.prototype,"_initializeConfig",null),gi([Ys([{name:"eventType",type:"string"},{name:"eventProperties",type:"object",optional:!0},{name:"successCallback",type:"function",optional:!0},{name:"errorCallback",type:"function",optional:!0},{name:"immediate",type:"boolean",optional:!0}]),Dr("track"),ca(),mi("design:type",Function),mi("design:paramtypes",[String,Object,Function,Function,Boolean]),mi("design:returntype",void 0)],la.prototype,"track",null),gi([Ys([{name:"customerIds",oneOf:["object","string","number"]},{name:"customerProperties",type:"object",optional:!0},{name:"successCallback",type:"function",optional:!0},{name:"errorCallback",type:"function",optional:!0},{name:"immediate",type:"boolean",optional:!0}]),Dr("identify"),ca(),mi("design:type",Function),mi("design:paramtypes",[Object,Object,Function,Function,Boolean,Function,Function]),mi("design:returntype",void 0)],la.prototype,"identify",null),gi([Ys([{name:"customerProperties",type:"object"}]),Dr("update"),ca(),mi("design:type",Function),mi("design:paramtypes",[Object]),mi("design:returntype",void 0)],la.prototype,"update",null),gi([Ys([]),ca(),mi("design:type",Function),mi("design:paramtypes",[]),mi("design:returntype",void 0)],la.prototype,"anonymize",null),gi([Ys([{name:"abTestName",type:"string"},{name:"variants",type:"object"},{name:"callback",type:"function",optional:!0}]),Dr("getAbTest"),ca(),mi("design:type",Function),mi("design:paramtypes",[String,Object,Function]),mi("design:returntype",Object)],la.prototype,"getAbTest",null),gi([Ys([{name:"id",type:"string"},{name:"params",type:"object",optional:!0},{name:"noHiding",type:"boolean",optional:!0},{name:"callback",type:"function",optional:!0}]),Dr("showBanner"),ca(),mi("design:type",Function),mi("design:paramtypes",[String,Object,Object,Function]),mi("design:returntype",void 0)],la.prototype,"showBanner",null),gi([Ys([{name:"id",type:"string"},{name:"params",type:"object",optional:!0},{name:"noHiding",type:"boolean",optional:!0},{name:"callback",type:"function",optional:!0}]),Dr("showWebLayer"),ca(),mi("design:type",Function),mi("design:paramtypes",[String,Object,Object,Function]),mi("design:returntype",void 0)],la.prototype,"showWebLayer",null),gi([Ys([{name:"options",type:"object"}]),Dr("getRecommendation"),ca(),mi("design:type",Function),mi("design:paramtypes",[Object]),mi("design:returntype",void 0)],la.prototype,"getRecommendation",null),gi([Ys([{name:"exposedCategory",type:"string"},{name:"successCallback",type:"function"},{name:"errorCallback",type:"function",optional:!0},{name:"options",type:"object",optional:!0}]),Dr("track"),ca(),mi("design:type",Function),mi("design:paramtypes",[String,Function,Function,Object]),mi("design:returntype",void 0)],la.prototype,"getSegments",null),gi([Ys([{name:"element",oneOf:["string","element"]},{name:"eventType",type:"string"},{name:"eventProperties",type:"object",optional:!0}]),Dr("trackLink"),ca(),mi("design:type",Function),mi("design:paramtypes",[Object,String,Object]),mi("design:returntype",void 0)],la.prototype,"trackLink",null),gi([Ys([{name:"dependencyNameOrArray",oneOf:["string","array"]},{name:"callback",type:"function",optional:!0}]),Dr("loadDependency"),mi("design:type",Function),mi("design:paramtypes",[Object,Function]),mi("design:returntype",void 0)],la.prototype,"loadDependency",null),gi([Ys([{name:"pingOptions",type:"object",optional:!0}]),Dr("ping"),ca(),mi("design:type",Function),mi("design:paramtypes",[Object]),mi("design:returntype",void 0)],la.prototype,"ping",null),gi([Ys([{name:"callback",type:"function",optional:!0}]),Dr("reloadWebLayers"),ca(),mi("design:type",Function),mi("design:paramtypes",[Function]),mi("design:returntype",void 0)],la.prototype,"reloadWebLayers",null),gi([Ys([]),mi("design:type",Function),mi("design:paramtypes",[]),mi("design:returntype",Promise)],la.prototype,"_bootstrapEditor",null),gi([Ys([{name:"experiment",type:"object"},{name:"trackEvent",type:"boolean",optional:!0}]),mi("design:type",Function),mi("design:paramtypes",[Object,Boolean]),mi("design:returntype",Function)],la.prototype,"_insertExperiment",null),gi([Ys([]),mi("design:type",Function),mi("design:paramtypes",[]),mi("design:returntype",void 0)],la.prototype,"_revertExperiments",null),gi([Ys([{name:"banditRewardToken",type:"string"},{name:"banditRewardValue",type:"number"},{name:"successCallback",type:"function",optional:!0},{name:"errorCallback",type:"function",optional:!0}]),Dr("_rewardBandit"),mi("design:type",Function),mi("design:paramtypes",[String,Number,Function,Function]),mi("design:returntype",void 0)],la.prototype,"_rewardBandit",null),gi([Ys([{name:"ecommerceObject",type:"object"},{name:"kind",type:"string",optional:!0}]),Dr("trackEnhancedEcommerce"),mi("design:type",Function),mi("design:paramtypes",[Object,String]),mi("design:returntype",void 0)],la.prototype,"trackEnhancedEcommerce",null);var da;const pa=new Ns(console,u);if(fa=navigator.userAgent,new RegExp("Googlebot\\/|Googlebot-Mobile|Googlebot-Image|Googlebot-News|Googlebot-Video|AdsBot-Google([^-]|$)|AdsBot-Google-Mobile|Feedfetcher-Google|Mediapartners-Google|Mediapartners \\(Googlebot\\)|APIs-Google|bingbot|Slurp|[wW]get|LinkedInBot|Python-urllib|python-requests|libwww-perl|httpunit|nutch|Go-http-client|phpcrawl|msnbot|jyxobot|FAST-WebCrawler|FAST Enterprise Crawler|BIGLOTRON|Teoma|convera|seekbot|Gigabot|Gigablast|exabot|ia_archiver|GingerCrawler|webmon |HTTrack|grub.org|UsineNouvelleCrawler|antibot|netresearchserver|speedy|fluffy|findlink|msrbot|panscient|yacybot|AISearchBot|ips-agent|tagoobot|MJ12bot|woriobot|yanga|buzzbot|mlbot|YandexBot|YandexImages|YandexAccessibilityBot|YandexMobileBot|purebot|Linguee Bot|CyberPatrol|voilabot|Baiduspider|citeseerxbot|spbot|twengabot|postrank|TurnitinBot|scribdbot|page2rss|sitebot|linkdex|Adidxbot|ezooms|dotbot|Mail.RU_Bot|discobot|heritrix|findthatfile|europarchive.org|NerdByNature.Bot|sistrix crawler|Ahrefs(Bot|SiteAudit)|fuelbot|CrunchBot|IndeedBot|mappydata|woobot|ZoominfoBot|PrivacyAwareBot|Multiviewbot|SWIMGBot|Grobbot|eright|Apercite|semanticbot|Aboundex|domaincrawler|wbsearchbot|summify|CCBot|edisterbot|seznambot|ec2linkfinder|gslfbot|aiHitBot|intelium_bot|facebookexternalhit|Yeti|RetrevoPageAnalyzer|lb-spider|Sogou|lssbot|careerbot|wotbox|wocbot|ichiro|DuckDuckBot|lssrocketcrawler|drupact|webcompanycrawler|acoonbot|openindexspider|gnam gnam spider|web-archive-net.com.bot|backlinkcrawler|coccoc|integromedb|content crawler spider|toplistbot|it2media-domain-crawler|ip-web-crawler.com|siteexplorer.info|elisabot|proximic|changedetection|arabot|WeSEE:Search|niki-bot|CrystalSemanticsBot|rogerbot|360Spider|psbot|InterfaxScanBot|CC Metadata Scaper|g00g1e.net|GrapeshotCrawler|urlappendbot|brainobot|fr-crawler|binlar|SimpleCrawler|Twitterbot|cXensebot|smtbot|bnf.fr_bot|A6-Indexer|ADmantX|Facebot|OrangeBot\\/|memorybot|AdvBot|MegaIndex|SemanticScholarBot|ltx71|nerdybot|xovibot|BUbiNG|Qwantify|archive.org_bot|Applebot|TweetmemeBot|crawler4j|findxbot|S[eE][mM]rushBot|yoozBot|lipperhey|Y!J|Domain Re-Animator Bot|AddThis|Screaming Frog SEO Spider|MetaURI|Scrapy|Livelap[bB]ot|OpenHoseBot|CapsuleChecker|collection@infegy.com|IstellaBot|DeuSu\\/|betaBot|Cliqzbot\\/|MojeekBot\\/|netEstate NE Crawler|SafeSearch microdata crawler|Gluten Free Crawler\\/|Sonic|Sysomos|Trove|deadlinkchecker|Slack-ImgProxy|Embedly|RankActiveLinkBot|iskanie|SafeDNSBot|SkypeUriPreview|Veoozbot|Slackbot|redditbot|datagnionbot|Google-Adwords-Instant|adbeat_bot|WhatsApp|contxbot|pinterest.com.bot|electricmonk|GarlikCrawler|BingPreview\\/|vebidoobot|FemtosearchBot|Yahoo Link Preview|MetaJobBot|DomainStatsBot|mindUpBot|Daum\\/|Jugendschutzprogramm-Crawler|Xenu Link Sleuth|Pcore-HTTP|moatbot|KosmioBot|pingdom|AppInsights|PhantomJS|Gowikibot|PiplBot|Discordbot|TelegramBot|Jetslide|newsharecounts|James BOT|Bark[rR]owler|TinEye|SocialRankIOBot|trendictionbot|Ocarinabot|epicbot|Primalbot|DuckDuckGo-Favicons-Bot|GnowitNewsbot|Leikibot|LinkArchiver|YaK\\/|PaperLiBot|Digg Deeper|dcrawl|Snacktory|AndersPinkBot|Fyrebot|EveryoneSocialBot|Mediatoolkitbot|Luminator-robots|ExtLinksBot|SurveyBot|NING\\/|okhttp|Nuzzel|omgili|PocketParser|YisouSpider|um-LN|ToutiaoSpider|MuckRack|Jamie's Spider|AHC\\/|NetcraftSurveyAgent|Laserlikebot|^Apache-HttpClient|AppEngine-Google|Jetty|Upflow|Thinklab|Traackr.com|Twurly|Mastodon|http_get|DnyzBot|botify|007ac9 Crawler|BehloolBot|BrandVerity|check_http|BDCbot|ZumBot|EZID|ICC-Crawler|ArchiveBot|^LCC |filterdb.iss.net\\/crawler|BLP_bbot|BomboraBot|Buck\\/|Companybook-Crawler|Genieo|magpie-crawler|MeltwaterNews|Moreover|newspaper\\/|ScoutJet|(^| )sentry\\/|StorygizeBot|UptimeRobot|OutclicksBot|seoscanners|Hatena|Google Web Preview|MauiBot|AlphaBot|SBL-BOT|IAS crawler|adscanner|Netvibes|acapbot|Baidu-YunGuanCe|bitlybot|blogmuraBot|Bot.AraTurka.com|bot-pge.chlooe.com|BoxcarBot|BTWebClient|ContextAd Bot|Digincore bot|Disqus|Feedly|Fetch\\/|Fever|Flamingo_SearchEngine|FlipboardProxy|g2reader-bot|G2 Web Services|imrbot|K7MLWCBot|Kemvibot|Landau-Media-Spider|linkapediabot|vkShare|Siteimprove.com|BLEXBot\\/|DareBoost|ZuperlistBot\\/|Miniflux\\/|Feedspot|Diffbot\\/|SEOkicks|tracemyfile|Nimbostratus-Bot|zgrab|PR-CY.RU|AdsTxtCrawler|Datafeedwatch|Zabbix|TangibleeBot|google-xrawler|axios|Amazon CloudFront|Pulsepoint|CloudFlare-AlwaysOnline|Google-Structured-Data-Testing-Tool|WordupInfoSearch|WebDataStats|HttpUrlConnection|Seekport Crawler|ZoomBot|VelenPublicWebCrawler|MoodleBot|jpg-newsbot|outbrain|W3C_Validator|Validator\\.nu|W3C-checklink|W3C-mobileOK|W3C_I18n-Checker|FeedValidator|W3C_CSS_Validator|W3C_Unicorn|Google-PhysicalWeb|Blackboard|ICBot\\/|BazQux|Twingly|Rivva|Experibot|awesomecrawler|Dataprovider.com|GroupHigh\\/|theoldreader.com|AnyEvent|Uptimebot\\.org|Nmap Scripting Engine|2ip.ru|Clickagy|Caliperbot|MBCrawler|online-webceo-bot|B2B Bot|AddSearchBot|Google Favicon|HubSpot|Chrome-Lighthouse|HeadlessChrome|CheckMarkNetwork\\/|www\\.uptime\\.com|Streamline3Bot\\/|serpstatbot\\/|MixnodeCache\\/|^curl|SimpleScraper|RSSingBot|Jooblebot|fedoraplanet|Friendica|NextCloud|Tiny Tiny RSS|RegionStuttgartBot|Bytespider|Datanyze|Google-Site-Verification|TrendsmapResolver|tweetedtimes|NTENTbot|Gwene|SimplePie|SearchAtlas|Superfeedr|feedbot|UT-Dorkbot|Amazonbot|SerendeputyBot|Eyeotabot|officestorebot|Neticle Crawler|SurdotlyBot|LinkisBot|AwarioSmartBot|AwarioRssBot|RyteBot|FreeWebMonitoring SiteChecker|AspiegelBot|NAVER Blog Rssbot|zenback bot|SentiBot|Domains Project\\/|Pandalytics|VKRobot|bidswitchbot|tigerbot|NIXStatsbot|Atom Feed Robot|Curebot|PagePeeker\\/|Vigil\\/|rssbot\\/|startmebot\\/|JobboerseBot|seewithkids|NINJA bot|Cutbot|BublupBot|BrandONbot|RidderBot|YandexMetrika|YandexTurbo|YandexImageResizer|YandexVideoParser|Taboolabot|Dubbotbot|FindITAnswersbot|infoobot|Refindbot|BlogTraffic\\/\\d\\.\\d+ Feed-Fetcher|SeobilityBot|Cincraw|Dragonbot|VoluumDSP-content-bot|FreshRSS|BitBot","i").test(fa))pa.log("Crawler detected, not initializing SDK");else if(function(e,t){return"Internet Explorer"===an(e,t,e.navigator.userAgent,e.navigator.vendor)}(window,document))pa.log("Unsupported browser detected, not initializing SDK");else if(null===(da=window[c])||void 0===da?void 0:da.version)pa.log("The SDK is already available on the window, maybe the SDK file is downloaded twice?");else{const e=new na;e.debug.log("Creating SDK instance");const t=new la(e),i=t.notifications,n=t.segments,r=function(e=window){return e[c]||(e[c]={_:[]},e[c].notifications={_:[]},e[c].segments={_:[]}),e[c].notifications||(e[c].notifications={_:[]}),e[c].segments||(e[c].segments={_:[]}),e[c]}(),s=r.notifications,o=r.segments;_(r,t,e.debug),k(ra,r,t),ga=r,ma=t,sa.forEach((e=>{Object.defineProperty(ga,e,{get:()=>ma[e],configurable:!1,enumerable:!1})})),_(s,i,e.debug),k(oa,s,i),_(o,n,e.debug),k(aa,o,n)}var ga,ma,fa}();
//# sourceMappingURL=exponea.min.js.map
